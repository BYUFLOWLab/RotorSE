<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>rotorse.rotor &mdash; RotorSE 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nrel.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="RotorSE 0.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">RotorSE 0.1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for rotorse.rotor</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">rotor.py</span>

<span class="sd">Created by Andrew Ning on 2012-02-28.</span>
<span class="sd">Copyright (c)  NREL. All rights reserved.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">VariableTree</span><span class="p">,</span> <span class="n">Component</span><span class="p">,</span> <span class="n">Assembly</span>
<span class="kn">from</span> <span class="nn">openmdao.main.datatypes.api</span> <span class="kn">import</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Array</span><span class="p">,</span> <span class="n">VarTree</span><span class="p">,</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">Str</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">rotoraero</span> <span class="kn">import</span> <span class="n">SetupRunVarSpeed</span><span class="p">,</span> <span class="n">RegulatedPowerCurve</span><span class="p">,</span> <span class="n">AEP</span><span class="p">,</span> <span class="n">VarSpeedMachine</span><span class="p">,</span> \
    <span class="n">RatedConditions</span><span class="p">,</span> <span class="n">AeroLoads</span><span class="p">,</span> <span class="n">RPM2RS</span><span class="p">,</span> <span class="n">RS2RPM</span>
<span class="kn">from</span> <span class="nn">rotoraerodefaults</span> <span class="kn">import</span> <span class="n">CCBladeGeometry</span><span class="p">,</span> <span class="n">CCBlade</span><span class="p">,</span> <span class="n">CSMDrivetrain</span><span class="p">,</span> <span class="n">RayleighCDF</span><span class="p">,</span> <span class="n">WeibullWithMeanCDF</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.drivers.api</span> <span class="kn">import</span> <span class="n">Brent</span>
<span class="kn">from</span> <span class="nn">commonse.csystem</span> <span class="kn">import</span> <span class="n">DirectionVector</span>
<span class="kn">from</span> <span class="nn">commonse.utilities</span> <span class="kn">import</span> <span class="n">hstack</span><span class="p">,</span> <span class="n">vstack</span><span class="p">,</span> <span class="n">trapz_deriv</span><span class="p">,</span> <span class="n">interp_with_deriv</span>
<span class="kn">from</span> <span class="nn">commonse.environment</span> <span class="kn">import</span> <span class="n">PowerWind</span>
<span class="kn">from</span> <span class="nn">precomp</span> <span class="kn">import</span> <span class="n">Profile</span><span class="p">,</span> <span class="n">Orthotropic2DMaterial</span><span class="p">,</span> <span class="n">CompositeSection</span><span class="p">,</span> <span class="n">_precomp</span>
<span class="kn">from</span> <span class="nn">akima</span> <span class="kn">import</span> <span class="n">Akima</span><span class="p">,</span> <span class="n">akima_interp_with_derivs</span>
<span class="kn">import</span> <span class="nn">_pBEAM</span>
<span class="kn">import</span> <span class="nn">_curvefem</span>
<span class="kn">import</span> <span class="nn">_bem</span>  <span class="c"># TODO: move to rotoraero</span>



<span class="c"># ---------------------</span>
<span class="c"># Variable Trees</span>
<span class="c"># ---------------------</span>

<span class="k">class</span> <span class="nc">BeamProperties</span><span class="p">(</span><span class="n">VariableTree</span><span class="p">):</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;locations of properties along beam&#39;</span><span class="p">)</span>
    <span class="n">EA</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;axial stiffness&#39;</span><span class="p">)</span>
    <span class="n">EIxx</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;edgewise stiffness (bending about :ref:`x-direction of airfoil aligned coordinate system &lt;blade_airfoil_coord&gt;`)&#39;</span><span class="p">)</span>
    <span class="n">EIyy</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;flatwise stiffness (bending about y-direction of airfoil aligned coordinate system)&#39;</span><span class="p">)</span>
    <span class="n">EIxy</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;coupled flap-edge stiffness&#39;</span><span class="p">)</span>
    <span class="n">GJ</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;torsional stiffness (about axial z-direction of airfoil aligned coordinate system)&#39;</span><span class="p">)</span>
    <span class="n">rhoA</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass per unit length&#39;</span><span class="p">)</span>
    <span class="n">rhoJ</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;kg*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;polar mass moment of inertia per unit length&#39;</span><span class="p">)</span>
    <span class="n">x_ec_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;x-distance to elastic center from point about which above structural properties are computed (airfoil aligned coordinate system)&#39;</span><span class="p">)</span>
    <span class="n">y_ec_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;y-distance to elastic center from point about which above structural properties are computed&#39;</span><span class="p">)</span>



<span class="c"># class Orthotropic2DMaterial(VariableTree):</span>

<span class="c">#     E1 = Float(units=&#39;N/m**2&#39;, desc=&#39;Young&#39;&#39;s modulus in first principal direction&#39;)</span>
<span class="c">#     E2 = Float(units=&#39;N/m**2&#39;, desc=&#39;Young&#39;&#39;s modulus in second principal direction&#39;)</span>
<span class="c">#     G12 = Float(units=&#39;N/m**2&#39;, desc=&#39;shear modulus&#39;)</span>
<span class="c">#     nu12 = Float(desc=&#39;Poisson&#39;&#39;s ratio (nu12*E22 = nu21*E11)&#39;)</span>
<span class="c">#     rho = Float(units=&#39;kg/m**3&#39;, desc=&#39;density&#39;)</span>


<span class="c"># class Sector(VariableTree):</span>

<span class="c">#     num_plies = Array(dtype=np.int)</span>
<span class="c">#     thickness = Array(units=&#39;m&#39;)</span>
<span class="c">#     orientation = Array(units=&#39;deg&#39;)</span>
<span class="c">#     materials = List(Orthotropic2DMaterial)</span>



<span class="c"># ---------------------</span>
<span class="c"># Base Components</span>
<span class="c"># ---------------------</span>

<div class="viewcode-block" id="BeamPropertiesBase"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.BeamPropertiesBase">[docs]</a><span class="k">class</span> <span class="nc">BeamPropertiesBase</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="n">properties</span> <span class="o">=</span> <span class="n">VarTree</span><span class="p">(</span><span class="n">BeamProperties</span><span class="p">(),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;beam properties&#39;</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="StrucBase"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.StrucBase">[docs]</a><span class="k">class</span> <span class="nc">StrucBase</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="c"># all inputs/outputs in airfoil coordinate system</span>

    <span class="c"># inputs</span>
    <span class="n">beam</span> <span class="o">=</span> <span class="n">VarTree</span><span class="p">(</span><span class="n">BeamProperties</span><span class="p">(),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;beam properties&#39;</span><span class="p">)</span>

    <span class="n">nF</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of natural frequencies to return&#39;</span><span class="p">)</span>

    <span class="n">Px_defl</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distributed load (force per unit length) in airfoil x-direction at max deflection condition&#39;</span><span class="p">)</span>
    <span class="n">Py_defl</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distributed load (force per unit length) in airfoil y-direction at max deflection condition&#39;</span><span class="p">)</span>
    <span class="n">Pz_defl</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distributed load (force per unit length) in airfoil z-direction at max deflection condition&#39;</span><span class="p">)</span>

    <span class="n">Px_strain</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distributed load (force per unit length) in airfoil x-direction at max strain condition&#39;</span><span class="p">)</span>
    <span class="n">Py_strain</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distributed load (force per unit length) in airfoil y-direction at max strain condition&#39;</span><span class="p">)</span>
    <span class="n">Pz_strain</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distributed load (force per unit length) in airfoil z-direction at max strain condition&#39;</span><span class="p">)</span>

    <span class="n">Px_pc_defl</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distributed load (force per unit length) in airfoil x-direction for deflection used in generated power curve&#39;</span><span class="p">)</span>
    <span class="n">Py_pc_defl</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distributed load (force per unit length) in airfoil y-direction for deflection used in generated power curve&#39;</span><span class="p">)</span>
    <span class="n">Pz_pc_defl</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;distributed load (force per unit length) in airfoil z-direction for deflection used in generated power curve&#39;</span><span class="p">)</span>

    <span class="n">xu_strain_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;x-position of midpoint of spar cap on upper surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">xl_strain_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;x-position of midpoint of spar cap on lower surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">yu_strain_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;y-position of midpoint of spar cap on upper surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">yl_strain_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;y-position of midpoint of spar cap on lower surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">xu_strain_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;x-position of midpoint of trailing-edge panel on upper surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">xl_strain_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;x-position of midpoint of trailing-edge panel on lower surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">yu_strain_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;y-position of midpoint of trailing-edge panel on upper surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">yl_strain_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;y-position of midpoint of trailing-edge panel on lower surface for strain calculation&#39;</span><span class="p">)</span>

    <span class="n">Mx_damage</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;damage equivalent moments about airfoil x-direction&#39;</span><span class="p">)</span>
    <span class="n">My_damage</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;damage equivalent moments about airfoil y-direction&#39;</span><span class="p">)</span>
    <span class="n">strain_ult_spar</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;ultimate strain in spar cap&#39;</span><span class="p">)</span>
    <span class="n">strain_ult_te</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mi">2500</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;uptimate strain in trailing-edge panels&#39;</span><span class="p">)</span>
    <span class="n">eta_damage</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.755</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;safety factor for fatigue&#39;</span><span class="p">)</span>
    <span class="n">m_damage</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;slope of S-N curve for fatigue analysis&#39;</span><span class="p">)</span>
    <span class="n">N_damage</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="o">*</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of cycles used in fatigue analysis&#39;</span><span class="p">)</span>

    <span class="c"># outputs</span>
    <span class="n">blade_mass</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass of one blades&#39;</span><span class="p">)</span>
    <span class="n">blade_moment_of_inertia</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;out of plane moment of inertia of a blade&#39;</span><span class="p">)</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;first nF natural frequencies of blade&#39;</span><span class="p">)</span>
    <span class="n">dx_defl</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection of blade section in airfoil x-direction under max deflection loading&#39;</span><span class="p">)</span>
    <span class="n">dy_defl</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection of blade section in airfoil y-direction under max deflection loading&#39;</span><span class="p">)</span>
    <span class="n">dz_defl</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection of blade section in airfoil z-direction under max deflection loading&#39;</span><span class="p">)</span>
    <span class="n">dx_pc_defl</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection of blade section in airfoil x-direction under power curve loading&#39;</span><span class="p">)</span>
    <span class="n">dy_pc_defl</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection of blade section in airfoil y-direction under power curve loading&#39;</span><span class="p">)</span>
    <span class="n">dz_pc_defl</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection of blade section in airfoil z-direction under power curve loading&#39;</span><span class="p">)</span>
    <span class="n">strainU_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;strain in spar cap on upper surface at location xu,yu_strain with loads P_strain&#39;</span><span class="p">)</span>
    <span class="n">strainL_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;strain in spar cap on lower surface at location xl,yl_strain with loads P_strain&#39;</span><span class="p">)</span>
    <span class="n">strainU_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;strain in trailing-edge panels on upper surface at location xu,yu_te with loads P_te&#39;</span><span class="p">)</span>
    <span class="n">strainL_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;strain in trailing-edge panels on lower surface at location xl,yl_te with loads P_te&#39;</span><span class="p">)</span>
    <span class="n">damageU_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fatigue damage on upper surface in spar cap&#39;</span><span class="p">)</span>
    <span class="n">damageL_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fatigue damage on lower surface in spar cap&#39;</span><span class="p">)</span>
    <span class="n">damageU_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fatigue damage on upper surface in trailing-edge panels&#39;</span><span class="p">)</span>
    <span class="n">damageL_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fatigue damage on lower surface in trailing-edge panels&#39;</span><span class="p">)</span>





<span class="c"># ---------------------</span>
<span class="c"># Components</span>
<span class="c"># ---------------------</span>

</div>
<span class="k">class</span> <span class="nc">ResizeCompositeSection</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="n">upperCSIn</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">CompositeSection</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of CompositeSection objections defining the properties for upper surface&#39;</span><span class="p">)</span>
    <span class="n">lowerCSIn</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">CompositeSection</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of CompositeSection objections defining the properties for lower surface&#39;</span><span class="p">)</span>
    <span class="n">websCSIn</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">CompositeSection</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of CompositeSection objections defining the properties for shear webs&#39;</span><span class="p">)</span>

    <span class="c"># TODO: remove fixed t/c assumption</span>
    <span class="n">chord_str_ref</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;chord distribution for reference section, thickness of structural layup scaled with reference thickness (fixed t/c for this case)&#39;</span><span class="p">)</span>

    <span class="n">sector_idx_strain_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;index of sector for spar (PreComp definition of sector)&#39;</span><span class="p">)</span>
    <span class="n">sector_idx_strain_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;index of sector for trailing-edge (PreComp definition of sector)&#39;</span><span class="p">)</span>

    <span class="n">chord_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;structural chord distribution&#39;</span><span class="p">)</span>
    <span class="n">sparT_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;structural spar cap thickness distribution&#39;</span><span class="p">)</span>
    <span class="n">teT_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;structural trailing-edge panel thickness distribution&#39;</span><span class="p">)</span>

    <span class="c"># out</span>
    <span class="n">upperCSOut</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">CompositeSection</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of CompositeSection objections defining the properties for upper surface&#39;</span><span class="p">)</span>
    <span class="n">lowerCSOut</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">CompositeSection</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of CompositeSection objections defining the properties for lower surface&#39;</span><span class="p">)</span>
    <span class="n">websCSOut</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">CompositeSection</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of CompositeSection objections defining the properties for shear webs&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">nstr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chord_str_ref</span><span class="p">)</span>

        <span class="c"># copy data acrosss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upperCSOut</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lowerCSOut</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">websCSOut</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstr</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">upperCSOut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">upperCSIn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mycopy</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lowerCSOut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lowerCSIn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mycopy</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">websCSOut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">websCSIn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mycopy</span><span class="p">())</span>


        <span class="c"># scale all thicknesses with airfoil thickness</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstr</span><span class="p">):</span>

            <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upperCSOut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowerCSOut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">webs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">websCSOut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c"># factor = t_str[i]/tref[i]</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chord_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">chord_str_ref</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c"># same as thickness ratio for constant t/c</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">upper</span><span class="o">.</span><span class="n">t</span><span class="p">)):</span>
                <span class="n">upper</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lower</span><span class="o">.</span><span class="n">t</span><span class="p">)):</span>
                <span class="n">lower</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">webs</span><span class="o">.</span><span class="n">t</span><span class="p">)):</span>
                <span class="n">webs</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>


        <span class="c"># change spar and trailing edge thickness to specified values</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstr</span><span class="p">):</span>

            <span class="n">idx_spar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sector_idx_strain_spar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">idx_te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sector_idx_strain_te</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upperCSOut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowerCSOut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c"># upper and lower have same thickness for this design</span>
            <span class="n">tspar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">upper</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_spar</span><span class="p">])</span>
            <span class="n">tte</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">upper</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_te</span><span class="p">])</span>

            <span class="n">upper</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_spar</span><span class="p">]</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparT_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">tspar</span>
            <span class="n">lower</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_spar</span><span class="p">]</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparT_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">tspar</span>

            <span class="n">upper</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_te</span><span class="p">]</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">teT_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">tte</span>
            <span class="n">lower</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">idx_te</span><span class="p">]</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">teT_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">tte</span>


<div class="viewcode-block" id="PreCompSections"><a class="viewcode-back" href="../../documentation.html#rotorse.rotor.PreCompSections">[docs]</a><span class="k">class</span> <span class="nc">PreCompSections</span><span class="p">(</span><span class="n">BeamPropertiesBase</span><span class="p">):</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;radial positions. r[0] should be the hub location </span><span class="se">\</span>
<span class="s">        while r[-1] should be the blade tip. Any number </span><span class="se">\</span>
<span class="s">        of locations can be specified between these in ascending order.&#39;</span><span class="p">)</span>
    <span class="n">chord</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;array of chord lengths at corresponding radial positions&#39;</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;array of twist angles at corresponding radial positions. </span><span class="se">\</span>
<span class="s">        (positive twist decreases angle of attack)&#39;</span><span class="p">)</span>
    <span class="n">leLoc</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;array of leading-edge positions from a reference blade axis </span><span class="se">\</span>
<span class="s">        (usually blade pitch axis). locations are normalized by the local chord length.  </span><span class="se">\</span>
<span class="s">        e.g. leLoc[i] = 0.2 means leading edge is 0.2*chord[i] from reference axis.   </span><span class="se">\</span>
<span class="s">        positive in -x direction for airfoil-aligned coordinate system&#39;</span><span class="p">)</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Profile</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;airfoil shape at each radial position&#39;</span><span class="p">)</span>
    <span class="n">materials</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Orthotropic2DMaterial</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of all Orthotropic2DMaterial objects used in defining the geometry&#39;</span><span class="p">)</span>
    <span class="n">upperCS</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">CompositeSection</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of CompositeSection objections defining the properties for upper surface&#39;</span><span class="p">)</span>
    <span class="n">lowerCS</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">CompositeSection</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of CompositeSection objections defining the properties for lower surface&#39;</span><span class="p">)</span>
    <span class="n">websCS</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">CompositeSection</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of CompositeSection objections defining the properties for shear webs&#39;</span><span class="p">)</span>

    <span class="n">sector_idx_strain_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;index of sector for spar (PreComp definition of sector)&#39;</span><span class="p">)</span>
    <span class="n">sector_idx_strain_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;index of sector for trailing-edge (PreComp definition of sector)&#39;</span><span class="p">)</span>


    <span class="n">eps_crit_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;critical strain in spar from panel buckling calculation&#39;</span><span class="p">)</span>
    <span class="n">eps_crit_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;critical strain in trailing-edge panels from panel buckling calculation&#39;</span><span class="p">)</span>

    <span class="n">xu_strain_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;x-position of midpoint of spar cap on upper surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">xl_strain_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;x-position of midpoint of spar cap on lower surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">yu_strain_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;y-position of midpoint of spar cap on upper surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">yl_strain_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;y-position of midpoint of spar cap on lower surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">xu_strain_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;x-position of midpoint of trailing-edge panel on upper surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">xl_strain_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;x-position of midpoint of trailing-edge panel on lower surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">yu_strain_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;y-position of midpoint of trailing-edge panel on upper surface for strain calculation&#39;</span><span class="p">)</span>
    <span class="n">yl_strain_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;y-position of midpoint of trailing-edge panel on lower surface for strain calculation&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">criticalStrainLocations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sector_idx_strain</span><span class="p">,</span> <span class="n">x_ec_nose</span><span class="p">,</span> <span class="n">y_ec_nose</span><span class="p">):</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sector_idx_strain</span><span class="p">)</span>

        <span class="c"># find corresponding locations on airfoil at midpoint of sector</span>
        <span class="n">xun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">xln</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">yun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">yln</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">csU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upperCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">csL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowerCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">pf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">sector_idx_strain</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">xun</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">csU</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">csU</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">xln</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">csL</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">csL</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">yun</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xun</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pf</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pf</span><span class="o">.</span><span class="n">yu</span><span class="p">)</span>
            <span class="n">yln</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xln</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pf</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pf</span><span class="o">.</span><span class="n">yl</span><span class="p">)</span>

        <span class="c"># make dimensional and define relative to elastic center</span>
        <span class="n">xu</span> <span class="o">=</span> <span class="n">xun</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">chord</span> <span class="o">-</span> <span class="n">x_ec_nose</span>
        <span class="n">xl</span> <span class="o">=</span> <span class="n">xln</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">chord</span> <span class="o">-</span> <span class="n">x_ec_nose</span>
        <span class="n">yu</span> <span class="o">=</span> <span class="n">yun</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">chord</span> <span class="o">-</span> <span class="n">y_ec_nose</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="n">yln</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">chord</span> <span class="o">-</span> <span class="n">y_ec_nose</span>


        <span class="c"># switch to airfoil coordinate system</span>
        <span class="n">xu</span><span class="p">,</span> <span class="n">yu</span> <span class="o">=</span> <span class="n">yu</span><span class="p">,</span> <span class="n">xu</span>
        <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span> <span class="o">=</span> <span class="n">yl</span><span class="p">,</span> <span class="n">xl</span>

        <span class="k">return</span> <span class="n">xu</span><span class="p">,</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yu</span><span class="p">,</span> <span class="n">yl</span>


    <span class="k">def</span> <span class="nf">panelBucklingStrain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sector_idx_strain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        see chapter on Structural Component Design Techniques from Alastair Johnson</span>
<span class="sd">        section 6.2: Design of composite panels</span>

<span class="sd">        assumes: large aspect ratio, simply supported, uniaxial compression, flat rectangular plate</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># rename</span>
        <span class="n">chord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chord</span>
        <span class="n">CS_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upperCS</span>  <span class="c"># TODO: assumes the upper surface is the compression one</span>

        <span class="c"># initialize</span>
        <span class="n">nsec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chord</span><span class="p">)</span>
        <span class="n">eps_crit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsec</span><span class="p">):</span>

            <span class="n">cs</span> <span class="o">=</span> <span class="n">CS_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">sector_idx</span> <span class="o">=</span> <span class="n">sector_idx_strain</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c"># chord-wise length of sector</span>
            <span class="n">sector_length</span> <span class="o">=</span> <span class="n">chord</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sector_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sector_idx</span><span class="p">])</span>

            <span class="c"># get matrices</span>
            <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">totalHeight</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">compositeMatrices</span><span class="p">(</span><span class="n">sector_idx</span><span class="p">)</span>
            <span class="n">E</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">effectiveEAxial</span><span class="p">(</span><span class="n">sector_idx</span><span class="p">)</span>
            <span class="n">D1</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">D2</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">D3</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">D</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="c"># use empirical formula</span>
            <span class="n">Nxx</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">sector_length</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D1</span><span class="o">*</span><span class="n">D2</span><span class="p">)</span> <span class="o">+</span> <span class="n">D3</span><span class="p">)</span>

            <span class="n">eps_crit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">Nxx</span> <span class="o">/</span> <span class="n">totalHeight</span> <span class="o">/</span> <span class="n">E</span>

        <span class="k">return</span> <span class="n">eps_crit</span>




    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>


        <span class="c"># radial discretization</span>
        <span class="n">nsec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>

        <span class="c"># initialize variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">EA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">EIxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">EIyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">EIxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">GJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">rhoA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">rhoJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>

        <span class="c"># distance to elastic center from point about which structural properties are computed</span>
        <span class="c"># using airfoil coordinate system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">x_ec_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">y_ec_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>

        <span class="c"># distance to elastic center from airfoil nose</span>
        <span class="c"># using profile coordinate system</span>
        <span class="n">x_ec_nose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>
        <span class="n">y_ec_nose</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>

        <span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materials</span>
        <span class="n">csU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upperCS</span>
        <span class="n">csL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lowerCS</span>
        <span class="n">csW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">websCS</span>

        <span class="c"># twist rate</span>
        <span class="n">th_prime</span> <span class="o">=</span> <span class="n">_precomp</span><span class="o">.</span><span class="n">tw_rate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>

        <span class="c"># arrange materials into list</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
        <span class="n">E1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
        <span class="n">E2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
        <span class="n">G12</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
        <span class="n">nu12</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">E1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">E1</span>
            <span class="n">E2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">E2</span>
            <span class="n">G12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">G12</span>
            <span class="n">nu12</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nu12</span>
            <span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">rho</span>


        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsec</span><span class="p">):</span>

            <span class="n">xnode</span><span class="p">,</span> <span class="n">ynode</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_preCompFormat</span><span class="p">()</span>
            <span class="n">locU</span><span class="p">,</span> <span class="n">n_laminaU</span><span class="p">,</span> <span class="n">n_pliesU</span><span class="p">,</span> <span class="n">tU</span><span class="p">,</span> <span class="n">thetaU</span><span class="p">,</span> <span class="n">mat_idxU</span> <span class="o">=</span> <span class="n">csU</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_preCompFormat</span><span class="p">()</span>
            <span class="n">locL</span><span class="p">,</span> <span class="n">n_laminaL</span><span class="p">,</span> <span class="n">n_pliesL</span><span class="p">,</span> <span class="n">tL</span><span class="p">,</span> <span class="n">thetaL</span><span class="p">,</span> <span class="n">mat_idxL</span> <span class="o">=</span> <span class="n">csL</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_preCompFormat</span><span class="p">()</span>
            <span class="n">locW</span><span class="p">,</span> <span class="n">n_laminaW</span><span class="p">,</span> <span class="n">n_pliesW</span><span class="p">,</span> <span class="n">tW</span><span class="p">,</span> <span class="n">thetaW</span><span class="p">,</span> <span class="n">mat_idxW</span> <span class="o">=</span> <span class="n">csW</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_preCompFormat</span><span class="p">()</span>

            <span class="n">nwebs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locW</span><span class="p">)</span>

            <span class="c"># address a bug in f2py (need to pass in length 1 arrays even though they are not used)</span>
            <span class="k">if</span> <span class="n">nwebs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">locW</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">n_laminaW</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">n_pliesW</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">tW</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">thetaW</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">mat_idxW</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>


            <span class="n">results</span> <span class="o">=</span> <span class="n">_precomp</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chord</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">th_prime</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">leLoc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">xnode</span><span class="p">,</span> <span class="n">ynode</span><span class="p">,</span> <span class="n">E1</span><span class="p">,</span> <span class="n">E2</span><span class="p">,</span> <span class="n">G12</span><span class="p">,</span> <span class="n">nu12</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span>
                <span class="n">locU</span><span class="p">,</span> <span class="n">n_laminaU</span><span class="p">,</span> <span class="n">n_pliesU</span><span class="p">,</span> <span class="n">tU</span><span class="p">,</span> <span class="n">thetaU</span><span class="p">,</span> <span class="n">mat_idxU</span><span class="p">,</span>
                <span class="n">locL</span><span class="p">,</span> <span class="n">n_laminaL</span><span class="p">,</span> <span class="n">n_pliesL</span><span class="p">,</span> <span class="n">tL</span><span class="p">,</span> <span class="n">thetaL</span><span class="p">,</span> <span class="n">mat_idxL</span><span class="p">,</span>
                <span class="n">nwebs</span><span class="p">,</span> <span class="n">locW</span><span class="p">,</span> <span class="n">n_laminaW</span><span class="p">,</span> <span class="n">n_pliesW</span><span class="p">,</span> <span class="n">tW</span><span class="p">,</span> <span class="n">thetaW</span><span class="p">,</span> <span class="n">mat_idxW</span><span class="p">)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">EIxx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># EIedge</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">EIyy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># EIflat</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">GJ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">EA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">EIxy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>  <span class="c"># EIflapedge</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">x_ec_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">y_ec_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">rhoA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">rhoJ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">+</span> <span class="n">results</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>  <span class="c"># perpindicular axis theorem</span>

            <span class="n">x_ec_nose</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">leLoc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">chord</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">y_ec_nose</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>  <span class="c"># switch b.c of coordinate system used</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eps_crit_spar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">panelBucklingStrain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_idx_strain_spar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps_crit_te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">panelBucklingStrain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_idx_strain_te</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xu_strain_spar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xl_strain_spar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yu_strain_spar</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">yl_strain_spar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">criticalStrainLocations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_idx_strain_spar</span><span class="p">,</span> <span class="n">x_ec_nose</span><span class="p">,</span> <span class="n">y_ec_nose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xu_strain_te</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xl_strain_te</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yu_strain_te</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">yl_strain_te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">criticalStrainLocations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sector_idx_strain_te</span><span class="p">,</span> <span class="n">x_ec_nose</span><span class="p">,</span> <span class="n">y_ec_nose</span><span class="p">)</span>



</div>
<span class="k">class</span> <span class="nc">RotorWithpBEAM</span><span class="p">(</span><span class="n">StrucBase</span><span class="p">):</span>


    <span class="k">def</span> <span class="nf">principalCS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beam</span><span class="p">):</span>

        <span class="c"># rename (with swap of x, y for profile c.s.)</span>
        <span class="n">EIxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">EIyy</span><span class="p">)</span>
        <span class="n">EIyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">EIxx</span><span class="p">)</span>
        <span class="n">x_ec_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">y_ec_str</span><span class="p">)</span>
        <span class="n">y_ec_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">x_ec_str</span><span class="p">)</span>
        <span class="n">EA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">EA</span><span class="p">)</span>
        <span class="n">EIxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">EIxy</span><span class="p">)</span>

        <span class="c"># translate to elastic center</span>
        <span class="n">EIxx</span> <span class="o">-=</span> <span class="n">y_ec_str</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">EA</span>
        <span class="n">EIyy</span> <span class="o">-=</span> <span class="n">x_ec_str</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">EA</span>
        <span class="n">EIxy</span> <span class="o">-=</span> <span class="n">x_ec_str</span><span class="o">*</span><span class="n">y_ec_str</span><span class="o">*</span><span class="n">EA</span>

        <span class="c"># get rotation angle</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">EIxy</span><span class="p">,</span> <span class="n">EIyy</span><span class="o">-</span><span class="n">EIxx</span><span class="p">)</span>

        <span class="n">EI11</span> <span class="o">=</span> <span class="n">EIxx</span> <span class="o">-</span> <span class="n">EIxy</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">EI22</span> <span class="o">=</span> <span class="n">EIyy</span> <span class="o">+</span> <span class="n">EIxy</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

        <span class="c"># get moments and positions in principal axes</span>
        <span class="n">ca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">sa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">EI11</span><span class="p">,</span> <span class="n">EI22</span><span class="p">,</span> <span class="n">EA</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="n">sa</span>



    <span class="k">def</span> <span class="nf">strain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blade</span><span class="p">,</span> <span class="n">xu</span><span class="p">,</span> <span class="n">yu</span><span class="p">,</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">,</span> <span class="n">EI11</span><span class="p">,</span> <span class="n">EI22</span><span class="p">,</span> <span class="n">EA</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="n">sa</span><span class="p">):</span>


        <span class="n">Vx</span><span class="p">,</span> <span class="n">Vy</span><span class="p">,</span> <span class="n">Fz</span><span class="p">,</span> <span class="n">Mx</span><span class="p">,</span> <span class="n">My</span><span class="p">,</span> <span class="n">Tz</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="n">shearAndBending</span><span class="p">()</span>


        <span class="c"># use profile c.s. to use Hansen&#39;s notation</span>
        <span class="n">Vx</span><span class="p">,</span> <span class="n">Vy</span> <span class="o">=</span> <span class="n">Vy</span><span class="p">,</span> <span class="n">Vx</span>
        <span class="n">Mx</span><span class="p">,</span> <span class="n">My</span> <span class="o">=</span> <span class="n">My</span><span class="p">,</span> <span class="n">Mx</span>
        <span class="n">xu</span><span class="p">,</span> <span class="n">yu</span> <span class="o">=</span> <span class="n">yu</span><span class="p">,</span> <span class="n">xu</span>
        <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span> <span class="o">=</span> <span class="n">yl</span><span class="p">,</span> <span class="n">xl</span>

        <span class="c"># convert to principal xes</span>
        <span class="n">M1</span> <span class="o">=</span> <span class="n">Mx</span><span class="o">*</span><span class="n">ca</span> <span class="o">+</span> <span class="n">My</span><span class="o">*</span><span class="n">sa</span>
        <span class="n">M2</span> <span class="o">=</span> <span class="o">-</span><span class="n">Mx</span><span class="o">*</span><span class="n">sa</span> <span class="o">+</span> <span class="n">My</span><span class="o">*</span><span class="n">ca</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">xu</span><span class="o">*</span><span class="n">ca</span> <span class="o">+</span> <span class="n">yu</span><span class="o">*</span><span class="n">sa</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">xu</span><span class="o">*</span><span class="n">sa</span> <span class="o">+</span> <span class="n">yu</span><span class="o">*</span><span class="n">ca</span>

        <span class="c"># compute strain</span>
        <span class="n">strainU</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">M1</span><span class="o">/</span><span class="n">EI11</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">M2</span><span class="o">/</span><span class="n">EI22</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">Fz</span><span class="o">/</span><span class="n">EA</span><span class="p">)</span>  <span class="c"># negative sign because 3 is opposite of z</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">xl</span><span class="o">*</span><span class="n">ca</span> <span class="o">+</span> <span class="n">yl</span><span class="o">*</span><span class="n">sa</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">xl</span><span class="o">*</span><span class="n">sa</span> <span class="o">+</span> <span class="n">yl</span><span class="o">*</span><span class="n">ca</span>

        <span class="n">strainL</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">M1</span><span class="o">/</span><span class="n">EI11</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">M2</span><span class="o">/</span><span class="n">EI22</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">Fz</span><span class="o">/</span><span class="n">EA</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">strainU</span><span class="p">,</span> <span class="n">strainL</span>


    <span class="k">def</span> <span class="nf">damage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Mx</span><span class="p">,</span> <span class="n">My</span><span class="p">,</span> <span class="n">xu</span><span class="p">,</span> <span class="n">yu</span><span class="p">,</span> <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span><span class="p">,</span> <span class="n">EI11</span><span class="p">,</span> <span class="n">EI22</span><span class="p">,</span> <span class="n">EA</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="n">sa</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="mf">1.755</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="o">*</span><span class="mi">24</span><span class="p">):</span>


        <span class="c"># use profile c.s. to use Hansen&#39;s notation</span>
        <span class="n">Mx</span><span class="p">,</span> <span class="n">My</span> <span class="o">=</span> <span class="n">My</span><span class="p">,</span> <span class="n">Mx</span>
        <span class="n">Fz</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">xu</span><span class="p">,</span> <span class="n">yu</span> <span class="o">=</span> <span class="n">yu</span><span class="p">,</span> <span class="n">xu</span>
        <span class="n">xl</span><span class="p">,</span> <span class="n">yl</span> <span class="o">=</span> <span class="n">yl</span><span class="p">,</span> <span class="n">xl</span>

        <span class="c"># convert to principal xes</span>
        <span class="n">M1</span> <span class="o">=</span> <span class="n">Mx</span><span class="o">*</span><span class="n">ca</span> <span class="o">+</span> <span class="n">My</span><span class="o">*</span><span class="n">sa</span>
        <span class="n">M2</span> <span class="o">=</span> <span class="o">-</span><span class="n">Mx</span><span class="o">*</span><span class="n">sa</span> <span class="o">+</span> <span class="n">My</span><span class="o">*</span><span class="n">ca</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">xu</span><span class="o">*</span><span class="n">ca</span> <span class="o">+</span> <span class="n">yu</span><span class="o">*</span><span class="n">sa</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">xu</span><span class="o">*</span><span class="n">sa</span> <span class="o">+</span> <span class="n">yu</span><span class="o">*</span><span class="n">ca</span>

        <span class="c"># compute strain</span>
        <span class="n">strainU</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">M1</span><span class="o">/</span><span class="n">EI11</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">M2</span><span class="o">/</span><span class="n">EI22</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">Fz</span><span class="o">/</span><span class="n">EA</span><span class="p">)</span>  <span class="c"># negative sign because 3 is opposite of z</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">xl</span><span class="o">*</span><span class="n">ca</span> <span class="o">+</span> <span class="n">yl</span><span class="o">*</span><span class="n">sa</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">xl</span><span class="o">*</span><span class="n">sa</span> <span class="o">+</span> <span class="n">yl</span><span class="o">*</span><span class="n">ca</span>

        <span class="n">strainL</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">M1</span><span class="o">/</span><span class="n">EI11</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">M2</span><span class="o">/</span><span class="n">EI22</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">Fz</span><span class="o">/</span><span class="n">EA</span><span class="p">)</span>

        <span class="c"># number of cycles to failure</span>
        <span class="n">NfU</span> <span class="o">=</span> <span class="p">(</span><span class="n">emax</span><span class="o">/</span><span class="p">(</span><span class="n">eta</span><span class="o">*</span><span class="n">strainU</span><span class="p">))</span><span class="o">**</span><span class="n">m</span>
        <span class="n">NfL</span> <span class="o">=</span> <span class="p">(</span><span class="n">emax</span><span class="o">/</span><span class="p">(</span><span class="n">eta</span><span class="o">*</span><span class="n">strainL</span><span class="p">))</span><span class="o">**</span><span class="n">m</span>

        <span class="c"># damage</span>
        <span class="n">damageU</span> <span class="o">=</span> <span class="n">N</span><span class="o">/</span><span class="n">NfU</span>
        <span class="n">damageL</span> <span class="o">=</span> <span class="n">N</span><span class="o">/</span><span class="n">NfL</span>

        <span class="n">damageU</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">emax</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">strainU</span><span class="p">)))</span>
        <span class="n">damageL</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">emax</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eta</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">strainL</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">damageU</span><span class="p">,</span> <span class="n">damageL</span>




    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">beam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam</span>
        <span class="n">nsec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">beam</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>


        <span class="c"># create finite element objects</span>
        <span class="n">p_section</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">SectionData</span><span class="p">(</span><span class="n">nsec</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">EA</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">EIxx</span><span class="p">,</span>
            <span class="n">beam</span><span class="o">.</span><span class="n">EIyy</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">GJ</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">rhoA</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">rhoJ</span><span class="p">)</span>
        <span class="c"># p_loads = _pBEAM.Loads(nsec)  # no loads</span>
        <span class="n">p_tip</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">TipData</span><span class="p">()</span>  <span class="c"># no tip mass</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">)])</span>
        <span class="n">p_base</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">BaseData</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">))</span>  <span class="c"># rigid base</span>


        <span class="c"># ----- tip deflection -----</span>

        <span class="c"># evaluate displacements</span>
        <span class="n">p_loads</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Loads</span><span class="p">(</span><span class="n">nsec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Px_defl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Py_defl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pz_defl</span><span class="p">)</span>
        <span class="n">blade</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Beam</span><span class="p">(</span><span class="n">p_section</span><span class="p">,</span> <span class="n">p_loads</span><span class="p">,</span> <span class="n">p_tip</span><span class="p">,</span> <span class="n">p_base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx_defl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy_defl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dz_defl</span><span class="p">,</span> <span class="n">dtheta_r1</span><span class="p">,</span> <span class="n">dtheta_r2</span><span class="p">,</span> <span class="n">dtheta_z</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="n">displacement</span><span class="p">()</span>

        <span class="n">p_loads</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Loads</span><span class="p">(</span><span class="n">nsec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Px_pc_defl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Py_pc_defl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pz_pc_defl</span><span class="p">)</span>
        <span class="n">blade</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Beam</span><span class="p">(</span><span class="n">p_section</span><span class="p">,</span> <span class="n">p_loads</span><span class="p">,</span> <span class="n">p_tip</span><span class="p">,</span> <span class="n">p_base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx_pc_defl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy_pc_defl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dz_pc_defl</span><span class="p">,</span> <span class="n">dtheta_r1</span><span class="p">,</span> <span class="n">dtheta_r2</span><span class="p">,</span> <span class="n">dtheta_z</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="n">displacement</span><span class="p">()</span>


        <span class="c"># --- mass ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blade_mass</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="n">mass</span><span class="p">()</span>

        <span class="c"># --- moments of inertia</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blade_moment_of_inertia</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="n">outOfPlaneMomentOfInertia</span><span class="p">()</span>

        <span class="c"># ----- natural frequencies ----</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">blade</span><span class="o">.</span><span class="n">naturalFrequencies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nF</span><span class="p">)</span>


        <span class="c"># ----- strain -----</span>
        <span class="n">EI11</span><span class="p">,</span> <span class="n">EI22</span><span class="p">,</span> <span class="n">EA</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="n">sa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">principalCS</span><span class="p">(</span><span class="n">beam</span><span class="p">)</span>

        <span class="n">p_loads</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Loads</span><span class="p">(</span><span class="n">nsec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Px_strain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Py_strain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pz_strain</span><span class="p">)</span>
        <span class="n">blade</span> <span class="o">=</span> <span class="n">_pBEAM</span><span class="o">.</span><span class="n">Beam</span><span class="p">(</span><span class="n">p_section</span><span class="p">,</span> <span class="n">p_loads</span><span class="p">,</span> <span class="n">p_tip</span><span class="p">,</span> <span class="n">p_base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strainU_spar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strainL_spar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strain</span><span class="p">(</span><span class="n">blade</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xu_strain_spar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yu_strain_spar</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xl_strain_spar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yl_strain_spar</span><span class="p">,</span> <span class="n">EI11</span><span class="p">,</span> <span class="n">EI22</span><span class="p">,</span> <span class="n">EA</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="n">sa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strainU_te</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strainL_te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strain</span><span class="p">(</span><span class="n">blade</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xu_strain_te</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yu_strain_te</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xl_strain_te</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yl_strain_te</span><span class="p">,</span> <span class="n">EI11</span><span class="p">,</span> <span class="n">EI22</span><span class="p">,</span> <span class="n">EA</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="n">sa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">damageU_spar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">damageL_spar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx_damage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">My_damage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xu_strain_spar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yu_strain_spar</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xl_strain_spar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yl_strain_spar</span><span class="p">,</span> <span class="n">EI11</span><span class="p">,</span> <span class="n">EI22</span><span class="p">,</span> <span class="n">EA</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="n">sa</span><span class="p">,</span>
            <span class="n">emax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strain_ult_spar</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_damage</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">m_damage</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">N_damage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">damageU_te</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">damageL_te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx_damage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">My_damage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xu_strain_te</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yu_strain_te</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xl_strain_te</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yl_strain_te</span><span class="p">,</span> <span class="n">EI11</span><span class="p">,</span> <span class="n">EI22</span><span class="p">,</span> <span class="n">EA</span><span class="p">,</span> <span class="n">ca</span><span class="p">,</span> <span class="n">sa</span><span class="p">,</span>
            <span class="n">emax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">strain_ult_te</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_damage</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">m_damage</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">N_damage</span><span class="p">)</span>




<span class="k">class</span> <span class="nc">CurveFEM</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;natural frequencies for curved blades&quot;&quot;&quot;</span>

    <span class="n">Omega</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;rpm&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;rotor rotation frequency&#39;</span><span class="p">)</span>
    <span class="n">beam</span> <span class="o">=</span> <span class="n">VarTree</span><span class="p">(</span><span class="n">BeamProperties</span><span class="p">(),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;beam properties&#39;</span><span class="p">)</span>
    <span class="n">theta_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;structural twist distribution&#39;</span><span class="p">)</span>
    <span class="n">precurve_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;structural precuve (see FAST definition)&#39;</span><span class="p">)</span>
    <span class="n">presweep_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;structural presweep (see FAST definition)&#39;</span><span class="p">)</span>
    <span class="n">nF</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of frequencies to return&#39;</span><span class="p">)</span>

    <span class="n">freq</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;first nF natural frequencies&#39;</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">beam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">beam</span><span class="o">.</span><span class="n">z</span>

        <span class="n">rhub</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bladeLength</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bladeFrac</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">rhub</span><span class="p">)</span> <span class="o">/</span> <span class="n">bladeLength</span>

        <span class="n">freq</span> <span class="o">=</span> <span class="n">_curvefem</span><span class="o">.</span><span class="n">frequencies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Omega</span><span class="p">,</span> <span class="n">bladeLength</span><span class="p">,</span> <span class="n">rhub</span><span class="p">,</span> <span class="n">bladeFrac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_str</span><span class="p">,</span>
                                     <span class="n">beam</span><span class="o">.</span><span class="n">rhoA</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">EIxx</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">EIyy</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">GJ</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">EA</span><span class="p">,</span> <span class="n">beam</span><span class="o">.</span><span class="n">rhoJ</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">presweep_str</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">nF</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">GridSetup</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;preprocessing step.  inputs and outputs should not change during optimization&quot;&quot;&quot;</span>

    <span class="c"># should be constant</span>
    <span class="n">initial_aero_grid</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;initial aerodynamic grid on unit radius&#39;</span><span class="p">)</span>
    <span class="n">initial_str_grid</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;initial structural grid on unit radius&#39;</span><span class="p">)</span>

    <span class="c"># outputs are also constant during optimization</span>
    <span class="n">fraction</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fractional location of structural grid on aero grid&#39;</span><span class="p">)</span>
    <span class="n">idxj</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;index of augmented aero grid corresponding to structural index&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">r_aero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_aero_grid</span>
        <span class="n">r_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_str_grid</span>
        <span class="n">r_aug</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">r_aero</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]])</span>

        <span class="n">nstr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_str</span><span class="p">)</span>
        <span class="n">naug</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_aug</span><span class="p">)</span>

        <span class="c"># find idx in augmented aero array that brackets the structural index</span>
        <span class="c"># then find the fraction the structural value is between the two bounding indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nstr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idxj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nstr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstr</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">naug</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">r_aug</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">r_str</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">j</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idxj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">r_aug</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">r_aug</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r_aug</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>



<span class="k">class</span> <span class="nc">RGrid</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="c"># variables</span>
    <span class="n">r_aero</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;new aerodynamic grid on unit radius&#39;</span><span class="p">)</span>

    <span class="c"># parameters</span>
    <span class="n">fraction</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fractional location of structural grid on aero grid&#39;</span><span class="p">)</span>
    <span class="n">idxj</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;index of augmented aero grid corresponding to structural index&#39;</span><span class="p">)</span>

    <span class="c"># outputs</span>
    <span class="n">r_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;corresponding structural grid corresponding to new aerodynamic grid&#39;</span><span class="p">)</span>


    <span class="n">missing_deriv_policy</span> <span class="o">=</span> <span class="s">&#39;assume_zero&#39;</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">r_aug</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_aero</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]])</span>

        <span class="n">nstr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fraction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nstr</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstr</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_aug</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">r_aug</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r_aug</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;r_aero&#39;</span><span class="p">,)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;r_str&#39;</span><span class="p">,</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">nstr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fraction</span><span class="p">)</span>
        <span class="n">naero</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_aero</span><span class="p">)</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nstr</span><span class="p">,</span> <span class="n">naero</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstr</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idxj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">naero</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">naero</span><span class="p">:</span>
                <span class="n">J</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">J</span>



<span class="k">class</span> <span class="nc">GeometrySpline</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="c"># variables</span>
    <span class="n">r_aero_unit</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;locations where airfoils are defined on unit radius&#39;</span><span class="p">)</span>
    <span class="n">r_str_unit</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;locations where airfoils are defined on unit radius&#39;</span><span class="p">)</span>
    <span class="n">r_max_chord</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of max chord on unit radius&#39;</span><span class="p">)</span>
    <span class="n">chord_sub</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;chord at control points&#39;</span><span class="p">)</span>  <span class="c"># defined at hub, then at linearly spaced locations from r_max_chord to tip</span>
    <span class="n">theta_sub</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;twist at control points&#39;</span><span class="p">)</span>  <span class="c"># defined at linearly spaced locations from r[idx_cylinder] to tip</span>
    <span class="n">precurve_sub</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;precurve at control points&#39;</span><span class="p">)</span>  <span class="c"># defined at same locations at chord, starting at 2nd control point (root must be zero precurve)</span>
    <span class="n">bladeLength</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;blade length (if not precurved or swept) otherwise length of blade before curvature&#39;</span><span class="p">)</span>
    <span class="n">sparT</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;thickness values of spar cap&#39;</span><span class="p">)</span>
    <span class="n">teT</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;thickness values of trailing edge panels&#39;</span><span class="p">)</span>

    <span class="c"># parameters</span>
    <span class="n">idx_cylinder_aero</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;first idx in r_aero_unit of non-cylindrical section&#39;</span><span class="p">)</span>  <span class="c"># constant twist inboard of here</span>
    <span class="n">idx_cylinder_str</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;first idx in r_str_unit of non-cylindrical section&#39;</span><span class="p">)</span>
    <span class="n">hubFraction</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;hub location as fraction of radius&#39;</span><span class="p">)</span>

    <span class="c"># out</span>
    <span class="n">Rhub</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;dimensional radius of hub&#39;</span><span class="p">)</span>
    <span class="n">Rtip</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;dimensional radius of tip&#39;</span><span class="p">)</span>
    <span class="n">r_aero</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;dimensional aerodynamic grid&#39;</span><span class="p">)</span>
    <span class="n">r_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;dimensional structural grid&#39;</span><span class="p">)</span>
    <span class="n">chord_aero</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;chord at airfoil locations&#39;</span><span class="p">)</span>
    <span class="n">chord_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;chord at structural locations&#39;</span><span class="p">)</span>
    <span class="n">theta_aero</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;twist at airfoil locations&#39;</span><span class="p">)</span>
    <span class="n">theta_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;twist at structural locations&#39;</span><span class="p">)</span>
    <span class="n">precurve_aero</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;precurve at airfoil locations&#39;</span><span class="p">)</span>
    <span class="n">precurve_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;precurve at structural locations&#39;</span><span class="p">)</span>
    <span class="n">presweep_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;presweep at structural locations&#39;</span><span class="p">)</span>
    <span class="n">sparT_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;dimensional spar cap thickness distribution&#39;</span><span class="p">)</span>
    <span class="n">teT_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;dimensional trailing-edge panel thickness distribution&#39;</span><span class="p">)</span>
    <span class="n">r_sub_precurve</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;precurve locations (used internally)&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">Rhub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hubFraction</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength</span>
        <span class="n">Rtip</span> <span class="o">=</span> <span class="n">Rhub</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength</span>

        <span class="c"># setup chord parmeterization</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chord_sub</span><span class="p">)</span>
        <span class="n">r_max_chord</span> <span class="o">=</span> <span class="n">Rhub</span> <span class="o">+</span> <span class="p">(</span><span class="n">Rtip</span><span class="o">-</span><span class="n">Rhub</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">r_max_chord</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">r_max_chord</span><span class="p">,</span> <span class="n">Rtip</span><span class="p">,</span> <span class="n">nc</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">Rhub</span><span class="p">],</span> <span class="n">rc</span><span class="p">])</span>
        <span class="n">chord_spline</span> <span class="o">=</span> <span class="n">Akima</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chord_sub</span><span class="p">)</span>

        <span class="c"># setup theta parmeterization</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_sub</span><span class="p">)</span>
        <span class="n">idxc_aero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_cylinder_aero</span>
        <span class="n">idxc_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx_cylinder_str</span>
        <span class="n">r_cylinder</span> <span class="o">=</span> <span class="n">Rhub</span> <span class="o">+</span> <span class="p">(</span><span class="n">Rtip</span><span class="o">-</span><span class="n">Rhub</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">r_aero_unit</span><span class="p">[</span><span class="n">idxc_aero</span><span class="p">]</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">r_cylinder</span><span class="p">,</span> <span class="n">Rtip</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
        <span class="n">theta_spline</span> <span class="o">=</span> <span class="n">Akima</span><span class="p">(</span><span class="n">rt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_sub</span><span class="p">)</span>

        <span class="c"># setup precurve parmeterization</span>
        <span class="n">precurve_spline</span> <span class="o">=</span> <span class="n">Akima</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve_sub</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_sub_precurve</span> <span class="o">=</span> <span class="n">rc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c"># make dimensional and evaluate splines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rhub</span> <span class="o">=</span> <span class="n">Rhub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rtip</span> <span class="o">=</span> <span class="n">Rtip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_aero</span> <span class="o">=</span> <span class="n">Rhub</span> <span class="o">+</span> <span class="p">(</span><span class="n">Rtip</span><span class="o">-</span><span class="n">Rhub</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">r_aero_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_str</span> <span class="o">=</span> <span class="n">Rhub</span> <span class="o">+</span> <span class="p">(</span><span class="n">Rtip</span><span class="o">-</span><span class="n">Rhub</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chord_aero</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">chord_spline</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_aero</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chord_str</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">chord_spline</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str</span><span class="p">)</span>
        <span class="n">theta_outer_aero</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">theta_spline</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_aero</span><span class="p">[</span><span class="n">idxc_aero</span><span class="p">:])</span>
        <span class="n">theta_outer_str</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">theta_spline</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str</span><span class="p">[</span><span class="n">idxc_str</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_aero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">theta_outer_aero</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">idxc_aero</span><span class="p">),</span> <span class="n">theta_outer_aero</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">theta_outer_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">idxc_str</span><span class="p">),</span> <span class="n">theta_outer_str</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precurve_aero</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">precurve_spline</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_aero</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">precurve_spline</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">presweep_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve_str</span><span class="p">)</span>  <span class="c"># TODO: for now</span>

        <span class="c"># setup sparT parameterization</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sparT</span><span class="p">)</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Rtip</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>
        <span class="n">sparT_spline</span> <span class="o">=</span> <span class="n">Akima</span><span class="p">(</span><span class="n">rt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sparT</span><span class="p">)</span>
        <span class="n">teT_spline</span> <span class="o">=</span> <span class="n">Akima</span><span class="p">(</span><span class="n">rt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">teT</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sparT_str</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sparT_spline</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">teT_str</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">teT_spline</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str</span><span class="p">)</span>

        <span class="c"># below is not generalized and was for a specific study</span>
        <span class="c"># nt = len(self.sparT) - 1</span>
        <span class="c"># rt = np.linspace(r_cylinder, Rtip, nt)</span>
        <span class="c"># sparT_spline = Akima(rt, self.sparT[1:])</span>

        <span class="c"># self.sparT_cylinder = np.array([0.05739, 0.05739, 0.05739, 0.05739, 0.05739, 0.05739, 0.05457, 0.03859, 0.03812, 0.03906, 0.04799, 0.05363, 0.05833])</span>
        <span class="c"># self.teT_cylinder = np.array([0.05739, 0.05739, 0.05739, 0.05739, 0.05739, 0.05739, 0.05457, 0.03859, 0.05765, 0.05765, 0.04731, 0.04167])</span>

        <span class="c"># sparT_str_in = self.sparT[0]*self.sparT_cylinder</span>
        <span class="c"># sparT_str_out, _, _, _ = sparT_spline.interp(self.r_str[idxc_str:])</span>
        <span class="c"># self.sparT_str = np.concatenate([sparT_str_in, [sparT_str_out[0]], sparT_str_out])</span>

        <span class="c"># # trailing edge thickness</span>
        <span class="c"># teT_str_in = self.teT[0]*self.teT_cylinder</span>
        <span class="c"># self.teT_str = np.concatenate((teT_str_in, self.teT[1]*np.ones(9), self.teT[2]*np.ones(7), self.teT[3]*np.ones(8), self.teT[4]*np.ones(2)))</span>


    <span class="c"># def list_deriv_vars(self):</span>
    <span class="c">#     pass</span>
    <span class="c">#     # naero = len(self.r_aero_unit)</span>
    <span class="c">#     # nstr = len(self.r_str_unit)</span>
    <span class="c">#     # ncs = len(self.chord_sub)</span>
    <span class="c">#     # nts = len(self.theta_sub)</span>
    <span class="c">#     # nst = len(self.sparT)</span>
    <span class="c">#     # ntt = len(self.teT)</span>

    <span class="c">#     # n = naero + nstr + ncs + nts + nst + ntt + 2</span>

    <span class="c">#     # dRtip = np.zeros(n)</span>
    <span class="c">#     # dRhub = np.zeros(n)</span>
    <span class="c">#     # dRtip[naero + nstr + 1 + ncs + nts] = 1.0</span>
    <span class="c">#     # dRhub[naero + nstr + 1 + ncs + nts] = self.hubFraction</span>

    <span class="c">#     # draero = np.zeros((naero, n))</span>
    <span class="c">#     # draero[:, naero + nstr + 1 + ncs + nts] = (1.0 - self.r_aero_unit)*self.hubFraction + self.r_aero_unit</span>
    <span class="c">#     # draero[:, :naero] = Rtip-Rhub</span>

    <span class="c">#     # drstr = np.zeros((nstr, n))</span>
    <span class="c">#     # drstr[:, naero + nstr + 1 + ncs + nts] = (1.0 - self.r_str_unit)*self.hubFraction + self.r_str_unit</span>
    <span class="c">#     # drstr[:, naero:nstr] = Rtip-Rhub</span>

    <span class="c">#     # TODO: do with Tapenade</span>




    <span class="c">#     # inputs = (&#39;r_aero_unit&#39;, &#39;r_str_unit&#39;, &#39;r_max_chord&#39;, &#39;chord_sub&#39;, &#39;theta_sub&#39;, &#39;bladeLength&#39;, &#39;sparT&#39;, &#39;teT&#39;)</span>
    <span class="c">#     # outputs = (&#39;Rhub&#39;, &#39;Rtip&#39;, &#39;r_aero&#39;, &#39;r_str&#39;, &#39;chord_aero&#39;, &#39;chord_str&#39;,</span>
    <span class="c">#     #     &#39;theta_aero&#39;, &#39;theta_str&#39;, &#39;sparT_str&#39;, &#39;teT_str&#39;)</span>

    <span class="c">#     # return inputs, outputs</span>

    <span class="c"># def provideJ(self):</span>
    <span class="c">#     pass</span>


    <span class="c">#     # J =</span>

    <span class="c">#     # return J</span>



<span class="k">class</span> <span class="nc">BladeCurvature</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location in blade z-coordinate&#39;</span><span class="p">)</span>
    <span class="n">precurve</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location in blade x-coordinate&#39;</span><span class="p">)</span>
    <span class="n">presweep</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location in blade y-coordinate&#39;</span><span class="p">)</span>
    <span class="n">precone</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;precone angle&#39;</span><span class="p">)</span>

    <span class="n">totalCone</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;total cone angle from precone and curvature&#39;</span><span class="p">)</span>
    <span class="n">x_az</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of blade in azimuth x-coordinate system&#39;</span><span class="p">)</span>
    <span class="n">y_az</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of blade in azimuth y-coordinate system&#39;</span><span class="p">)</span>
    <span class="n">z_az</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of blade in azimuth z-coordinate system&#39;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;cumulative path length along blade&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># self.x_az, self.y_az, self.z_az, cone, s = \</span>
        <span class="c">#     _bem.definecurvature(self.r, self.precurve, self.presweep, 0.0)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
        <span class="n">dx_dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_az</span><span class="p">,</span> <span class="n">x_azd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_az</span><span class="p">,</span> <span class="n">y_azd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_az</span><span class="p">,</span> <span class="n">z_azd</span><span class="p">,</span> \
            <span class="n">cone</span><span class="p">,</span> <span class="n">coned</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="n">_bem</span><span class="o">.</span><span class="n">definecurvature_dv2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">dx_dx</span><span class="p">[:,</span> <span class="p">:</span><span class="n">n</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">precurve</span><span class="p">,</span> <span class="n">dx_dx</span><span class="p">[:,</span> <span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">presweep</span><span class="p">,</span> <span class="n">dx_dx</span><span class="p">[:,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">totalCone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precone</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">cone</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span>

        <span class="n">dxaz_dr</span> <span class="o">=</span> <span class="n">x_azd</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dxaz_dprecurve</span> <span class="o">=</span> <span class="n">x_azd</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dxaz_dpresweep</span> <span class="o">=</span> <span class="n">x_azd</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dxaz_dr</span><span class="p">,</span> <span class="n">dxaz_dprecurve</span><span class="p">,</span> <span class="n">dxaz_dpresweep</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>

        <span class="n">dyaz_dr</span> <span class="o">=</span> <span class="n">y_azd</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dyaz_dprecurve</span> <span class="o">=</span> <span class="n">y_azd</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dyaz_dpresweep</span> <span class="o">=</span> <span class="n">y_azd</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dyaz_dr</span><span class="p">,</span> <span class="n">dyaz_dprecurve</span><span class="p">,</span> <span class="n">dyaz_dpresweep</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>

        <span class="n">dzaz_dr</span> <span class="o">=</span> <span class="n">z_azd</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dzaz_dprecurve</span> <span class="o">=</span> <span class="n">z_azd</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dzaz_dpresweep</span> <span class="o">=</span> <span class="n">z_azd</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dzaz_dr</span><span class="p">,</span> <span class="n">dzaz_dprecurve</span><span class="p">,</span> <span class="n">dzaz_dpresweep</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>

        <span class="n">dcone_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">coned</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dcone_dprecurve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">coned</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">:])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dcone_dpresweep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">coned</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dcone</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dcone_dr</span><span class="p">,</span> <span class="n">dcone_dprecurve</span><span class="p">,</span> <span class="n">dcone_dpresweep</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>

        <span class="n">ds_dr</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[:</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ds_dr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ds_dprecurve</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ds_dpresweep</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">ds_dr</span><span class="p">,</span> <span class="n">ds_dprecurve</span><span class="p">,</span> <span class="n">ds_dpresweep</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">J</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">([</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="n">dcone</span><span class="p">,</span> <span class="n">ds</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;precurve&#39;</span><span class="p">,</span> <span class="s">&#39;presweep&#39;</span><span class="p">,</span> <span class="s">&#39;precone&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;x_az&#39;</span><span class="p">,</span> <span class="s">&#39;y_az&#39;</span><span class="p">,</span> <span class="s">&#39;z_az&#39;</span><span class="p">,</span> <span class="s">&#39;totalCone&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span>




        <span class="c"># n = len(self.r)</span>
        <span class="c"># precone = self.precone</span>


        <span class="c"># # azimuthal position</span>
        <span class="c"># self.x_az = -self.r*sind(precone) + self.precurve*cosd(precone)</span>
        <span class="c"># self.z_az = self.r*cosd(precone) + self.precurve*sind(precone)</span>
        <span class="c"># self.y_az = self.presweep</span>


        <span class="c"># # total precone angle</span>
        <span class="c"># x = self.precurve  # compute without precone and add in rotation after</span>
        <span class="c"># z = self.r</span>
        <span class="c"># y = self.presweep</span>

        <span class="c"># totalCone = np.zeros(n)</span>
        <span class="c"># totalCone[0] = math.atan2(-(x[1] - x[0]), z[1] - z[0])</span>
        <span class="c"># totalCone[1:n-1] = 0.5*(np.arctan2(-(x[1:n-1] - x[:n-2]), z[1:n-1] - z[:n-2])</span>
        <span class="c">#     + np.arctan2(-(x[2:] - x[1:n-1]), z[2:] - z[1:n-1]))</span>
        <span class="c"># totalCone[n-1] = math.atan2(-(x[n-1] - x[n-2]), z[n-1] - z[n-2])</span>

        <span class="c"># self.totalCone = precone + np.degrees(totalCone)</span>


        <span class="c"># # total path length of blade  (TODO: need to do something with this.  This should be a geometry preprocessing step just like rotoraero)</span>
        <span class="c"># s = np.zeros(n)</span>
        <span class="c"># s[0] = self.r[0]</span>
        <span class="c"># for i in range(1, n):</span>
        <span class="c">#     s[i] = s[i-1] + math.sqrt((x[i] - x[i-1])**2 + (y[i] - y[i-1])**2 + (z[i] - z[i-1])**2)</span>

        <span class="c"># self.s = s</span>


<span class="k">class</span> <span class="nc">DamageLoads</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="n">rstar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;nondimensional radial locations of damage equivalent moments&#39;</span><span class="p">)</span>
    <span class="n">Mxb</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;damage equivalent moments about blade c.s. x-direction&#39;</span><span class="p">)</span>
    <span class="n">Myb</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;damage equivalent moments about blade c.s. y-direction&#39;</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;structural twist&#39;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;structural radial locations&#39;</span><span class="p">)</span>

    <span class="n">Mxa</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;damage equivalent moments about airfoil c.s. x-direction&#39;</span><span class="p">)</span>
    <span class="n">Mya</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;damage equivalent moments about airfoil c.s. y-direction&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">rstar_str</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">Mxb_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_drstarstr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_drstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_dMxb</span> <span class="o">=</span> \
            <span class="n">akima_interp_with_derivs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mxb</span><span class="p">,</span> <span class="n">rstar_str</span><span class="p">)</span>

        <span class="n">Myb_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_drstarstr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_drstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_dMyb</span> <span class="o">=</span> \
            <span class="n">akima_interp_with_derivs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rstar</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Myb</span><span class="p">,</span> <span class="n">rstar_str</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ma</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="n">Mxb_str</span><span class="p">,</span> <span class="n">Myb_str</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">bladeToAirfoil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mxa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mya</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">y</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;rstar&#39;</span><span class="p">,</span> <span class="s">&#39;Mxb&#39;</span><span class="p">,</span> <span class="s">&#39;Myb&#39;</span><span class="p">,</span> <span class="s">&#39;theta&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Mxa&#39;</span><span class="p">,</span> <span class="s">&#39;Mya&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
        <span class="n">drstarstr_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">drstarstr_dr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">drstarstr_dr</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">drstarstr_dr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>

        <span class="n">dMxbstr_drstarstr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_drstarstr</span><span class="p">)</span>
        <span class="n">dMybstr_drstarstr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_drstarstr</span><span class="p">)</span>

        <span class="n">dMxbstr_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMxbstr_drstarstr</span><span class="p">,</span> <span class="n">drstarstr_dr</span><span class="p">)</span>
        <span class="n">dMybstr_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMybstr_drstarstr</span><span class="p">,</span> <span class="n">drstarstr_dr</span><span class="p">)</span>

        <span class="n">dMxa_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]),</span> <span class="n">dMxbstr_dr</span><span class="p">)</span>\
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]),</span> <span class="n">dMybstr_dr</span><span class="p">)</span>
        <span class="n">dMxa_drstar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_drstar</span><span class="p">)</span>\
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_drstar</span><span class="p">)</span>
        <span class="n">dMxa_dMxb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_dMxb</span><span class="p">)</span>
        <span class="c"># (self.Ma.dx[&#39;dx&#39;] * self.dMxbstr_dMxb.T).T</span>
        <span class="n">dMxa_dMyb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_dMyb</span><span class="p">)</span>
        <span class="n">dMxa_dtheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">])</span>

        <span class="n">dMya_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]),</span> <span class="n">dMxbstr_dr</span><span class="p">)</span>\
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]),</span> <span class="n">dMybstr_dr</span><span class="p">)</span>
        <span class="n">dMya_drstar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_drstar</span><span class="p">)</span>\
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_drstar</span><span class="p">)</span>
        <span class="n">dMya_dMxb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMxbstr_dMxb</span><span class="p">)</span>
        <span class="n">dMya_dMyb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMybstr_dMyb</span><span class="p">)</span>
        <span class="n">dMya_dtheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ma</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">])</span>

        <span class="n">dMxa</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dMxa_drstar</span><span class="p">,</span> <span class="n">dMxa_dMxb</span><span class="p">,</span> <span class="n">dMxa_dMyb</span><span class="p">,</span> <span class="n">dMxa_dtheta</span><span class="p">,</span> <span class="n">dMxa_dr</span><span class="p">])</span>
        <span class="n">dMya</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dMya_drstar</span><span class="p">,</span> <span class="n">dMya_dMxb</span><span class="p">,</span> <span class="n">dMya_dMyb</span><span class="p">,</span> <span class="n">dMya_dtheta</span><span class="p">,</span> <span class="n">dMya_dr</span><span class="p">])</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">([</span><span class="n">dMxa</span><span class="p">,</span> <span class="n">dMya</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">J</span>


<span class="k">class</span> <span class="nc">TotalLoads</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="c"># variables</span>
    <span class="n">aeroLoads</span> <span class="o">=</span> <span class="n">VarTree</span><span class="p">(</span><span class="n">AeroLoads</span><span class="p">(),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;aerodynamic loads in blade c.s.&#39;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;structural radial locations&#39;</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;structural twist&#39;</span><span class="p">)</span>
    <span class="n">tilt</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;tilt angle&#39;</span><span class="p">)</span>
    <span class="n">totalCone</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;total cone angle from precone and curvature&#39;</span><span class="p">)</span>
    <span class="n">z_az</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of blade in azimuth z-coordinate system&#39;</span><span class="p">)</span>
    <span class="n">rhoA</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass per unit length&#39;</span><span class="p">)</span>

    <span class="c"># parameters</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">9.81</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;acceleration of gravity&#39;</span><span class="p">)</span>

    <span class="c"># outputs</span>
    <span class="n">Px_af</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;total distributed loads in airfoil x-direction&#39;</span><span class="p">)</span>
    <span class="n">Py_af</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;total distributed loads in airfoil y-direction&#39;</span><span class="p">)</span>
    <span class="n">Pz_af</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;total distributed loads in airfoil z-direction&#39;</span><span class="p">)</span>

    <span class="n">missing_deriv_policy</span> <span class="o">=</span> <span class="s">&#39;assume_zero&#39;</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># totalCone = self.precone</span>
        <span class="c"># z_az = self.r*cosd(self.precone)</span>
        <span class="n">totalCone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalCone</span>
        <span class="n">z_az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_az</span>

        <span class="c"># keep all in blade c.s. then rotate all at end</span>

        <span class="c"># rename</span>
        <span class="n">aero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aeroLoads</span>

        <span class="c"># --- aero loads ---</span>

        <span class="c"># interpolate aerodynamic loads onto structural grid</span>
        <span class="n">P_a</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">P_a</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPax_dr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeror</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeroPx</span> <span class="o">=</span> <span class="n">akima_interp_with_derivs</span><span class="p">(</span><span class="n">aero</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">aero</span><span class="o">.</span><span class="n">Px</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
        <span class="n">P_a</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPay_dr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeror</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeroPy</span> <span class="o">=</span> <span class="n">akima_interp_with_derivs</span><span class="p">(</span><span class="n">aero</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">aero</span><span class="o">.</span><span class="n">Py</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
        <span class="n">P_a</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPaz_dr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeror</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeroPz</span> <span class="o">=</span> <span class="n">akima_interp_with_derivs</span><span class="p">(</span><span class="n">aero</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">aero</span><span class="o">.</span><span class="n">Pz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>


        <span class="c"># --- weight loads ---</span>

        <span class="c"># yaw c.s.</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">P_w</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">yawToHub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tilt</span><span class="p">)</span><span class="o">.</span><span class="n">hubToAzimuth</span><span class="p">(</span><span class="n">aero</span><span class="o">.</span><span class="n">azimuth</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">azimuthToBlade</span><span class="p">(</span><span class="n">totalCone</span><span class="p">)</span>


        <span class="c"># --- centrifugal loads ---</span>

        <span class="c"># azimuthal c.s.</span>
        <span class="n">Omega</span> <span class="o">=</span> <span class="n">aero</span><span class="o">.</span><span class="n">Omega</span><span class="o">*</span><span class="n">RPM2RS</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">z_az</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">P_c</span> <span class="o">=</span> <span class="n">load</span><span class="o">.</span><span class="n">azimuthToBlade</span><span class="p">(</span><span class="n">totalCone</span><span class="p">)</span>


        <span class="c"># --- total loads ---</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">P_a</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_w</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_c</span>

        <span class="c"># rotate to airfoil c.s.</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">aero</span><span class="o">.</span><span class="n">pitch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">bladeToAirfoil</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Px_af</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Py_af</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pz_af</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">z</span>



    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;aeroLoads.r&#39;</span><span class="p">,</span> <span class="s">&#39;aeroLoads.Px&#39;</span><span class="p">,</span> <span class="s">&#39;aeroLoads.Py&#39;</span><span class="p">,</span> <span class="s">&#39;aeroLoads.Pz&#39;</span><span class="p">,</span> <span class="s">&#39;aeroLoads.Omega&#39;</span><span class="p">,</span>
            <span class="s">&#39;aeroLoads.pitch&#39;</span><span class="p">,</span> <span class="s">&#39;aeroLoads.azimuth&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;theta&#39;</span><span class="p">,</span> <span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;totalCone&#39;</span><span class="p">,</span> <span class="s">&#39;rhoA&#39;</span><span class="p">,</span> <span class="s">&#39;z_az&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Px_af&#39;</span><span class="p">,</span> <span class="s">&#39;Py_af&#39;</span><span class="p">,</span> <span class="s">&#39;Pz_af&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">dPwx</span><span class="p">,</span> <span class="n">dPwy</span><span class="p">,</span> <span class="n">dPwz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_w</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_w</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_w</span><span class="o">.</span><span class="n">dz</span>
        <span class="n">dPcx</span><span class="p">,</span> <span class="n">dPcy</span><span class="p">,</span> <span class="n">dPcz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_c</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_c</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P_c</span><span class="o">.</span><span class="n">dz</span>
        <span class="n">dPx</span><span class="p">,</span> <span class="n">dPy</span><span class="p">,</span> <span class="n">dPz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span>
        <span class="n">Omega</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aeroLoads</span><span class="o">.</span><span class="n">Omega</span><span class="o">*</span><span class="n">RPM2RS</span>
        <span class="n">z_az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_az</span>


        <span class="n">dPx_dOmega</span> <span class="o">=</span> <span class="n">dPcx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">z_az</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">Omega</span><span class="o">*</span><span class="n">RPM2RS</span>
        <span class="n">dPy_dOmega</span> <span class="o">=</span> <span class="n">dPcy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">z_az</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">Omega</span><span class="o">*</span><span class="n">RPM2RS</span>
        <span class="n">dPz_dOmega</span> <span class="o">=</span> <span class="n">dPcz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">z_az</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">Omega</span><span class="o">*</span><span class="n">RPM2RS</span>

        <span class="n">dPx_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_dr</span><span class="p">)</span>
        <span class="n">dPy_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_dr</span><span class="p">)</span>
        <span class="n">dPz_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_dr</span><span class="p">)</span>

        <span class="n">dPx_dprecone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPwx</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPcx</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">])</span>
        <span class="n">dPy_dprecone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPwy</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPcy</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">])</span>
        <span class="n">dPz_dprecone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPwz</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPcz</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">])</span>

        <span class="n">dPx_dzaz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPcx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dPy_dzaz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPcy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dPz_dzaz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPcz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoA</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">dPx_drhoA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="o">-</span><span class="n">dPwx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">+</span> <span class="n">dPcx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">z_az</span><span class="p">)</span>
        <span class="n">dPy_drhoA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="o">-</span><span class="n">dPwy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">+</span> <span class="n">dPcy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">z_az</span><span class="p">)</span>
        <span class="n">dPz_drhoA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="o">-</span><span class="n">dPwz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">+</span> <span class="n">dPcz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Omega</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">z_az</span><span class="p">)</span>

        <span class="n">dPxaf_daeror</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeror</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeror</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeror</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPyaf_daeror</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeror</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeror</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeror</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPzaf_daeror</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeror</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeror</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeror</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPxaf_dPxaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeroPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPxaf_dPyaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeroPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPxaf_dPzaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeroPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPyaf_dPxaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeroPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPyaf_dPyaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeroPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPyaf_dPzaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeroPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPzaf_dPxaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPax_daeroPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPzaf_dPyaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPay_daeroPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPzaf_dPzaero</span> <span class="o">=</span> <span class="p">(</span><span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPaz_daeroPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPxaf_dOmega</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dOmega</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dOmega</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dOmega</span>
        <span class="n">dPyaf_dOmega</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dOmega</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dOmega</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dOmega</span>
        <span class="n">dPzaf_dOmega</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dOmega</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dOmega</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dOmega</span>

        <span class="n">dPxaf_dpitch</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">]</span>
        <span class="n">dPyaf_dpitch</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">]</span>
        <span class="n">dPzaf_dpitch</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">]</span>

        <span class="n">dPxaf_dazimuth</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwx</span><span class="p">[</span><span class="s">&#39;dazimuth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwy</span><span class="p">[</span><span class="s">&#39;dazimuth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwz</span><span class="p">[</span><span class="s">&#39;dazimuth&#39;</span><span class="p">]</span>
        <span class="n">dPyaf_dazimuth</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwx</span><span class="p">[</span><span class="s">&#39;dazimuth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwy</span><span class="p">[</span><span class="s">&#39;dazimuth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwz</span><span class="p">[</span><span class="s">&#39;dazimuth&#39;</span><span class="p">]</span>
        <span class="n">dPzaf_dazimuth</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwx</span><span class="p">[</span><span class="s">&#39;dazimuth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwy</span><span class="p">[</span><span class="s">&#39;dazimuth&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwz</span><span class="p">[</span><span class="s">&#39;dazimuth&#39;</span><span class="p">]</span>

        <span class="n">dPxaf_dr</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dr</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dr</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dr</span>
        <span class="n">dPyaf_dr</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dr</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dr</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dr</span>
        <span class="n">dPzaf_dr</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dr</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dr</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dr</span>

        <span class="n">dPxaf_dtheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">])</span>
        <span class="n">dPyaf_dtheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">])</span>
        <span class="n">dPzaf_dtheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">])</span>

        <span class="n">dPxaf_dtilt</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwx</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwy</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwz</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]</span>
        <span class="n">dPyaf_dtilt</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwx</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwy</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwz</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]</span>
        <span class="n">dPzaf_dtilt</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwx</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwy</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPwz</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]</span>

        <span class="n">dPxaf_dprecone</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dprecone</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dprecone</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dprecone</span>
        <span class="n">dPyaf_dprecone</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dprecone</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dprecone</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dprecone</span>
        <span class="n">dPzaf_dprecone</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dprecone</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dprecone</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dprecone</span>

        <span class="n">dPxaf_drhoA</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_drhoA</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_drhoA</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_drhoA</span>
        <span class="n">dPyaf_drhoA</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_drhoA</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_drhoA</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_drhoA</span>
        <span class="n">dPzaf_drhoA</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_drhoA</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_drhoA</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_drhoA</span>

        <span class="n">dPxaf_dzaz</span> <span class="o">=</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dzaz</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dzaz</span> <span class="o">+</span> <span class="n">dPx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dzaz</span>
        <span class="n">dPyaf_dzaz</span> <span class="o">=</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dzaz</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dzaz</span> <span class="o">+</span> <span class="n">dPy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dzaz</span>
        <span class="n">dPzaf_dzaz</span> <span class="o">=</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dzaz</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dzaz</span> <span class="o">+</span> <span class="n">dPz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dzaz</span>

        <span class="n">dPx</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dPxaf_daeror</span><span class="p">,</span> <span class="n">dPxaf_dPxaero</span><span class="p">,</span> <span class="n">dPxaf_dPyaero</span><span class="p">,</span> <span class="n">dPxaf_dPzaero</span><span class="p">,</span> <span class="n">dPxaf_dOmega</span><span class="p">,</span> <span class="n">dPxaf_dpitch</span><span class="p">,</span> <span class="n">dPxaf_dazimuth</span><span class="p">,</span>
            <span class="n">dPxaf_dr</span><span class="p">,</span> <span class="n">dPxaf_dtheta</span><span class="p">,</span> <span class="n">dPxaf_dtilt</span><span class="p">,</span> <span class="n">dPxaf_dprecone</span><span class="p">,</span> <span class="n">dPxaf_drhoA</span><span class="p">,</span> <span class="n">dPxaf_dzaz</span><span class="p">])</span>
        <span class="n">dPy</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dPyaf_daeror</span><span class="p">,</span> <span class="n">dPyaf_dPxaero</span><span class="p">,</span> <span class="n">dPyaf_dPyaero</span><span class="p">,</span> <span class="n">dPyaf_dPzaero</span><span class="p">,</span> <span class="n">dPyaf_dOmega</span><span class="p">,</span> <span class="n">dPyaf_dpitch</span><span class="p">,</span> <span class="n">dPyaf_dazimuth</span><span class="p">,</span>
            <span class="n">dPyaf_dr</span><span class="p">,</span> <span class="n">dPyaf_dtheta</span><span class="p">,</span> <span class="n">dPyaf_dtilt</span><span class="p">,</span> <span class="n">dPyaf_dprecone</span><span class="p">,</span> <span class="n">dPyaf_drhoA</span><span class="p">,</span> <span class="n">dPyaf_dzaz</span><span class="p">])</span>
        <span class="n">dPz</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dPzaf_daeror</span><span class="p">,</span> <span class="n">dPzaf_dPxaero</span><span class="p">,</span> <span class="n">dPzaf_dPyaero</span><span class="p">,</span> <span class="n">dPzaf_dPzaero</span><span class="p">,</span> <span class="n">dPzaf_dOmega</span><span class="p">,</span> <span class="n">dPzaf_dpitch</span><span class="p">,</span> <span class="n">dPzaf_dazimuth</span><span class="p">,</span>
            <span class="n">dPzaf_dr</span><span class="p">,</span> <span class="n">dPzaf_dtheta</span><span class="p">,</span> <span class="n">dPzaf_dtilt</span><span class="p">,</span> <span class="n">dPzaf_dprecone</span><span class="p">,</span> <span class="n">dPzaf_drhoA</span><span class="p">,</span> <span class="n">dPzaf_dzaz</span><span class="p">])</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">([</span><span class="n">dPx</span><span class="p">,</span> <span class="n">dPy</span><span class="p">,</span> <span class="n">dPz</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">J</span>





<span class="k">class</span> <span class="nc">TipDeflection</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="c"># variables</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection at tip in airfoil x-direction&#39;</span><span class="p">)</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection at tip in airfoil y-direction&#39;</span><span class="p">)</span>
    <span class="n">dz</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection at tip in airfoil z-direction&#39;</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;twist at tip section&#39;</span><span class="p">)</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;blade pitch angle&#39;</span><span class="p">)</span>
    <span class="n">azimuth</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;azimuth angle&#39;</span><span class="p">)</span>
    <span class="n">tilt</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;tilt angle&#39;</span><span class="p">)</span>
    <span class="n">totalConeTip</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;total coning angle including precone and curvature&#39;</span><span class="p">)</span>

    <span class="c"># parameters</span>
    <span class="n">dynamicFactor</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;a dynamic amplification factor to adjust the static deflection calculation&#39;</span><span class="p">)</span>

    <span class="c"># outputs</span>
    <span class="n">tip_deflection</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflection at tip in yaw x-direction&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>

        <span class="n">dr</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">airfoilToBlade</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">.</span><span class="n">bladeToAzimuth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalConeTip</span><span class="p">)</span> \
            <span class="o">.</span><span class="n">azimuthToHub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">azimuth</span><span class="p">)</span><span class="o">.</span><span class="n">hubToYaw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tilt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tip_deflection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">x</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;dx&#39;</span><span class="p">,</span> <span class="s">&#39;dy&#39;</span><span class="p">,</span> <span class="s">&#39;dz&#39;</span><span class="p">,</span> <span class="s">&#39;theta&#39;</span><span class="p">,</span> <span class="s">&#39;pitch&#39;</span><span class="p">,</span> <span class="s">&#39;azimuth&#39;</span><span class="p">,</span> <span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;totalConeTip&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;tip_deflection&#39;</span><span class="p">,)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span>
        <span class="n">dtheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">]</span>
        <span class="n">dpitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">]</span>
        <span class="n">dazimuth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dazimuth&#39;</span><span class="p">]</span>
        <span class="n">dtilt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]</span>
        <span class="n">dtotalConeTip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamicFactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">,</span> <span class="n">dtheta</span><span class="p">,</span> <span class="n">dpitch</span><span class="p">,</span> <span class="n">dazimuth</span><span class="p">,</span> <span class="n">dtilt</span><span class="p">,</span> <span class="n">dtotalConeTip</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">J</span>


<span class="c"># class ReverseTipDeflection(Component):</span>

<span class="c">#     # variables</span>
<span class="c">#     dx = Float(iotype=&#39;in&#39;)  # deflection at tip in airfoil c.s.</span>
<span class="c">#     dy = Float(iotype=&#39;in&#39;)</span>
<span class="c">#     dz = Float(iotype=&#39;in&#39;)</span>
<span class="c">#     theta = Float(iotype=&#39;in&#39;)</span>
<span class="c">#     pitch = Float(iotype=&#39;in&#39;)</span>
<span class="c">#     azimuth = Float(iotype=&#39;in&#39;)</span>
<span class="c">#     tilt = Float(iotype=&#39;in&#39;)</span>
<span class="c">#     precone = Float(iotype=&#39;in&#39;)</span>
<span class="c">#     yawW = Float(iotype=&#39;in&#39;)</span>

<span class="c">#     # parameters</span>
<span class="c">#     dynamicFactor = Float(1.2, iotype=&#39;in&#39;)</span>

<span class="c">#     # outputs</span>
<span class="c">#     tip_deflection = Float(iotype=&#39;out&#39;)</span>


<span class="c">#     def execute(self):</span>

<span class="c">#         theta = self.theta + self.pitch</span>

<span class="c">#         dr = DirectionVector(self.dx, self.dy, self.dz)</span>
<span class="c">#         self.delta = dr.airfoilToBlade(theta).bladeToAzimuth(self.precone) \</span>
<span class="c">#             .azimuthToHub(self.azimuth).hubToYaw(self.tilt).yawToWind(180.0-self.yawW)</span>

<span class="c">#         self.tip_deflection = self.dynamicFactor * self.delta.x</span>



<span class="k">class</span> <span class="nc">BladeDeflection</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="n">dx</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflections in airfoil x-direction&#39;</span><span class="p">)</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflections in airfoil y-direction&#39;</span><span class="p">)</span>
    <span class="n">dz</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;deflections in airfoil z-direction&#39;</span><span class="p">)</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;blade pitch angle&#39;</span><span class="p">)</span>
    <span class="n">theta_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;structural twist&#39;</span><span class="p">)</span>

    <span class="n">r_sub_precurve0</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;undeflected precurve locations (internal)&#39;</span><span class="p">)</span>
    <span class="n">Rhub0</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;hub radius&#39;</span><span class="p">)</span>
    <span class="n">r_str0</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;undeflected radial locations&#39;</span><span class="p">)</span>
    <span class="n">precurve_str0</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;undeflected precurve locations&#39;</span><span class="p">)</span>

    <span class="n">bladeLength0</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;original blade length (only an actual length if no curvature)&#39;</span><span class="p">)</span>

    <span class="n">delta_bladeLength</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;adjustment to blade length to account for curvature from loading&#39;</span><span class="p">)</span>
    <span class="n">delta_precurve_sub</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;adjustment to precurve to account for curvature from loading&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_str</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span>

        <span class="n">dr</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">airfoilToBlade</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">precurve_str_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">x</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">length0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rhub0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rhub0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">precurve_str_out</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">precurve_str_out</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                                           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shortening</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delta_bladeLength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortening</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c"># TODO: linearly interpolation is not C1 continuous.  it should work OK for now, but is not ideal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_precurve_sub</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_drsubpc0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_drstr0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_ddeltax</span> <span class="o">=</span> \
            <span class="n">interp_with_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_sub_precurve0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;dx&#39;</span><span class="p">,</span> <span class="s">&#39;dy&#39;</span><span class="p">,</span> <span class="s">&#39;dz&#39;</span><span class="p">,</span> <span class="s">&#39;pitch&#39;</span><span class="p">,</span> <span class="s">&#39;theta_str&#39;</span><span class="p">,</span> <span class="s">&#39;r_sub_precurve0&#39;</span><span class="p">,</span> <span class="s">&#39;Rhub0&#39;</span><span class="p">,</span>
            <span class="s">&#39;r_str0&#39;</span><span class="p">,</span> <span class="s">&#39;precurve_str0&#39;</span><span class="p">,</span> <span class="s">&#39;bladeLength0&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;delta_bladeLength&#39;</span><span class="p">,</span> <span class="s">&#39;delta_precurve_sub&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_str</span><span class="p">)</span>

        <span class="n">ddeltax_ddx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span>
        <span class="n">ddeltax_ddy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span>
        <span class="n">ddeltax_ddz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span>
        <span class="n">ddeltax_dtheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dtheta&#39;</span><span class="p">]</span>
        <span class="n">ddeltax_dthetastr</span> <span class="o">=</span> <span class="n">ddeltax_dtheta</span>
        <span class="n">ddeltax_dpitch</span> <span class="o">=</span> <span class="n">ddeltax_dtheta</span>

        <span class="n">dl0_drhub0</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">dl_drhub0</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">dl0_dprecurvestr0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">dl_dprecurvestr0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">dl0_drstr0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">dl_drstr0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="n">precurve_str_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="o">.</span><span class="n">x</span>


        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">sm0</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">sm</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">precurve_str_out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_str_out</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">sp0</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">precurve_str_out</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_str_out</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">dl0_dprecurvestr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">sm0</span> \
                <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">sp0</span>
            <span class="n">dl_dprecurvestr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">precurve_str_out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_str_out</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">sm</span> \
                <span class="o">-</span> <span class="p">(</span><span class="n">precurve_str_out</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_str_out</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">sp</span>
            <span class="n">dl0_drstr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">sm0</span> \
                <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">sp0</span>
            <span class="n">dl_drstr0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">sm</span> \
                <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">sp</span>

        <span class="n">sfirst0</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">sfirst</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">precurve_str_out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_str_out</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">slast0</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">slast</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">precurve_str_out</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_str_out</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dl0_dprecurvestr0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">sfirst0</span>
        <span class="n">dl0_dprecurvestr0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">precurve_str0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">slast0</span>
        <span class="n">dl_dprecurvestr0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">precurve_str_out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_str_out</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">sfirst</span>
        <span class="n">dl_dprecurvestr0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">precurve_str_out</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">precurve_str_out</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">slast</span>
        <span class="n">dl0_drstr0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">sfirst0</span>
        <span class="n">dl0_drstr0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">slast0</span>
        <span class="n">dl_drstr0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">sfirst</span>
        <span class="n">dl_drstr0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str0</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">slast</span>

        <span class="n">dl_ddeltax</span> <span class="o">=</span> <span class="n">dl_dprecurvestr0</span>
        <span class="n">dl_ddx</span> <span class="o">=</span> <span class="n">dl_ddeltax</span> <span class="o">*</span> <span class="n">ddeltax_ddx</span>
        <span class="n">dl_ddy</span> <span class="o">=</span> <span class="n">dl_ddeltax</span> <span class="o">*</span> <span class="n">ddeltax_ddy</span>
        <span class="n">dl_ddz</span> <span class="o">=</span> <span class="n">dl_ddeltax</span> <span class="o">*</span> <span class="n">ddeltax_ddz</span>
        <span class="n">dl_dthetastr</span> <span class="o">=</span> <span class="n">dl_ddeltax</span> <span class="o">*</span> <span class="n">ddeltax_dthetastr</span>
        <span class="n">dl_dpitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dl_ddeltax</span><span class="p">,</span> <span class="n">ddeltax_dpitch</span><span class="p">)</span>

        <span class="n">dshort_dl</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">length0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">dshort_dl0</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span>
        <span class="n">dshort_drhub0</span> <span class="o">=</span> <span class="n">dshort_dl0</span><span class="o">*</span><span class="n">dl0_drhub0</span> <span class="o">+</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_drhub0</span>
        <span class="n">dshort_dprecurvestr0</span> <span class="o">=</span> <span class="n">dshort_dl0</span><span class="o">*</span><span class="n">dl0_dprecurvestr0</span> <span class="o">+</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_dprecurvestr0</span>
        <span class="n">dshort_drstr0</span> <span class="o">=</span> <span class="n">dshort_dl0</span><span class="o">*</span><span class="n">dl0_drstr0</span> <span class="o">+</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_drstr0</span>
        <span class="n">dshort_ddx</span> <span class="o">=</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_ddx</span>
        <span class="n">dshort_ddy</span> <span class="o">=</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_ddy</span>
        <span class="n">dshort_ddz</span> <span class="o">=</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_ddz</span>
        <span class="n">dshort_dthetastr</span> <span class="o">=</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_dthetastr</span>
        <span class="n">dshort_dpitch</span> <span class="o">=</span> <span class="n">dshort_dl</span><span class="o">*</span><span class="n">dl_dpitch</span>

        <span class="n">dbl_dbl0</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortening</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">dbl_drhub0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_drhub0</span>
        <span class="n">dbl_dprecurvestr0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_dprecurvestr0</span>
        <span class="n">dbl_drstr0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_drstr0</span>
        <span class="n">dbl_ddx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_ddx</span>
        <span class="n">dbl_ddy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_ddy</span>
        <span class="n">dbl_ddz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_ddz</span>
        <span class="n">dbl_dthetastr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_dthetastr</span>
        <span class="n">dbl_dpitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bladeLength0</span> <span class="o">*</span> <span class="n">dshort_dpitch</span>

        <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_sub_precurve0</span><span class="p">)</span>
        <span class="n">dpcs_ddx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_ddeltax</span><span class="o">*</span><span class="n">ddeltax_ddx</span>
        <span class="n">dpcs_ddy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_ddeltax</span><span class="o">*</span><span class="n">ddeltax_ddy</span>
        <span class="n">dpcs_ddz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_ddeltax</span><span class="o">*</span><span class="n">ddeltax_ddz</span>
        <span class="n">dpcs_dpitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpcs_ddeltax</span><span class="p">,</span> <span class="n">ddeltax_dpitch</span><span class="p">)</span>
        <span class="n">dpcs_dthetastr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_ddeltax</span><span class="o">*</span><span class="n">ddeltax_dthetastr</span>

        <span class="n">dbl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">dbl_ddx</span><span class="p">,</span> <span class="n">dbl_ddy</span><span class="p">,</span> <span class="n">dbl_ddz</span><span class="p">,</span> <span class="p">[</span><span class="n">dbl_dpitch</span><span class="p">],</span> <span class="n">dbl_dthetastr</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="p">[</span><span class="n">dbl_drhub0</span><span class="p">],</span> <span class="n">dbl_drstr0</span><span class="p">,</span> <span class="n">dbl_dprecurvestr0</span><span class="p">,</span> <span class="p">[</span><span class="n">dbl_dbl0</span><span class="p">]])</span>
        <span class="n">dpcs</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="n">dpcs_ddx</span><span class="p">,</span> <span class="n">dpcs_ddy</span><span class="p">,</span> <span class="n">dpcs_ddz</span><span class="p">,</span> <span class="n">dpcs_dpitch</span><span class="p">,</span> <span class="n">dpcs_dthetastr</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_drsubpc0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpcs_drstr0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">)])</span>


        <span class="n">J</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">([</span><span class="n">dbl</span><span class="p">,</span> <span class="n">dpcs</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">J</span>


<span class="k">class</span> <span class="nc">RootMoment</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;blade root bending moment&quot;&quot;&quot;</span>

    <span class="n">r_str</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>
    <span class="n">aeroLoads</span> <span class="o">=</span> <span class="n">VarTree</span><span class="p">(</span><span class="n">AeroLoads</span><span class="p">(),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;aerodynamic loads in blade c.s.&#39;</span><span class="p">)</span>
    <span class="n">totalCone</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;total cone angle from precone and curvature&#39;</span><span class="p">)</span>
    <span class="n">x_az</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of blade in azimuth x-coordinate system&#39;</span><span class="p">)</span>
    <span class="n">y_az</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of blade in azimuth y-coordinate system&#39;</span><span class="p">)</span>
    <span class="n">z_az</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of blade in azimuth z-coordinate system&#39;</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;cumulative path length along blade&#39;</span><span class="p">)</span>

    <span class="n">root_bending_moment</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;total magnitude of bending moment at root of blade&#39;</span><span class="p">)</span>

    <span class="n">missing_deriv_policy</span> <span class="o">=</span> <span class="s">&#39;assume_zero&#39;</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_str</span>
        <span class="n">x_az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_az</span>
        <span class="n">y_az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_az</span>
        <span class="n">z_az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z_az</span>


        <span class="n">aL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aeroLoads</span>
        <span class="c"># TODO: linearly interpolation is not C1 continuous.  it should work OK for now, but is not ideal</span>
        <span class="n">Px</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPx_dr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalPx</span> <span class="o">=</span> <span class="n">interp_with_deriv</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">aL</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">aL</span><span class="o">.</span><span class="n">Px</span><span class="p">)</span>
        <span class="n">Py</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPy_dr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalPy</span> <span class="o">=</span> <span class="n">interp_with_deriv</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">aL</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">aL</span><span class="o">.</span><span class="n">Py</span><span class="p">)</span>
        <span class="n">Pz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPz_dr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalPz</span> <span class="o">=</span> <span class="n">interp_with_deriv</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">aL</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">aL</span><span class="o">.</span><span class="n">Pz</span><span class="p">)</span>

        <span class="c"># loads in azimuthal c.s.</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="n">Px</span><span class="p">,</span> <span class="n">Py</span><span class="p">,</span> <span class="n">Pz</span><span class="p">)</span><span class="o">.</span><span class="n">bladeToAzimuth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">totalCone</span><span class="p">)</span>

        <span class="c"># distributed bending load in azimuth coordinate ysstem</span>
        <span class="n">az</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="n">x_az</span><span class="p">,</span> <span class="n">y_az</span><span class="p">,</span> <span class="n">z_az</span><span class="p">)</span>
        <span class="n">Mp</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

        <span class="c"># integrate</span>
        <span class="n">Mx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Mp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="n">My</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Mp</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="n">Mz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Mp</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

        <span class="c"># get total magnitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Mx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">My</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Mz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>



        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">=</span> <span class="n">az</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mp</span> <span class="o">=</span> <span class="n">Mp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mx</span> <span class="o">=</span> <span class="n">Mx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">My</span> <span class="o">=</span> <span class="n">My</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span> <span class="o">=</span> <span class="n">Mz</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;r_str&#39;</span><span class="p">,</span> <span class="s">&#39;aeroLoads.r&#39;</span><span class="p">,</span> <span class="s">&#39;aeroLoads.Px&#39;</span><span class="p">,</span> <span class="s">&#39;aeroLoads.Py&#39;</span><span class="p">,</span> <span class="s">&#39;aeroLoads.Pz&#39;</span><span class="p">,</span> <span class="s">&#39;totalCone&#39;</span><span class="p">,</span>
                  <span class="s">&#39;x_az&#39;</span><span class="p">,</span> <span class="s">&#39;y_az&#39;</span><span class="p">,</span> <span class="s">&#39;z_az&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;root_bending_moment&#39;</span><span class="p">,)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># dx_dr = -sind(self.precone)</span>
        <span class="c"># dz_dr = cosd(self.precone)</span>

        <span class="c"># dx_dprecone = -self.r*cosd(self.precone)*math.pi/180.0</span>
        <span class="c"># dz_dprecone = -self.r*sind(self.precone)*math.pi/180.0</span>

        <span class="n">dPx_dr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPy_dr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPz_dr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPx_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPy_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPz_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPx_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPx_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPx_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPy_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPy_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPy_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dPz_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPx_dalPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPz_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPy_dalPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dPz_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dPz_dalPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


        <span class="c"># dazx_dr = np.diag(self.az.dx[&#39;dx&#39;]*dx_dr + self.az.dx[&#39;dz&#39;]*dz_dr)</span>
        <span class="c"># dazy_dr = np.diag(self.az.dy[&#39;dx&#39;]*dx_dr + self.az.dy[&#39;dz&#39;]*dz_dr)</span>
        <span class="c"># dazz_dr = np.diag(self.az.dz[&#39;dx&#39;]*dx_dr + self.az.dz[&#39;dz&#39;]*dz_dr)</span>

        <span class="c"># dazx_dprecone = (self.az.dx[&#39;dx&#39;]*dx_dprecone.T + self.az.dx[&#39;dz&#39;]*dz_dprecone.T).T</span>
        <span class="c"># dazy_dprecone = (self.az.dy[&#39;dx&#39;]*dx_dprecone.T + self.az.dy[&#39;dz&#39;]*dz_dprecone.T).T</span>
        <span class="c"># dazz_dprecone = (self.az.dz[&#39;dx&#39;]*dx_dprecone.T + self.az.dz[&#39;dz&#39;]*dz_dprecone.T).T</span>

        <span class="n">dMpx</span><span class="p">,</span> <span class="n">dMpy</span><span class="p">,</span> <span class="n">dMpz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="o">.</span><span class="n">cross_deriv_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">namea</span><span class="o">=</span><span class="s">&#39;az&#39;</span><span class="p">,</span> <span class="n">nameb</span><span class="o">=</span><span class="s">&#39;P&#39;</span><span class="p">)</span>

        <span class="n">dMpx_dr</span> <span class="o">=</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dr</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpy_dr</span> <span class="o">=</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dr</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpz_dr</span> <span class="o">=</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dr</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dMpx_dtotalcone</span> <span class="o">=</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpy_dtotalcone</span> <span class="o">=</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpz_dtotalcone</span> <span class="o">=</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dprecone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dMpx_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpy_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpz_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalr</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalr</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dMpx_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPx</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPx</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpy_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPx</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPx</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpz_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPx</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPx</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPx</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dMpx_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPy</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPy</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpy_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPy</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPy</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpz_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPy</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPy</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dMpx_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPz</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPz</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpy_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPz</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPz</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">dMpz_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPx&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPx_dalPz</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPy&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPy_dalPz</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dPz&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dPz_dalPz</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">dMx_dMpx</span><span class="p">,</span> <span class="n">dMx_ds</span> <span class="o">=</span> <span class="n">trapz_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="n">dMy_dMpy</span><span class="p">,</span> <span class="n">dMy_ds</span> <span class="o">=</span> <span class="n">trapz_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mp</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="n">dMz_dMpz</span><span class="p">,</span> <span class="n">dMz_ds</span> <span class="o">=</span> <span class="n">trapz_deriv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mp</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>

        <span class="n">dMx_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMx_dMpx</span><span class="p">,</span> <span class="n">dMpx_dr</span><span class="p">)</span>
        <span class="n">dMy_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMy_dMpy</span><span class="p">,</span> <span class="n">dMpy_dr</span><span class="p">)</span>
        <span class="n">dMz_dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMz_dMpz</span><span class="p">,</span> <span class="n">dMpz_dr</span><span class="p">)</span>

        <span class="n">dMx_dalr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMx_dMpx</span><span class="p">,</span> <span class="n">dMpx_dalr</span><span class="p">)</span>
        <span class="n">dMy_dalr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMy_dMpy</span><span class="p">,</span> <span class="n">dMpy_dalr</span><span class="p">)</span>
        <span class="n">dMz_dalr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMz_dMpz</span><span class="p">,</span> <span class="n">dMpz_dalr</span><span class="p">)</span>

        <span class="n">dMx_dalPx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMx_dMpx</span><span class="p">,</span> <span class="n">dMpx_dalPx</span><span class="p">)</span>
        <span class="n">dMy_dalPx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMy_dMpy</span><span class="p">,</span> <span class="n">dMpy_dalPx</span><span class="p">)</span>
        <span class="n">dMz_dalPx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMz_dMpz</span><span class="p">,</span> <span class="n">dMpz_dalPx</span><span class="p">)</span>

        <span class="n">dMx_dalPy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMx_dMpx</span><span class="p">,</span> <span class="n">dMpx_dalPy</span><span class="p">)</span>
        <span class="n">dMy_dalPy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMy_dMpy</span><span class="p">,</span> <span class="n">dMpy_dalPy</span><span class="p">)</span>
        <span class="n">dMz_dalPy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMz_dMpz</span><span class="p">,</span> <span class="n">dMpz_dalPy</span><span class="p">)</span>

        <span class="n">dMx_dalPz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMx_dMpx</span><span class="p">,</span> <span class="n">dMpx_dalPz</span><span class="p">)</span>
        <span class="n">dMy_dalPz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMy_dMpy</span><span class="p">,</span> <span class="n">dMpy_dalPz</span><span class="p">)</span>
        <span class="n">dMz_dalPz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dMz_dMpz</span><span class="p">,</span> <span class="n">dMpz_dalPz</span><span class="p">)</span>

        <span class="n">dMx_dtotalcone</span> <span class="o">=</span> <span class="n">dMx_dMpx</span> <span class="o">*</span> <span class="n">dMpx_dtotalcone</span>
        <span class="n">dMy_dtotalcone</span> <span class="o">=</span> <span class="n">dMy_dMpy</span> <span class="o">*</span> <span class="n">dMpy_dtotalcone</span>
        <span class="n">dMz_dtotalcone</span> <span class="o">=</span> <span class="n">dMz_dMpz</span> <span class="o">*</span> <span class="n">dMpz_dtotalcone</span>

        <span class="n">dMx_dazx</span> <span class="o">=</span> <span class="n">dMx_dMpx</span> <span class="o">*</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dazx&#39;</span><span class="p">]</span>
        <span class="n">dMx_dazy</span> <span class="o">=</span> <span class="n">dMx_dMpx</span> <span class="o">*</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dazy&#39;</span><span class="p">]</span>
        <span class="n">dMx_dazz</span> <span class="o">=</span> <span class="n">dMx_dMpx</span> <span class="o">*</span> <span class="n">dMpx</span><span class="p">[</span><span class="s">&#39;dazz&#39;</span><span class="p">]</span>

        <span class="n">dMy_dazx</span> <span class="o">=</span> <span class="n">dMy_dMpy</span> <span class="o">*</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dazx&#39;</span><span class="p">]</span>
        <span class="n">dMy_dazy</span> <span class="o">=</span> <span class="n">dMy_dMpy</span> <span class="o">*</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dazy&#39;</span><span class="p">]</span>
        <span class="n">dMy_dazz</span> <span class="o">=</span> <span class="n">dMy_dMpy</span> <span class="o">*</span> <span class="n">dMpy</span><span class="p">[</span><span class="s">&#39;dazz&#39;</span><span class="p">]</span>

        <span class="n">dMz_dazx</span> <span class="o">=</span> <span class="n">dMz_dMpz</span> <span class="o">*</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dazx&#39;</span><span class="p">]</span>
        <span class="n">dMz_dazy</span> <span class="o">=</span> <span class="n">dMz_dMpz</span> <span class="o">*</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dazy&#39;</span><span class="p">]</span>
        <span class="n">dMz_dazz</span> <span class="o">=</span> <span class="n">dMz_dMpz</span> <span class="o">*</span> <span class="n">dMpz</span><span class="p">[</span><span class="s">&#39;dazz&#39;</span><span class="p">]</span>

        <span class="n">drbm_dr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dr</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dalr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dalr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dalr</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dalr</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dalPx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dalPx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dalPx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dalPx</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dalPy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dalPy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dalPy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dalPy</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dalPz</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dalPz</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dalPz</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dalPz</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dtotalcone</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dtotalcone</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dtotalcone</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dtotalcone</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dazx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dazx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dazx</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dazx</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dazy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dazy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dazy</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dazy</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_dazz</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_dazz</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_dazz</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_dazz</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>
        <span class="n">drbm_ds</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mx</span><span class="o">*</span><span class="n">dMx_ds</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="o">*</span><span class="n">dMy_ds</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mz</span><span class="o">*</span><span class="n">dMz_ds</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">root_bending_moment</span>


        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">drbm_dr</span><span class="p">,</span> <span class="n">drbm_dalr</span><span class="p">,</span> <span class="n">drbm_dalPx</span><span class="p">,</span> <span class="n">drbm_dalPy</span><span class="p">,</span> <span class="n">drbm_dalPz</span><span class="p">,</span>
            <span class="n">drbm_dtotalcone</span><span class="p">,</span> <span class="n">drbm_dazx</span><span class="p">,</span> <span class="n">drbm_dazy</span><span class="p">,</span> <span class="n">drbm_dazz</span><span class="p">,</span> <span class="n">drbm_ds</span><span class="p">])])</span>

        <span class="k">return</span> <span class="n">J</span>



<span class="k">class</span> <span class="nc">MassProperties</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="c"># variables</span>
    <span class="n">blade_mass</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass of one blade&#39;</span><span class="p">)</span>
    <span class="n">blade_moment_of_inertia</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg*m**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass moment of inertia of blade about hub&#39;</span><span class="p">)</span>
    <span class="n">tilt</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;rotor tilt angle (used to translate moments of inertia from hub to yaw c.s.&#39;</span><span class="p">)</span>

    <span class="c"># parameters</span>
    <span class="n">nBlades</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of blades&#39;</span><span class="p">)</span>

    <span class="c"># outputs</span>
    <span class="n">mass_all_blades</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass of all blades&#39;</span><span class="p">)</span>
    <span class="n">I_all_blades</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass moments of inertia of all blades in yaw c.s. order:Ixx, Iyy, Izz, Ixy, Ixz, Iyz&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mass_all_blades</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">blade_mass</span>

        <span class="n">Ibeam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">blade_moment_of_inertia</span>

        <span class="n">Ixx</span> <span class="o">=</span> <span class="n">Ibeam</span>
        <span class="n">Iyy</span> <span class="o">=</span> <span class="n">Ibeam</span><span class="o">/</span><span class="mf">2.0</span>  <span class="c"># azimuthal average for 2 blades, exact for 3+</span>
        <span class="n">Izz</span> <span class="o">=</span> <span class="n">Ibeam</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">Ixy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Ixz</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Iyz</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># azimuthal average for 2 blades, exact for 3+</span>

        <span class="c"># rotate to yaw c.s.</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">DirectionVector</span><span class="p">(</span><span class="n">Ixx</span><span class="p">,</span> <span class="n">Iyy</span><span class="p">,</span> <span class="n">Izz</span><span class="p">)</span><span class="o">.</span><span class="n">hubToYaw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tilt</span><span class="p">)</span>  <span class="c"># because off-diagonal components are all zero</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">I_all_blades</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">I</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">I</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">I</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">Ixy</span><span class="p">,</span> <span class="n">Ixz</span><span class="p">,</span> <span class="n">Iyz</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ivec</span> <span class="o">=</span> <span class="n">I</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;blade_mass&#39;</span><span class="p">,</span> <span class="s">&#39;blade_moment_of_inertia&#39;</span><span class="p">,</span> <span class="s">&#39;tilt&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;mass_all_blades&#39;</span><span class="p">,</span> <span class="s">&#39;I_all_blades&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ivec</span>

        <span class="n">dIx_dmoi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span><span class="o">*</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">dIy_dmoi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span><span class="o">*</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">dIz_dmoi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span><span class="o">*</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dx&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dy&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">I</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dz&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

        <span class="n">dm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="n">dIxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dIx_dmoi</span><span class="p">,</span> <span class="n">I</span><span class="o">.</span><span class="n">dx</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]])</span>
        <span class="n">dIyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dIy_dmoi</span><span class="p">,</span> <span class="n">I</span><span class="o">.</span><span class="n">dy</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]])</span>
        <span class="n">dIzz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">dIz_dmoi</span><span class="p">,</span> <span class="n">I</span><span class="o">.</span><span class="n">dz</span><span class="p">[</span><span class="s">&#39;dtilt&#39;</span><span class="p">]])</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">([</span><span class="n">dm</span><span class="p">,</span> <span class="n">dIxx</span><span class="p">,</span> <span class="n">dIyy</span><span class="p">,</span> <span class="n">dIzz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))])</span>

        <span class="k">return</span> <span class="n">J</span>


<span class="k">class</span> <span class="nc">TurbineClass</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="c"># parameters</span>
    <span class="n">turbine_class</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="s">&#39;II&#39;</span><span class="p">,</span> <span class="s">&#39;III&#39;</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;IEC turbine class&#39;</span><span class="p">)</span>

    <span class="c"># outputs should be constant</span>
    <span class="n">V_mean</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;IEC mean wind speed for Rayleigh distribution&#39;</span><span class="p">)</span>
    <span class="n">V_extreme</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;IEC extreme wind speed at hub height&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbine_class</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">Vref</span> <span class="o">=</span> <span class="mf">50.0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbine_class</span> <span class="o">==</span> <span class="s">&#39;II&#39;</span><span class="p">:</span>
            <span class="n">Vref</span> <span class="o">=</span> <span class="mf">42.5</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbine_class</span> <span class="o">==</span> <span class="s">&#39;III&#39;</span><span class="p">:</span>
            <span class="n">Vref</span> <span class="o">=</span> <span class="mf">37.5</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">V_mean</span> <span class="o">=</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">Vref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_extreme</span> <span class="o">=</span> <span class="mf">1.4</span><span class="o">*</span><span class="n">Vref</span>



<span class="k">class</span> <span class="nc">ExtremeLoads</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="c"># variables</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">((</span><span class="mi">2</span><span class="p">,)),</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;rotor thrust, index 0 is at worst-case, index 1 feathered&#39;</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">((</span><span class="mi">2</span><span class="p">,)),</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;rotor torque, index 0 is at worst-case, index 1 feathered&#39;</span><span class="p">)</span>

    <span class="c"># parameters</span>
    <span class="n">nBlades</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of blades&#39;</span><span class="p">)</span>

    <span class="c"># outputs</span>
    <span class="n">T_extreme</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;rotor thrust at survival wind condition&#39;</span><span class="p">)</span>
    <span class="n">Q_extreme</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;rotor torque at survival wind condition&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T_extreme</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q_extreme</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">,</span> <span class="s">&#39;Q&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;T_extreme&#39;</span><span class="p">,</span> <span class="s">&#39;Q_extreme&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nBlades</span><span class="p">)</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="o">/</span><span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                      <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">]])</span>

        <span class="k">return</span> <span class="n">J</span>




<span class="k">class</span> <span class="nc">GustETM</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="c"># variables</span>
    <span class="n">V_mean</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;IEC average wind speed for turbine class&#39;</span><span class="p">)</span>
    <span class="n">V_hub</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;hub height wind speed&#39;</span><span class="p">)</span>

    <span class="c"># parameters</span>
    <span class="n">turbulence_class</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;IEC turbulence class&#39;</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of standard deviations for strength of gust&#39;</span><span class="p">)</span>

    <span class="c"># out</span>
    <span class="n">V_gust</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;gust wind speed&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_class</span> <span class="o">==</span> <span class="s">&#39;A&#39;</span><span class="p">:</span>
            <span class="n">Iref</span> <span class="o">=</span> <span class="mf">0.16</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_class</span> <span class="o">==</span> <span class="s">&#39;B&#39;</span><span class="p">:</span>
            <span class="n">Iref</span> <span class="o">=</span> <span class="mf">0.14</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">turbulence_class</span> <span class="o">==</span> <span class="s">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">Iref</span> <span class="o">=</span> <span class="mf">0.12</span>

        <span class="n">c</span> <span class="o">=</span> <span class="mf">2.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">Iref</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.072</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V_mean</span><span class="o">/</span><span class="n">c</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V_hub</span><span class="o">/</span><span class="n">c</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_gust</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_hub</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Iref</span> <span class="o">=</span> <span class="n">Iref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>


    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;V_mean&#39;</span><span class="p">,</span> <span class="s">&#39;V_hub&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;V_gust&#39;</span><span class="p">,</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>


    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Iref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Iref</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">Iref</span><span class="o">*</span><span class="mf">0.072</span><span class="o">/</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V_hub</span><span class="o">/</span><span class="n">c</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)),</span>
            <span class="mf">1.0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">std</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">Iref</span><span class="o">*</span><span class="mf">0.072</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V_mean</span><span class="o">/</span><span class="n">c</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="n">c</span><span class="p">)]])</span>

        <span class="k">return</span> <span class="n">J</span>




<span class="k">class</span> <span class="nc">SetupPCModVarSpeed</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="n">control</span> <span class="o">=</span> <span class="n">VarTree</span><span class="p">(</span><span class="n">VarSpeedMachine</span><span class="p">(),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;control parameters&#39;</span><span class="p">)</span>
    <span class="n">Vrated</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;rated wind speed&#39;</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;rotor radius&#39;</span><span class="p">)</span>
    <span class="n">Vfactor</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fraction of rated speed at which the deflection is assumed to representative throughout the power curve calculation&#39;</span><span class="p">)</span>

    <span class="n">Uhub</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;freestream velocities to run&#39;</span><span class="p">)</span>
    <span class="n">Omega</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;rpm&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;rotation speeds to run&#39;</span><span class="p">)</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;pitch angles to run&#39;</span><span class="p">)</span>

    <span class="n">missing_deriv_policy</span> <span class="o">=</span> <span class="s">&#39;assume_zero&#39;</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Uhub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vfactor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vrated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">tsr</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Uhub</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">RS2RPM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">pitch</span>

    <span class="k">def</span> <span class="nf">list_deriv_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">inputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;control.tsr&#39;</span><span class="p">,</span> <span class="s">&#39;Vrated&#39;</span><span class="p">,</span> <span class="s">&#39;R&#39;</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;Uhub&#39;</span><span class="p">,</span> <span class="s">&#39;Omega&#39;</span><span class="p">,</span> <span class="s">&#39;pitch&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span>

    <span class="k">def</span> <span class="nf">provideJ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">dU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vfactor</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="n">dOmega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Uhub</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">RS2RPM</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">tsr</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Vfactor</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="n">RS2RPM</span><span class="p">,</span>
            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">tsr</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Uhub</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">RS2RPM</span><span class="p">])</span>
        <span class="n">dpitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">J</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">([</span><span class="n">dU</span><span class="p">,</span> <span class="n">dOmega</span><span class="p">,</span> <span class="n">dpitch</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">J</span>


<span class="k">class</span> <span class="nc">RotorSE</span><span class="p">(</span><span class="n">Assembly</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;rotor model&quot;&quot;&quot;</span>

    <span class="c"># --- geometry inputs ---</span>
    <span class="n">initial_aero_grid</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;initial aerodynamic grid on unit radius&#39;</span><span class="p">)</span>
    <span class="n">initial_str_grid</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;initial structural grid on unit radius&#39;</span><span class="p">)</span>
    <span class="n">idx_cylinder_aero</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;first idx in r_aero_unit of non-cylindrical section, constant twist inboard of here&#39;</span><span class="p">)</span>
    <span class="n">idx_cylinder_str</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;first idx in r_str_unit of non-cylindrical section&#39;</span><span class="p">)</span>
    <span class="n">hubFraction</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;hub location as fraction of radius&#39;</span><span class="p">)</span>
    <span class="n">r_aero</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;new aerodynamic grid on unit radius&#39;</span><span class="p">)</span>
    <span class="n">r_max_chord</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;location of max chord on unit radius&#39;</span><span class="p">)</span>
    <span class="n">chord_sub</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;chord at control points. defined at hub, then at linearly spaced locations from r_max_chord to tip&#39;</span><span class="p">)</span>
    <span class="n">theta_sub</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;twist at control points.  defined at linearly spaced locations from r[idx_cylinder] to tip&#39;</span><span class="p">)</span>
    <span class="n">precurve_sub</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;precurve at control points.  defined at same locations at chord, starting at 2nd control point (root must be zero precurve)&#39;</span><span class="p">)</span>
    <span class="n">delta_precurve_sub</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;adjustment to precurve to account for curvature from loading&#39;</span><span class="p">)</span>
    <span class="n">bladeLength</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">deriv_ignore</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;blade length (if not precurved or swept) otherwise length of blade before curvature&#39;</span><span class="p">)</span>
    <span class="n">delta_bladeLength</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;adjustment to blade length to account for curvature from loading&#39;</span><span class="p">)</span>
    <span class="n">precone</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;precone angle&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">deriv_ignore</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">tilt</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;shaft tilt&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">deriv_ignore</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">yaw</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;yaw error&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">deriv_ignore</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">nBlades</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of blades&#39;</span><span class="p">,</span> <span class="n">deriv_ignore</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">airfoil_files</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Str</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;names of airfoil file&#39;</span><span class="p">,</span> <span class="n">deriv_ignore</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c"># --- atmosphere inputs ---</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.225</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/m**3&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;density of air&#39;</span><span class="p">,</span> <span class="n">deriv_ignore</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.81206e-5</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg/m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;dynamic viscosity of air&#39;</span><span class="p">,</span> <span class="n">deriv_ignore</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">shearExp</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;shear exponent&#39;</span><span class="p">,</span> <span class="n">deriv_ignore</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">hubHt</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;hub height&#39;</span><span class="p">)</span>
    <span class="n">turbine_class</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="s">&#39;II&#39;</span><span class="p">,</span> <span class="s">&#39;III&#39;</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;IEC turbine class&#39;</span><span class="p">)</span>
    <span class="n">turbulence_class</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;C&#39;</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;IEC turbulence class class&#39;</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">9.81</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s**2&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;acceleration of gravity&#39;</span><span class="p">,</span> <span class="n">deriv_ignore</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">cdf_reference_height_wind_speed</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;reference hub height for IEC wind speed (used in CDF calculation)&#39;</span><span class="p">)</span>
    <span class="c"># cdf_reference_mean_wind_speed = Float(iotype=&#39;in&#39;)</span>
    <span class="c"># weibull_shape = Float(iotype=&#39;in&#39;)</span>

    <span class="n">VfactorPC</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fraction of rated speed at which the deflection is assumed to representative throughout the power curve calculation&#39;</span><span class="p">)</span>


    <span class="c"># --- composite sections ---</span>
    <span class="n">sparT</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;spar cap thickness parameters&#39;</span><span class="p">)</span>
    <span class="n">teT</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;trailing-edge thickness parameters&#39;</span><span class="p">)</span>
    <span class="n">chord_str_ref</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;chord distribution for reference section, thickness of structural layup scaled with reference thickness (fixed t/c for this case)&#39;</span><span class="p">)</span>
    <span class="n">leLoc</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;array of leading-edge positions from a reference blade axis </span><span class="se">\</span>
<span class="s">        (usually blade pitch axis). locations are normalized by the local chord length.  </span><span class="se">\</span>
<span class="s">        e.g. leLoc[i] = 0.2 means leading edge is 0.2*chord[i] from reference axis.   </span><span class="se">\</span>
<span class="s">        positive in -x direction for airfoil-aligned coordinate system&#39;</span><span class="p">)</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Profile</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;airfoil shape at each radial position&#39;</span><span class="p">)</span>
    <span class="n">materials</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Orthotropic2DMaterial</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of all Orthotropic2DMaterial objects used in defining the geometry&#39;</span><span class="p">)</span>
    <span class="n">upperCS</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">CompositeSection</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of CompositeSection objections defining the properties for upper surface&#39;</span><span class="p">)</span>
    <span class="n">lowerCS</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">CompositeSection</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of CompositeSection objections defining the properties for lower surface&#39;</span><span class="p">)</span>
    <span class="n">websCS</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">CompositeSection</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span>
        <span class="n">desc</span><span class="o">=</span><span class="s">&#39;list of CompositeSection objections defining the properties for shear webs&#39;</span><span class="p">)</span>
    <span class="n">sector_idx_strain_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;index of sector for spar (PreComp definition of sector)&#39;</span><span class="p">)</span>
    <span class="n">sector_idx_strain_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;index of sector for trailing-edge (PreComp definition of sector)&#39;</span><span class="p">)</span>


    <span class="c"># --- control ---</span>
    <span class="n">control</span> <span class="o">=</span> <span class="n">VarTree</span><span class="p">(</span><span class="n">VarSpeedMachine</span><span class="p">(),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;control parameters&#39;</span><span class="p">)</span>
    <span class="n">pitch_extreme</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;worst-case pitch at survival wind condition&#39;</span><span class="p">)</span>
    <span class="n">azimuth_extreme</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;deg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;worst-case azimuth at survival wind condition&#39;</span><span class="p">)</span>

    <span class="c"># --- drivetrain efficiency ---</span>
    <span class="n">drivetrainType</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s">&#39;geared&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;geared&#39;</span><span class="p">,</span> <span class="s">&#39;single_stage&#39;</span><span class="p">,</span> <span class="s">&#39;multi_drive&#39;</span><span class="p">,</span> <span class="s">&#39;pm_direct_drive&#39;</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">)</span>

    <span class="c"># --- fatigue ---</span>
    <span class="n">rstar_damage</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;nondimensional radial locations of damage equivalent moments&#39;</span><span class="p">)</span>
    <span class="n">Mxb_damage</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;damage equivalent moments about blade c.s. x-direction&#39;</span><span class="p">)</span>
    <span class="n">Myb_damage</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;damage equivalent moments about blade c.s. y-direction&#39;</span><span class="p">)</span>
    <span class="n">strain_ult_spar</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;ultimate strain in spar cap&#39;</span><span class="p">)</span>
    <span class="n">strain_ult_te</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mi">2500</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;uptimate strain in trailing-edge panels&#39;</span><span class="p">)</span>
    <span class="n">eta_damage</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.755</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;safety factor for fatigue&#39;</span><span class="p">)</span>
    <span class="n">m_damage</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;slope of S-N curve for fatigue analysis&#39;</span><span class="p">)</span>
    <span class="n">N_damage</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="o">*</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of cycles used in fatigue analysis&#39;</span><span class="p">)</span>

    <span class="c"># --- options ---</span>
    <span class="n">nSector</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of sectors to divide rotor face into in computing thrust and power&#39;</span><span class="p">)</span>
    <span class="n">npts_coarse_power_curve</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of points to evaluate aero analysis at&#39;</span><span class="p">)</span>
    <span class="n">npts_spline_power_curve</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of points to use in fitting spline to power curve&#39;</span><span class="p">)</span>
    <span class="n">AEP_loss_factor</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;availability and other losses (soiling, array, etc.)&#39;</span><span class="p">)</span>
    <span class="n">dynamic_amplication_tip_deflection</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;a dynamic amplification factor to adjust the static deflection calculation&#39;</span><span class="p">)</span>
    <span class="n">nF</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;number of natural frequencies to compute&#39;</span><span class="p">)</span>

    <span class="c"># --- outputs ---</span>
    <span class="n">AEP</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kW*h&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;annual energy production&#39;</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;wind speeds (power curve)&#39;</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;W&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;power (power curve)&#39;</span><span class="p">)</span>
    <span class="n">ratedConditions</span> <span class="o">=</span> <span class="n">VarTree</span><span class="p">(</span><span class="n">RatedConditions</span><span class="p">(),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;conditions at rated speed&#39;</span><span class="p">)</span>
    <span class="n">hub_diameter</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;hub diameter&#39;</span><span class="p">)</span>
    <span class="n">diameter</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;rotor diameter&#39;</span><span class="p">)</span>
    <span class="n">V_extreme</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m/s&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;survival wind speed&#39;</span><span class="p">)</span>
    <span class="n">T_extreme</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;thrust at survival wind condition&#39;</span><span class="p">)</span>
    <span class="n">Q_extreme</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;thrust at survival wind condition&#39;</span><span class="p">)</span>

    <span class="c"># structural outputs</span>
    <span class="n">mass_one_blade</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass of one blade&#39;</span><span class="p">)</span>
    <span class="n">mass_all_blades</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;kg&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;mass of all blade&#39;</span><span class="p">)</span>
    <span class="n">I_all_blades</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;out of plane moments of inertia in yaw-aligned c.s.&#39;</span><span class="p">)</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;1st nF natural frequencies&#39;</span><span class="p">)</span>
    <span class="n">freq_curvefem</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;1st nF natural frequencies&#39;</span><span class="p">)</span>
    <span class="n">tip_deflection</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;blade tip deflection in +x_y direction&#39;</span><span class="p">)</span>
    <span class="n">strainU_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
    <span class="n">strainL_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
    <span class="n">strainU_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
    <span class="n">strainL_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;axial strain and specified locations&#39;</span><span class="p">)</span>
    <span class="n">eps_crit_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;critical strain in spar from panel buckling calculation&#39;</span><span class="p">)</span>
    <span class="n">eps_crit_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;critical strain in trailing-edge panels from panel buckling calculation&#39;</span><span class="p">)</span>
    <span class="n">root_bending_moment</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;N*m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;total magnitude of bending moment at root of blade&#39;</span><span class="p">)</span>
    <span class="n">damageU_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fatigue damage on upper surface in spar cap&#39;</span><span class="p">)</span>
    <span class="n">damageL_spar</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fatigue damage on lower surface in spar cap&#39;</span><span class="p">)</span>
    <span class="n">damageU_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fatigue damage on upper surface in trailing-edge panels&#39;</span><span class="p">)</span>
    <span class="n">damageL_te</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;fatigue damage on lower surface in trailing-edge panels&#39;</span><span class="p">)</span>
    <span class="n">delta_bladeLength_out</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;adjustment to blade length to account for curvature from loading&#39;</span><span class="p">)</span>
    <span class="n">delta_precurve_sub_out</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;adjustment to precurve to account for curvature from loading&#39;</span><span class="p">)</span>

    <span class="c"># internal use outputs</span>
    <span class="n">Rtip</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;tip location in z_b&#39;</span><span class="p">)</span>
    <span class="n">precurveTip</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;tip location in x_b&#39;</span><span class="p">)</span>
    <span class="n">presweepTip</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s">&#39;tip location in y_b&#39;</span><span class="p">)</span>  <span class="c"># TODO: connect later</span>


    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;turbineclass&#39;</span><span class="p">,</span> <span class="n">TurbineClass</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;gridsetup&#39;</span><span class="p">,</span> <span class="n">GridSetup</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;grid&#39;</span><span class="p">,</span> <span class="n">RGrid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;spline0&#39;</span><span class="p">,</span> <span class="n">GeometrySpline</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;spline&#39;</span><span class="p">,</span> <span class="n">GeometrySpline</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;geom&#39;</span><span class="p">,</span> <span class="n">CCBladeGeometry</span><span class="p">())</span>
        <span class="c"># self.add(&#39;tipspeed&#39;, MaxTipSpeed())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;setup&#39;</span><span class="p">,</span> <span class="n">SetupRunVarSpeed</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;analysis&#39;</span><span class="p">,</span> <span class="n">CCBlade</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;dt&#39;</span><span class="p">,</span> <span class="n">CSMDrivetrain</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;powercurve&#39;</span><span class="p">,</span> <span class="n">RegulatedPowerCurve</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;brent&#39;</span><span class="p">,</span> <span class="n">Brent</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;wind&#39;</span><span class="p">,</span> <span class="n">PowerWind</span><span class="p">())</span>
        <span class="c"># self.add(&#39;cdf&#39;, WeibullWithMeanCDF())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;cdf&#39;</span><span class="p">,</span> <span class="n">RayleighCDF</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;aep&#39;</span><span class="p">,</span> <span class="n">AEP</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">brent</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s">&#39;powercurve&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s">&#39;turbineclass&#39;</span><span class="p">,</span> <span class="s">&#39;gridsetup&#39;</span><span class="p">,</span> <span class="s">&#39;grid&#39;</span><span class="p">,</span> <span class="s">&#39;spline0&#39;</span><span class="p">,</span> <span class="s">&#39;spline&#39;</span><span class="p">,</span>
            <span class="s">&#39;geom&#39;</span><span class="p">,</span> <span class="s">&#39;setup&#39;</span><span class="p">,</span> <span class="s">&#39;analysis&#39;</span><span class="p">,</span> <span class="s">&#39;dt&#39;</span><span class="p">,</span> <span class="s">&#39;brent&#39;</span><span class="p">,</span> <span class="s">&#39;wind&#39;</span><span class="p">,</span> <span class="s">&#39;cdf&#39;</span><span class="p">,</span> <span class="s">&#39;aep&#39;</span><span class="p">])</span>

        <span class="c"># connections to turbineclass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;turbine_class&#39;</span><span class="p">,</span> <span class="s">&#39;turbineclass.turbine_class&#39;</span><span class="p">)</span>

        <span class="c"># connections to gridsetup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;initial_aero_grid&#39;</span><span class="p">,</span> <span class="s">&#39;gridsetup.initial_aero_grid&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;initial_str_grid&#39;</span><span class="p">,</span> <span class="s">&#39;gridsetup.initial_str_grid&#39;</span><span class="p">)</span>

        <span class="c"># connections to grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;r_aero&#39;</span><span class="p">,</span> <span class="s">&#39;grid.r_aero&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gridsetup.fraction&#39;</span><span class="p">,</span> <span class="s">&#39;grid.fraction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gridsetup.idxj&#39;</span><span class="p">,</span> <span class="s">&#39;grid.idxj&#39;</span><span class="p">)</span>

        <span class="c"># connections to spline0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;r_aero&#39;</span><span class="p">,</span> <span class="s">&#39;spline0.r_aero_unit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;grid.r_str&#39;</span><span class="p">,</span> <span class="s">&#39;spline0.r_str_unit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;r_max_chord&#39;</span><span class="p">,</span> <span class="s">&#39;spline0.r_max_chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;chord_sub&#39;</span><span class="p">,</span> <span class="s">&#39;spline0.chord_sub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;theta_sub&#39;</span><span class="p">,</span> <span class="s">&#39;spline0.theta_sub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;precurve_sub&#39;</span><span class="p">,</span> <span class="s">&#39;spline0.precurve_sub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;bladeLength&#39;</span><span class="p">,</span> <span class="s">&#39;spline0.bladeLength&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;idx_cylinder_aero&#39;</span><span class="p">,</span> <span class="s">&#39;spline0.idx_cylinder_aero&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;idx_cylinder_str&#39;</span><span class="p">,</span> <span class="s">&#39;spline0.idx_cylinder_str&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hubFraction&#39;</span><span class="p">,</span> <span class="s">&#39;spline0.hubFraction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;sparT&#39;</span><span class="p">,</span> <span class="s">&#39;spline0.sparT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;teT&#39;</span><span class="p">,</span> <span class="s">&#39;spline0.teT&#39;</span><span class="p">)</span>

        <span class="c"># connections to spline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;r_aero&#39;</span><span class="p">,</span> <span class="s">&#39;spline.r_aero_unit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;grid.r_str&#39;</span><span class="p">,</span> <span class="s">&#39;spline.r_str_unit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;r_max_chord&#39;</span><span class="p">,</span> <span class="s">&#39;spline.r_max_chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;chord_sub&#39;</span><span class="p">,</span> <span class="s">&#39;spline.chord_sub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;theta_sub&#39;</span><span class="p">,</span> <span class="s">&#39;spline.theta_sub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;precurve_sub + delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s">&#39;spline.precurve_sub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;bladeLength + delta_bladeLength&#39;</span><span class="p">,</span> <span class="s">&#39;spline.bladeLength&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;idx_cylinder_aero&#39;</span><span class="p">,</span> <span class="s">&#39;spline.idx_cylinder_aero&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;idx_cylinder_str&#39;</span><span class="p">,</span> <span class="s">&#39;spline.idx_cylinder_str&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hubFraction&#39;</span><span class="p">,</span> <span class="s">&#39;spline.hubFraction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;sparT&#39;</span><span class="p">,</span> <span class="s">&#39;spline.sparT&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;teT&#39;</span><span class="p">,</span> <span class="s">&#39;spline.teT&#39;</span><span class="p">)</span>

        <span class="c"># connections to geom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">precurve_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.Rtip&#39;</span><span class="p">,</span> <span class="s">&#39;geom.Rtip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;precone&#39;</span><span class="p">,</span> <span class="s">&#39;geom.precone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_str[-1]&#39;</span><span class="p">,</span> <span class="s">&#39;geom.precurveTip&#39;</span><span class="p">)</span>

        <span class="c"># # connectiosn to tipspeed</span>
        <span class="c"># self.connect(&#39;geom.R&#39;, &#39;tipspeed.R&#39;)</span>
        <span class="c"># self.connect(&#39;max_tip_speed&#39;, &#39;tipspeed.Vtip_max&#39;)</span>
        <span class="c"># self.connect(&#39;tipspeed.Omega_max&#39;, &#39;control.maxOmega&#39;)</span>

        <span class="c"># connections to setup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;control&#39;</span><span class="p">,</span> <span class="s">&#39;setup.control&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geom.R&#39;</span><span class="p">,</span> <span class="s">&#39;setup.R&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;npts_coarse_power_curve&#39;</span><span class="p">,</span> <span class="s">&#39;setup.npts&#39;</span><span class="p">)</span>

        <span class="c"># connections to analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.r_aero&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.chord_aero&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.theta_aero&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_aero&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.precurve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_str[-1]&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.precurveTip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.Rhub&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.Rhub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.Rtip&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.Rtip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hubHt&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.hubHt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;precone&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.precone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;yaw&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.yaw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;airfoil_files&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.airfoil_files&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rho&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.rho&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;mu&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.mu&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;shearExp&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.shearExp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nSector&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.nSector&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;setup.Uhub&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.Uhub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;setup.Omega&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.Omega&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;setup.pitch&#39;</span><span class="p">,</span> <span class="s">&#39;analysis.pitch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">run_case</span> <span class="o">=</span> <span class="s">&#39;power&#39;</span>

        <span class="c"># connections to drivetrain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;analysis.P&#39;</span><span class="p">,</span> <span class="s">&#39;dt.aeroPower&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;analysis.Q&#39;</span><span class="p">,</span> <span class="s">&#39;dt.aeroTorque&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;analysis.T&#39;</span><span class="p">,</span> <span class="s">&#39;dt.aeroThrust&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;control.ratedPower&#39;</span><span class="p">,</span> <span class="s">&#39;dt.ratedPower&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;drivetrainType&#39;</span><span class="p">,</span> <span class="s">&#39;dt.drivetrainType&#39;</span><span class="p">)</span>

        <span class="c"># connections to powercurve</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;control&#39;</span><span class="p">,</span> <span class="s">&#39;powercurve.control&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;setup.Uhub&#39;</span><span class="p">,</span> <span class="s">&#39;powercurve.Vcoarse&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;dt.power&#39;</span><span class="p">,</span> <span class="s">&#39;powercurve.Pcoarse&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;analysis.T&#39;</span><span class="p">,</span> <span class="s">&#39;powercurve.Tcoarse&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geom.R&#39;</span><span class="p">,</span> <span class="s">&#39;powercurve.R&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;npts_spline_power_curve&#39;</span><span class="p">,</span> <span class="s">&#39;powercurve.npts&#39;</span><span class="p">)</span>

        <span class="c"># setup Brent method to find rated speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;control.Vin&#39;</span><span class="p">,</span> <span class="s">&#39;brent.lower_bound&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;control.Vout&#39;</span><span class="p">,</span> <span class="s">&#39;brent.upper_bound&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brent</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;powercurve.Vrated&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=-</span><span class="mf">1e-15</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1e15</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brent</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s">&#39;powercurve.residual = 0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brent</span><span class="o">.</span><span class="n">invalid_bracket_return</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c"># connections to wind</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c"># self.connect(&#39;cdf_reference_mean_wind_speed&#39;, &#39;wind.Uref&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;turbineclass.V_mean&#39;</span><span class="p">,</span> <span class="s">&#39;wind.Uref&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;cdf_reference_height_wind_speed&#39;</span><span class="p">,</span> <span class="s">&#39;wind.zref&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hubHt&#39;</span><span class="p">,</span> <span class="s">&#39;wind.z[0]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;shearExp&#39;</span><span class="p">,</span> <span class="s">&#39;wind.shearExp&#39;</span><span class="p">)</span>

        <span class="c"># connections to cdf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;powercurve.V&#39;</span><span class="p">,</span> <span class="s">&#39;cdf.x&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;wind.U[0]&#39;</span><span class="p">,</span> <span class="s">&#39;cdf.xbar&#39;</span><span class="p">)</span>
        <span class="c"># self.connect(&#39;weibull_shape&#39;, &#39;cdf.k&#39;)</span>

        <span class="c"># connections to aep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;cdf.F&#39;</span><span class="p">,</span> <span class="s">&#39;aep.CDF_V&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;powercurve.P&#39;</span><span class="p">,</span> <span class="s">&#39;aep.P&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;AEP_loss_factor&#39;</span><span class="p">,</span> <span class="s">&#39;aep.lossFactor&#39;</span><span class="p">)</span>

        <span class="c"># connections to outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;powercurve.V&#39;</span><span class="p">,</span> <span class="s">&#39;V&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;powercurve.P&#39;</span><span class="p">,</span> <span class="s">&#39;P&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;aep.AEP&#39;</span><span class="p">,</span> <span class="s">&#39;AEP&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;powercurve.ratedConditions&#39;</span><span class="p">,</span> <span class="s">&#39;ratedConditions&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;2*spline.Rhub&#39;</span><span class="p">,</span> <span class="s">&#39;hub_diameter&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;2*geom.R&#39;</span><span class="p">,</span> <span class="s">&#39;diameter&#39;</span><span class="p">)</span>


        <span class="c"># --- add structures ---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;curvature&#39;</span><span class="p">,</span> <span class="n">BladeCurvature</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;resize&#39;</span><span class="p">,</span> <span class="n">ResizeCompositeSection</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;gust&#39;</span><span class="p">,</span> <span class="n">GustETM</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;setuppc&#39;</span><span class="p">,</span>  <span class="n">SetupPCModVarSpeed</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;aero_rated&#39;</span><span class="p">,</span> <span class="n">CCBlade</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;aero_extrm&#39;</span><span class="p">,</span> <span class="n">CCBlade</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;aero_extrm_forces&#39;</span><span class="p">,</span> <span class="n">CCBlade</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;aero_defl_powercurve&#39;</span><span class="p">,</span> <span class="n">CCBlade</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;beam&#39;</span><span class="p">,</span> <span class="n">PreCompSections</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;loads_defl&#39;</span><span class="p">,</span> <span class="n">TotalLoads</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;loads_pc_defl&#39;</span><span class="p">,</span> <span class="n">TotalLoads</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;loads_strain&#39;</span><span class="p">,</span> <span class="n">TotalLoads</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;damage&#39;</span><span class="p">,</span> <span class="n">DamageLoads</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;struc&#39;</span><span class="p">,</span> <span class="n">RotorWithpBEAM</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;curvefem&#39;</span><span class="p">,</span> <span class="n">CurveFEM</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;tip&#39;</span><span class="p">,</span> <span class="n">TipDeflection</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;root_moment&#39;</span><span class="p">,</span> <span class="n">RootMoment</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;mass&#39;</span><span class="p">,</span> <span class="n">MassProperties</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;extreme&#39;</span><span class="p">,</span> <span class="n">ExtremeLoads</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;blade_defl&#39;</span><span class="p">,</span> <span class="n">BladeDeflection</span><span class="p">())</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s">&#39;curvature&#39;</span><span class="p">,</span> <span class="s">&#39;resize&#39;</span><span class="p">,</span> <span class="s">&#39;gust&#39;</span><span class="p">,</span> <span class="s">&#39;setuppc&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm&#39;</span><span class="p">,</span>
            <span class="s">&#39;aero_extrm_forces&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve&#39;</span><span class="p">,</span> <span class="s">&#39;beam&#39;</span><span class="p">,</span> <span class="s">&#39;loads_defl&#39;</span><span class="p">,</span> <span class="s">&#39;loads_pc_defl&#39;</span><span class="p">,</span>
            <span class="s">&#39;loads_strain&#39;</span><span class="p">,</span> <span class="s">&#39;damage&#39;</span><span class="p">,</span> <span class="s">&#39;struc&#39;</span><span class="p">,</span> <span class="s">&#39;curvefem&#39;</span><span class="p">,</span> <span class="s">&#39;tip&#39;</span><span class="p">,</span> <span class="s">&#39;root_moment&#39;</span><span class="p">,</span> <span class="s">&#39;mass&#39;</span><span class="p">,</span> <span class="s">&#39;extreme&#39;</span><span class="p">,</span>
            <span class="s">&#39;blade_defl&#39;</span><span class="p">])</span>

        <span class="c"># connections to curvature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.r_str&#39;</span><span class="p">,</span> <span class="s">&#39;curvature.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_str&#39;</span><span class="p">,</span> <span class="s">&#39;curvature.precurve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.presweep_str&#39;</span><span class="p">,</span> <span class="s">&#39;curvature.presweep&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;precone&#39;</span><span class="p">,</span> <span class="s">&#39;curvature.precone&#39;</span><span class="p">)</span>


        <span class="c"># connections to resize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;upperCS&#39;</span><span class="p">,</span> <span class="s">&#39;resize.upperCSIn&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;lowerCS&#39;</span><span class="p">,</span> <span class="s">&#39;resize.lowerCSIn&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;websCS&#39;</span><span class="p">,</span> <span class="s">&#39;resize.websCSIn&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;chord_str_ref&#39;</span><span class="p">,</span> <span class="s">&#39;resize.chord_str_ref&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;sector_idx_strain_spar&#39;</span><span class="p">,</span> <span class="s">&#39;resize.sector_idx_strain_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;sector_idx_strain_te&#39;</span><span class="p">,</span> <span class="s">&#39;resize.sector_idx_strain_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.chord_str&#39;</span><span class="p">,</span> <span class="s">&#39;resize.chord_str&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.sparT_str&#39;</span><span class="p">,</span> <span class="s">&#39;resize.sparT_str&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.teT_str&#39;</span><span class="p">,</span> <span class="s">&#39;resize.teT_str&#39;</span><span class="p">)</span>

        <span class="c"># connections to gust</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;turbulence_class&#39;</span><span class="p">,</span> <span class="s">&#39;gust.turbulence_class&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;turbineclass.V_mean&#39;</span><span class="p">,</span> <span class="s">&#39;gust.V_mean&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;powercurve.ratedConditions.V&#39;</span><span class="p">,</span> <span class="s">&#39;gust.V_hub&#39;</span><span class="p">)</span>

        <span class="c"># connections to setuppc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;control&#39;</span><span class="p">,</span> <span class="s">&#39;setuppc.control&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;powercurve.ratedConditions.V&#39;</span><span class="p">,</span> <span class="s">&#39;setuppc.Vrated&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;geom.R&#39;</span><span class="p">,</span> <span class="s">&#39;setuppc.R&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;VfactorPC&#39;</span><span class="p">,</span> <span class="s">&#39;setuppc.Vfactor&#39;</span><span class="p">)</span>

        <span class="c"># connections to aero_rated (for max deflection)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.r_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.chord_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.theta_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.precurve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_str[-1]&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.precurveTip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.Rhub&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.Rhub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.Rtip&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.Rtip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hubHt&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.hubHt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;precone&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.precone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;yaw&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.yaw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;airfoil_files&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.airfoil_files&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rho&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.rho&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;mu&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.mu&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;shearExp&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.shearExp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nSector&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.nSector&#39;</span><span class="p">)</span>
        <span class="c"># self.connect(&#39;powercurve.ratedConditions.V + 3*gust.sigma&#39;, &#39;aero_rated.V_load&#39;)  # OpenMDAO bug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;gust.V_gust&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.V_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;powercurve.ratedConditions.Omega&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.Omega_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;powercurve.ratedConditions.pitch&#39;</span><span class="p">,</span> <span class="s">&#39;aero_rated.pitch_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_rated</span><span class="o">.</span><span class="n">azimuth_load</span> <span class="o">=</span> <span class="mf">180.0</span>  <span class="c"># closest to tower</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_rated</span><span class="o">.</span><span class="n">run_case</span> <span class="o">=</span> <span class="s">&#39;loads&#39;</span>

        <span class="c"># connections to aero_extrm (for max strain)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.r_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.chord_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.theta_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.precurve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_str[-1]&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.precurveTip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.Rhub&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.Rhub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.Rtip&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.Rtip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hubHt&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.hubHt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;precone&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.precone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;yaw&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.yaw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;airfoil_files&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.airfoil_files&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rho&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.rho&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;mu&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.mu&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;shearExp&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.shearExp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nSector&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.nSector&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;turbineclass.V_extreme&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.V_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;pitch_extreme&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.pitch_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;azimuth_extreme&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm.azimuth_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm</span><span class="o">.</span><span class="n">Omega_load</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># parked case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm</span><span class="o">.</span><span class="n">run_case</span> <span class="o">=</span> <span class="s">&#39;loads&#39;</span>

        <span class="c"># connections to aero_extrm_forces (for tower thrust)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.r_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.chord_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.theta_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.precurve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_str[-1]&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.precurveTip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.Rhub&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.Rhub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.Rtip&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.Rtip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hubHt&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.hubHt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;precone&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.precone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;yaw&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.yaw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;airfoil_files&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.airfoil_files&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rho&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.rho&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;mu&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.mu&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;shearExp&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.shearExp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nSector&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.nSector&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">Uhub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c"># parked case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;turbineclass.V_extreme&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.Uhub[0]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;turbineclass.V_extreme&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.Uhub[1]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;pitch_extreme&#39;</span><span class="p">,</span> <span class="s">&#39;aero_extrm_forces.pitch[0]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">pitch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span>  <span class="c"># feathered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">run_case</span> <span class="o">=</span> <span class="s">&#39;power&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_extrm_forces</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="c"># connections to aero_defl_powercurve (for gust reversal)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.r_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.chord_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.theta_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_aero&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.precurve&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_str[-1]&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.precurveTip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.Rhub&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.Rhub&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.Rtip&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.Rtip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;hubHt&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.hubHt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;precone&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.precone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;yaw&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.yaw&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;airfoil_files&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.airfoil_files&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.B&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rho&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.rho&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;mu&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.mu&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;shearExp&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.shearExp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nSector&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.nSector&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;setuppc.Uhub&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.V_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;setuppc.Omega&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.Omega_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;setuppc.pitch&#39;</span><span class="p">,</span> <span class="s">&#39;aero_defl_powercurve.pitch_load&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_defl_powercurve</span><span class="o">.</span><span class="n">azimuth_load</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aero_defl_powercurve</span><span class="o">.</span><span class="n">run_case</span> <span class="o">=</span> <span class="s">&#39;loads&#39;</span>

        <span class="c"># connections to beam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.r_str&#39;</span><span class="p">,</span> <span class="s">&#39;beam.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.chord_str&#39;</span><span class="p">,</span> <span class="s">&#39;beam.chord&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.theta_str&#39;</span><span class="p">,</span> <span class="s">&#39;beam.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;leLoc&#39;</span><span class="p">,</span> <span class="s">&#39;beam.leLoc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;profile&#39;</span><span class="p">,</span> <span class="s">&#39;beam.profile&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;materials&#39;</span><span class="p">,</span> <span class="s">&#39;beam.materials&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;resize.upperCSOut&#39;</span><span class="p">,</span> <span class="s">&#39;beam.upperCS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;resize.lowerCSOut&#39;</span><span class="p">,</span> <span class="s">&#39;beam.lowerCS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;resize.websCSOut&#39;</span><span class="p">,</span> <span class="s">&#39;beam.websCS&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;sector_idx_strain_spar&#39;</span><span class="p">,</span> <span class="s">&#39;beam.sector_idx_strain_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;sector_idx_strain_te&#39;</span><span class="p">,</span> <span class="s">&#39;beam.sector_idx_strain_te&#39;</span><span class="p">)</span>


        <span class="c"># connections to loads_defl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;aero_rated.loads&#39;</span><span class="p">,</span> <span class="s">&#39;loads_defl.aeroLoads&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.properties.z&#39;</span><span class="p">,</span> <span class="s">&#39;loads_defl.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.theta_str&#39;</span><span class="p">,</span> <span class="s">&#39;loads_defl.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;loads_defl.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvature.totalCone&#39;</span><span class="p">,</span> <span class="s">&#39;loads_defl.totalCone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvature.z_az&#39;</span><span class="p">,</span> <span class="s">&#39;loads_defl.z_az&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.properties.rhoA&#39;</span><span class="p">,</span> <span class="s">&#39;loads_defl.rhoA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;loads_defl.g&#39;</span><span class="p">)</span>

        <span class="c"># connections to loads_pc_defl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;aero_defl_powercurve.loads&#39;</span><span class="p">,</span> <span class="s">&#39;loads_pc_defl.aeroLoads&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.properties.z&#39;</span><span class="p">,</span> <span class="s">&#39;loads_pc_defl.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.theta_str&#39;</span><span class="p">,</span> <span class="s">&#39;loads_pc_defl.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;loads_pc_defl.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvature.totalCone&#39;</span><span class="p">,</span> <span class="s">&#39;loads_pc_defl.totalCone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvature.z_az&#39;</span><span class="p">,</span> <span class="s">&#39;loads_pc_defl.z_az&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.properties.rhoA&#39;</span><span class="p">,</span> <span class="s">&#39;loads_pc_defl.rhoA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;loads_pc_defl.g&#39;</span><span class="p">)</span>


        <span class="c"># connections to loads_strain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;aero_extrm.loads&#39;</span><span class="p">,</span> <span class="s">&#39;loads_strain.aeroLoads&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.properties.z&#39;</span><span class="p">,</span> <span class="s">&#39;loads_strain.r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.theta_str&#39;</span><span class="p">,</span> <span class="s">&#39;loads_strain.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;loads_strain.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvature.totalCone&#39;</span><span class="p">,</span> <span class="s">&#39;loads_strain.totalCone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvature.z_az&#39;</span><span class="p">,</span> <span class="s">&#39;loads_strain.z_az&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.properties.rhoA&#39;</span><span class="p">,</span> <span class="s">&#39;loads_strain.rhoA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;loads_strain.g&#39;</span><span class="p">)</span>


        <span class="c"># connections to damage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;rstar_damage&#39;</span><span class="p">,</span> <span class="s">&#39;damage.rstar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;Mxb_damage&#39;</span><span class="p">,</span> <span class="s">&#39;damage.Mxb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;Myb_damage&#39;</span><span class="p">,</span> <span class="s">&#39;damage.Myb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.theta_str&#39;</span><span class="p">,</span> <span class="s">&#39;damage.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.properties.z&#39;</span><span class="p">,</span> <span class="s">&#39;damage.r&#39;</span><span class="p">)</span>


        <span class="c"># connections to struc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.properties&#39;</span><span class="p">,</span> <span class="s">&#39;struc.beam&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nF&#39;</span><span class="p">,</span> <span class="s">&#39;struc.nF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;loads_defl.Px_af&#39;</span><span class="p">,</span> <span class="s">&#39;struc.Px_defl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;loads_defl.Py_af&#39;</span><span class="p">,</span> <span class="s">&#39;struc.Py_defl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;loads_defl.Pz_af&#39;</span><span class="p">,</span> <span class="s">&#39;struc.Pz_defl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;loads_pc_defl.Px_af&#39;</span><span class="p">,</span> <span class="s">&#39;struc.Px_pc_defl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;loads_pc_defl.Py_af&#39;</span><span class="p">,</span> <span class="s">&#39;struc.Py_pc_defl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;loads_pc_defl.Pz_af&#39;</span><span class="p">,</span> <span class="s">&#39;struc.Pz_pc_defl&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;loads_strain.Px_af&#39;</span><span class="p">,</span> <span class="s">&#39;struc.Px_strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;loads_strain.Py_af&#39;</span><span class="p">,</span> <span class="s">&#39;struc.Py_strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;loads_strain.Pz_af&#39;</span><span class="p">,</span> <span class="s">&#39;struc.Pz_strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.xu_strain_spar&#39;</span><span class="p">,</span> <span class="s">&#39;struc.xu_strain_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.xl_strain_spar&#39;</span><span class="p">,</span> <span class="s">&#39;struc.xl_strain_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.yu_strain_spar&#39;</span><span class="p">,</span> <span class="s">&#39;struc.yu_strain_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.yl_strain_spar&#39;</span><span class="p">,</span> <span class="s">&#39;struc.yl_strain_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.xu_strain_te&#39;</span><span class="p">,</span> <span class="s">&#39;struc.xu_strain_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.xl_strain_te&#39;</span><span class="p">,</span> <span class="s">&#39;struc.xl_strain_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.yu_strain_te&#39;</span><span class="p">,</span> <span class="s">&#39;struc.yu_strain_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.yl_strain_te&#39;</span><span class="p">,</span> <span class="s">&#39;struc.yl_strain_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;damage.Mxa&#39;</span><span class="p">,</span> <span class="s">&#39;struc.Mx_damage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;damage.Mya&#39;</span><span class="p">,</span> <span class="s">&#39;struc.My_damage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;strain_ult_spar&#39;</span><span class="p">,</span> <span class="s">&#39;struc.strain_ult_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;strain_ult_te&#39;</span><span class="p">,</span> <span class="s">&#39;struc.strain_ult_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;eta_damage&#39;</span><span class="p">,</span> <span class="s">&#39;struc.eta_damage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;m_damage&#39;</span><span class="p">,</span> <span class="s">&#39;struc.m_damage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;N_damage&#39;</span><span class="p">,</span> <span class="s">&#39;struc.N_damage&#39;</span><span class="p">)</span>

        <span class="c"># connections to curvefem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;powercurve.ratedConditions.Omega&#39;</span><span class="p">,</span> <span class="s">&#39;curvefem.Omega&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.properties&#39;</span><span class="p">,</span> <span class="s">&#39;curvefem.beam&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.theta_str&#39;</span><span class="p">,</span> <span class="s">&#39;curvefem.theta_str&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_str&#39;</span><span class="p">,</span> <span class="s">&#39;curvefem.precurve_str&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.presweep_str&#39;</span><span class="p">,</span> <span class="s">&#39;curvefem.presweep_str&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nF&#39;</span><span class="p">,</span> <span class="s">&#39;curvefem.nF&#39;</span><span class="p">)</span>

        <span class="c"># connections to tip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">struc</span><span class="o">.</span><span class="n">dx_defl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">struc</span><span class="o">.</span><span class="n">dy_defl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">struc</span><span class="o">.</span><span class="n">dz_defl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">theta_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curvature</span><span class="o">.</span><span class="n">totalCone</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.dx_defl[-1]&#39;</span><span class="p">,</span> <span class="s">&#39;tip.dx&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.dy_defl[-1]&#39;</span><span class="p">,</span> <span class="s">&#39;tip.dy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.dz_defl[-1]&#39;</span><span class="p">,</span> <span class="s">&#39;tip.dz&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.theta_str[-1]&#39;</span><span class="p">,</span> <span class="s">&#39;tip.theta&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;aero_rated.loads.pitch&#39;</span><span class="p">,</span> <span class="s">&#39;tip.pitch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;aero_rated.loads.azimuth&#39;</span><span class="p">,</span> <span class="s">&#39;tip.azimuth&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;tip.tilt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvature.totalCone[-1]&#39;</span><span class="p">,</span> <span class="s">&#39;tip.totalConeTip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;dynamic_amplication_tip_deflection&#39;</span><span class="p">,</span> <span class="s">&#39;tip.dynamicFactor&#39;</span><span class="p">)</span>


        <span class="c"># connections to root moment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.r_str&#39;</span><span class="p">,</span> <span class="s">&#39;root_moment.r_str&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;aero_rated.loads&#39;</span><span class="p">,</span> <span class="s">&#39;root_moment.aeroLoads&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvature.totalCone&#39;</span><span class="p">,</span> <span class="s">&#39;root_moment.totalCone&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvature.x_az&#39;</span><span class="p">,</span> <span class="s">&#39;root_moment.x_az&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvature.y_az&#39;</span><span class="p">,</span> <span class="s">&#39;root_moment.y_az&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvature.z_az&#39;</span><span class="p">,</span> <span class="s">&#39;root_moment.z_az&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvature.s&#39;</span><span class="p">,</span> <span class="s">&#39;root_moment.s&#39;</span><span class="p">)</span>


        <span class="c"># connections to mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.blade_mass&#39;</span><span class="p">,</span> <span class="s">&#39;mass.blade_mass&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.blade_moment_of_inertia&#39;</span><span class="p">,</span> <span class="s">&#39;mass.blade_moment_of_inertia&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s">&#39;mass.nBlades&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tilt&#39;</span><span class="p">,</span> <span class="s">&#39;mass.tilt&#39;</span><span class="p">)</span>

        <span class="c"># connectsion to extreme</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;aero_extrm_forces.T&#39;</span><span class="p">,</span> <span class="s">&#39;extreme.T&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;aero_extrm_forces.Q&#39;</span><span class="p">,</span> <span class="s">&#39;extreme.Q&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;nBlades&#39;</span><span class="p">,</span> <span class="s">&#39;extreme.nBlades&#39;</span><span class="p">)</span>

        <span class="c"># connections to blade_defl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.dx_pc_defl&#39;</span><span class="p">,</span> <span class="s">&#39;blade_defl.dx&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.dy_pc_defl&#39;</span><span class="p">,</span> <span class="s">&#39;blade_defl.dy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.dz_pc_defl&#39;</span><span class="p">,</span> <span class="s">&#39;blade_defl.dz&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;aero_defl_powercurve.loads.pitch&#39;</span><span class="p">,</span> <span class="s">&#39;blade_defl.pitch&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline0.theta_str&#39;</span><span class="p">,</span> <span class="s">&#39;blade_defl.theta_str&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline0.r_sub_precurve&#39;</span><span class="p">,</span> <span class="s">&#39;blade_defl.r_sub_precurve0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline0.Rhub&#39;</span><span class="p">,</span> <span class="s">&#39;blade_defl.Rhub0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline0.r_str&#39;</span><span class="p">,</span> <span class="s">&#39;blade_defl.r_str0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline0.precurve_str&#39;</span><span class="p">,</span> <span class="s">&#39;blade_defl.precurve_str0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;bladeLength&#39;</span><span class="p">,</span> <span class="s">&#39;blade_defl.bladeLength0&#39;</span><span class="p">)</span>
        <span class="c"># self.connect(&#39;precurve_sub&#39;, &#39;blade_defl.precurve_sub0&#39;)</span>

        <span class="c"># connect to outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;turbineclass.V_extreme&#39;</span><span class="p">,</span> <span class="s">&#39;V_extreme&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;extreme.T_extreme&#39;</span><span class="p">,</span> <span class="s">&#39;T_extreme&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;extreme.Q_extreme&#39;</span><span class="p">,</span> <span class="s">&#39;Q_extreme&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.blade_mass&#39;</span><span class="p">,</span> <span class="s">&#39;mass_one_blade&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;mass.mass_all_blades&#39;</span><span class="p">,</span> <span class="s">&#39;mass_all_blades&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;mass.I_all_blades&#39;</span><span class="p">,</span> <span class="s">&#39;I_all_blades&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.freq&#39;</span><span class="p">,</span> <span class="s">&#39;freq&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;curvefem.freq&#39;</span><span class="p">,</span> <span class="s">&#39;freq_curvefem&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;tip.tip_deflection&#39;</span><span class="p">,</span> <span class="s">&#39;tip_deflection&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.strainU_spar&#39;</span><span class="p">,</span> <span class="s">&#39;strainU_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.strainL_spar&#39;</span><span class="p">,</span> <span class="s">&#39;strainL_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.strainU_te&#39;</span><span class="p">,</span> <span class="s">&#39;strainU_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.strainL_te&#39;</span><span class="p">,</span> <span class="s">&#39;strainL_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;root_moment.root_bending_moment&#39;</span><span class="p">,</span> <span class="s">&#39;root_bending_moment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.eps_crit_spar&#39;</span><span class="p">,</span> <span class="s">&#39;eps_crit_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;beam.eps_crit_te&#39;</span><span class="p">,</span> <span class="s">&#39;eps_crit_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.damageU_spar&#39;</span><span class="p">,</span> <span class="s">&#39;damageU_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.damageL_spar&#39;</span><span class="p">,</span> <span class="s">&#39;damageL_spar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.damageU_te&#39;</span><span class="p">,</span> <span class="s">&#39;damageU_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;struc.damageL_te&#39;</span><span class="p">,</span> <span class="s">&#39;damageL_te&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;blade_defl.delta_bladeLength&#39;</span><span class="p">,</span> <span class="s">&#39;delta_bladeLength_out&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;blade_defl.delta_precurve_sub&#39;</span><span class="p">,</span> <span class="s">&#39;delta_precurve_sub_out&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.Rtip&#39;</span><span class="p">,</span> <span class="s">&#39;Rtip&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;spline.precurve_str[-1]&#39;</span><span class="p">,</span> <span class="s">&#39;precurveTip&#39;</span><span class="p">)</span>



<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="c"># === import and instantiate ===</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="c"># from rotorse.rotor import RotorSE  (include this line)</span>

    <span class="n">rotor</span> <span class="o">=</span> <span class="n">RotorSE</span><span class="p">()</span>
    <span class="c"># -------------------</span>

    <span class="c"># === blade grid ===</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">initial_aero_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.02222276</span><span class="p">,</span> <span class="mf">0.06666667</span><span class="p">,</span> <span class="mf">0.11111057</span><span class="p">,</span> <span class="mf">0.16666667</span><span class="p">,</span> <span class="mf">0.23333333</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.36666667</span><span class="p">,</span>
        <span class="mf">0.43333333</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.56666667</span><span class="p">,</span> <span class="mf">0.63333333</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.76666667</span><span class="p">,</span> <span class="mf">0.83333333</span><span class="p">,</span> <span class="mf">0.88888943</span><span class="p">,</span> <span class="mf">0.93333333</span><span class="p">,</span>
        <span class="mf">0.97777724</span><span class="p">])</span>  <span class="c"># (Array): initial aerodynamic grid on unit radius</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">initial_str_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.00492790457512</span><span class="p">,</span> <span class="mf">0.00652942887106</span><span class="p">,</span> <span class="mf">0.00813095316699</span><span class="p">,</span> <span class="mf">0.00983257273154</span><span class="p">,</span>
        <span class="mf">0.0114340970275</span><span class="p">,</span> <span class="mf">0.0130356213234</span><span class="p">,</span> <span class="mf">0.02222276</span><span class="p">,</span> <span class="mf">0.024446481932</span><span class="p">,</span> <span class="mf">0.026048006228</span><span class="p">,</span> <span class="mf">0.06666667</span><span class="p">,</span> <span class="mf">0.089508406455</span><span class="p">,</span>
        <span class="mf">0.11111057</span><span class="p">,</span> <span class="mf">0.146462614229</span><span class="p">,</span> <span class="mf">0.16666667</span><span class="p">,</span> <span class="mf">0.195309105255</span><span class="p">,</span> <span class="mf">0.23333333</span><span class="p">,</span> <span class="mf">0.276686558545</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.333640766319</span><span class="p">,</span>
        <span class="mf">0.36666667</span><span class="p">,</span> <span class="mf">0.400404310407</span><span class="p">,</span> <span class="mf">0.43333333</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.520818918408</span><span class="p">,</span> <span class="mf">0.56666667</span><span class="p">,</span> <span class="mf">0.602196371696</span><span class="p">,</span> <span class="mf">0.63333333</span><span class="p">,</span>
        <span class="mf">0.667358391486</span><span class="p">,</span> <span class="mf">0.683573824984</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.73242031601</span><span class="p">,</span> <span class="mf">0.76666667</span><span class="p">,</span> <span class="mf">0.83333333</span><span class="p">,</span> <span class="mf">0.88888943</span><span class="p">,</span> <span class="mf">0.93333333</span><span class="p">,</span> <span class="mf">0.97777724</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">])</span>  <span class="c"># (Array): initial structural grid on unit radius</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">idx_cylinder_aero</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c"># (Int): first idx in r_aero_unit of non-cylindrical section, constant twist inboard of here</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">idx_cylinder_str</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c"># (Int): first idx in r_str_unit of non-cylindrical section</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">hubFraction</span> <span class="o">=</span> <span class="mf">0.025</span>  <span class="c"># (Float): hub location as fraction of radius</span>
    <span class="c"># ------------------</span>

    <span class="c"># === blade geometry ===</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">r_aero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.02222276</span><span class="p">,</span> <span class="mf">0.06666667</span><span class="p">,</span> <span class="mf">0.11111057</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.23333333</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.36666667</span><span class="p">,</span> <span class="mf">0.43333333</span><span class="p">,</span>
        <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.56666667</span><span class="p">,</span> <span class="mf">0.63333333</span><span class="p">,</span> <span class="mf">0.64</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.83333333</span><span class="p">,</span> <span class="mf">0.88888943</span><span class="p">,</span> <span class="mf">0.93333333</span><span class="p">,</span>
        <span class="mf">0.97777724</span><span class="p">])</span>  <span class="c"># (Array): new aerodynamic grid on unit radius</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">r_max_chord</span> <span class="o">=</span> <span class="mf">0.23577</span>  <span class="c"># (Float): location of max chord on unit radius</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">chord_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.2612</span><span class="p">,</span> <span class="mf">4.5709</span><span class="p">,</span> <span class="mf">3.3178</span><span class="p">,</span> <span class="mf">1.4621</span><span class="p">]</span>  <span class="c"># (Array, m): chord at control points. defined at hub, then at linearly spaced locations from r_max_chord to tip</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">theta_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mf">13.2783</span><span class="p">,</span> <span class="mf">7.46036</span><span class="p">,</span> <span class="mf">2.89317</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0878099</span><span class="p">]</span>  <span class="c"># (Array, deg): twist at control points.  defined at linearly spaced locations from r[idx_cylinder] to tip</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">precurve_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>  <span class="c"># (Array, m): precurve at control points.  defined at same locations at chord, starting at 2nd control point (root must be zero precurve)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">delta_precurve_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>  <span class="c"># (Array, m): adjustment to precurve to account for curvature from loading</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">sparT</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.047754</span><span class="p">,</span> <span class="mf">0.045376</span><span class="p">,</span> <span class="mf">0.031085</span><span class="p">,</span> <span class="mf">0.0061398</span><span class="p">]</span>  <span class="c"># (Array, m): spar cap thickness parameters</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">teT</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.09569</span><span class="p">,</span> <span class="mf">0.06569</span><span class="p">,</span> <span class="mf">0.02569</span><span class="p">,</span> <span class="mf">0.00569</span><span class="p">]</span>  <span class="c"># (Array, m): trailing-edge thickness parameters</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">bladeLength</span> <span class="o">=</span> <span class="mf">61.5</span>  <span class="c"># (Float, m): blade length (if not precurved or swept) otherwise length of blade before curvature</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">delta_bladeLength</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, m): adjustment to blade length to account for curvature from loading</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">precone</span> <span class="o">=</span> <span class="mf">2.5</span>  <span class="c"># (Float, deg): precone angle</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">tilt</span> <span class="o">=</span> <span class="mf">5.0</span>  <span class="c"># (Float, deg): shaft tilt</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">yaw</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, deg): yaw error</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">nBlades</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c"># (Int): number of blades</span>
    <span class="c"># ------------------</span>

    <span class="c"># === airfoil files ===</span>
    <span class="n">basepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> <span class="s">&#39;5MW_AFFiles&#39;</span><span class="p">)</span>

    <span class="c"># load all airfoils</span>
    <span class="n">airfoil_types</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;Cylinder1.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;Cylinder2.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;DU40_A17.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;DU35_A17.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;DU30_A17.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;DU25_A17.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;DU21_A17.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;NACA64_A17.dat&#39;</span><span class="p">)</span>

    <span class="c"># place at appropriate radial stations</span>
    <span class="n">af_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">af_idx</span><span class="p">)</span>
    <span class="n">af</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">af</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">airfoil_types</span><span class="p">[</span><span class="n">af_idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">airfoil_files</span> <span class="o">=</span> <span class="n">af</span>  <span class="c"># (List): names of airfoil file</span>
    <span class="c"># ----------------------</span>

    <span class="c"># === atmosphere ===</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="mf">1.225</span>  <span class="c"># (Float, kg/m**3): density of air</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="mf">1.81206e-5</span>  <span class="c"># (Float, kg/m/s): dynamic viscosity of air</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">shearExp</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c"># (Float): shear exponent</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">hubHt</span> <span class="o">=</span> <span class="mf">90.0</span>  <span class="c"># (Float, m): hub height</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">turbine_class</span> <span class="o">=</span> <span class="s">&#39;I&#39;</span>  <span class="c"># (Enum): IEC turbine class</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">turbulence_class</span> <span class="o">=</span> <span class="s">&#39;B&#39;</span>  <span class="c"># (Enum): IEC turbulence class class</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">cdf_reference_height_wind_speed</span> <span class="o">=</span> <span class="mf">90.0</span>  <span class="c"># (Float): reference hub height for IEC wind speed (used in CDF calculation)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span>  <span class="c"># (Float, m/s**2): acceleration of gravity</span>
    <span class="c"># ----------------------</span>

    <span class="c"># === control ===</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">Vin</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c"># (Float, m/s): cut-in wind speed</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">Vout</span> <span class="o">=</span> <span class="mf">25.0</span>  <span class="c"># (Float, m/s): cut-out wind speed</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">ratedPower</span> <span class="o">=</span> <span class="mf">5e6</span>  <span class="c"># (Float, W): rated power</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">minOmega</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, rpm): minimum allowed rotor rotation speed</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">maxOmega</span> <span class="o">=</span> <span class="mf">12.0</span>  <span class="c"># (Float, rpm): maximum allowed rotor rotation speed</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">tsr</span> <span class="o">=</span> <span class="mf">7.55</span>  <span class="c"># (Float): tip-speed ratio in Region 2 (should be optimized externally)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, deg): pitch angle in region 2 (and region 3 for fixed pitch machines)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">pitch_extreme</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, deg): worst-case pitch at survival wind condition</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">azimuth_extreme</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, deg): worst-case azimuth at survival wind condition</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">VfactorPC</span> <span class="o">=</span> <span class="mf">0.7</span>  <span class="c"># (Float): fraction of rated speed at which the deflection is assumed to representative throughout the power curve calculation</span>
    <span class="c"># ----------------------</span>

    <span class="c"># === aero and structural analysis options ===</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">nSector</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c"># (Int): number of sectors to divide rotor face into in computing thrust and power</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">npts_coarse_power_curve</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c"># (Int): number of points to evaluate aero analysis at</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">npts_spline_power_curve</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c"># (Int): number of points to use in fitting spline to power curve</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">AEP_loss_factor</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c"># (Float): availability and other losses (soiling, array, etc.)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">drivetrainType</span> <span class="o">=</span> <span class="s">&#39;geared&#39;</span>  <span class="c"># (Enum)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">nF</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c"># (Int): number of natural frequencies to compute</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">dynamic_amplication_tip_deflection</span> <span class="o">=</span> <span class="mf">1.35</span>  <span class="c"># (Float): a dynamic amplification factor to adjust the static deflection calculation</span>
    <span class="c"># ----------------------</span>

    <span class="c"># === materials and composite layup  ===</span>
    <span class="n">basepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> <span class="s">&#39;5MW_PrecompFiles&#39;</span><span class="p">)</span>

    <span class="n">materials</span> <span class="o">=</span> <span class="n">Orthotropic2DMaterial</span><span class="o">.</span><span class="n">listFromPreCompFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;materials.inp&#39;</span><span class="p">))</span>

    <span class="n">ncomp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">initial_str_grid</span><span class="p">)</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ncomp</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ncomp</span>
    <span class="n">webs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ncomp</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ncomp</span>

    <span class="n">rotor</span><span class="o">.</span><span class="n">leLoc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.498</span><span class="p">,</span> <span class="mf">0.497</span><span class="p">,</span> <span class="mf">0.465</span><span class="p">,</span> <span class="mf">0.447</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">,</span> <span class="mf">0.411</span><span class="p">,</span>
        <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>    <span class="c"># (Array): array of leading-edge positions from a reference blade axis (usually blade pitch axis). locations are normalized by the local chord length. e.g. leLoc[i] = 0.2 means leading edge is 0.2*chord[i] from reference axis.  positive in -x direction for airfoil-aligned coordinate system</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">sector_idx_strain_spar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">ncomp</span>  <span class="c"># (Array): index of sector for spar (PreComp definition of sector)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">sector_idx_strain_te</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">ncomp</span>  <span class="c"># (Array): index of sector for trailing-edge (PreComp definition of sector)</span>
    <span class="n">web1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.4114</span><span class="p">,</span> <span class="mf">0.4102</span><span class="p">,</span> <span class="mf">0.4094</span><span class="p">,</span> <span class="mf">0.3876</span><span class="p">,</span> <span class="mf">0.3755</span><span class="p">,</span> <span class="mf">0.3639</span><span class="p">,</span> <span class="mf">0.345</span><span class="p">,</span> <span class="mf">0.3342</span><span class="p">,</span> <span class="mf">0.3313</span><span class="p">,</span> <span class="mf">0.3274</span><span class="p">,</span> <span class="mf">0.323</span><span class="p">,</span> <span class="mf">0.3206</span><span class="p">,</span> <span class="mf">0.3172</span><span class="p">,</span> <span class="mf">0.3138</span><span class="p">,</span> <span class="mf">0.3104</span><span class="p">,</span> <span class="mf">0.307</span><span class="p">,</span> <span class="mf">0.3003</span><span class="p">,</span> <span class="mf">0.2982</span><span class="p">,</span> <span class="mf">0.2935</span><span class="p">,</span> <span class="mf">0.2899</span><span class="p">,</span> <span class="mf">0.2867</span><span class="p">,</span> <span class="mf">0.2833</span><span class="p">,</span> <span class="mf">0.2817</span><span class="p">,</span> <span class="mf">0.2799</span><span class="p">,</span> <span class="mf">0.2767</span><span class="p">,</span> <span class="mf">0.2731</span><span class="p">,</span> <span class="mf">0.2664</span><span class="p">,</span> <span class="mf">0.2607</span><span class="p">,</span> <span class="mf">0.2562</span><span class="p">,</span> <span class="mf">0.1886</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
    <span class="n">web2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5886</span><span class="p">,</span> <span class="mf">0.5868</span><span class="p">,</span> <span class="mf">0.5854</span><span class="p">,</span> <span class="mf">0.5508</span><span class="p">,</span> <span class="mf">0.5315</span><span class="p">,</span> <span class="mf">0.5131</span><span class="p">,</span> <span class="mf">0.4831</span><span class="p">,</span> <span class="mf">0.4658</span><span class="p">,</span> <span class="mf">0.4687</span><span class="p">,</span> <span class="mf">0.4726</span><span class="p">,</span> <span class="mf">0.477</span><span class="p">,</span> <span class="mf">0.4794</span><span class="p">,</span> <span class="mf">0.4828</span><span class="p">,</span> <span class="mf">0.4862</span><span class="p">,</span> <span class="mf">0.4896</span><span class="p">,</span> <span class="mf">0.493</span><span class="p">,</span> <span class="mf">0.4997</span><span class="p">,</span> <span class="mf">0.5018</span><span class="p">,</span> <span class="mf">0.5065</span><span class="p">,</span> <span class="mf">0.5101</span><span class="p">,</span> <span class="mf">0.5133</span><span class="p">,</span> <span class="mf">0.5167</span><span class="p">,</span> <span class="mf">0.5183</span><span class="p">,</span> <span class="mf">0.5201</span><span class="p">,</span> <span class="mf">0.5233</span><span class="p">,</span> <span class="mf">0.5269</span><span class="p">,</span> <span class="mf">0.5336</span><span class="p">,</span> <span class="mf">0.5393</span><span class="p">,</span> <span class="mf">0.5438</span><span class="p">,</span> <span class="mf">0.6114</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
    <span class="n">web3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">chord_str_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.2612</span><span class="p">,</span> <span class="mf">3.3100915356</span><span class="p">,</span> <span class="mf">3.32587052924</span><span class="p">,</span> <span class="mf">3.34159388653</span><span class="p">,</span> <span class="mf">3.35823798667</span><span class="p">,</span> <span class="mf">3.37384375335</span><span class="p">,</span>
        <span class="mf">3.38939112914</span><span class="p">,</span> <span class="mf">3.4774055542</span><span class="p">,</span> <span class="mf">3.49839685</span><span class="p">,</span> <span class="mf">3.51343645709</span><span class="p">,</span> <span class="mf">3.87017220335</span><span class="p">,</span> <span class="mf">4.04645623801</span><span class="p">,</span> <span class="mf">4.19408216643</span><span class="p">,</span>
         <span class="mf">4.47641008477</span><span class="p">,</span> <span class="mf">4.55844487985</span><span class="p">,</span> <span class="mf">4.57383098262</span><span class="p">,</span> <span class="mf">4.57285771934</span><span class="p">,</span> <span class="mf">4.51914315648</span><span class="p">,</span> <span class="mf">4.47677655262</span><span class="p">,</span> <span class="mf">4.40075650022</span><span class="p">,</span>
         <span class="mf">4.31069949379</span><span class="p">,</span> <span class="mf">4.20483735936</span><span class="p">,</span> <span class="mf">4.08985563932</span><span class="p">,</span> <span class="mf">3.82931757126</span><span class="p">,</span> <span class="mf">3.74220276467</span><span class="p">,</span> <span class="mf">3.54415796922</span><span class="p">,</span> <span class="mf">3.38732428502</span><span class="p">,</span>
         <span class="mf">3.24931446473</span><span class="p">,</span> <span class="mf">3.23421422609</span><span class="p">,</span> <span class="mf">3.22701537997</span><span class="p">,</span> <span class="mf">3.21972125648</span><span class="p">,</span> <span class="mf">3.08979310611</span><span class="p">,</span> <span class="mf">2.95152261813</span><span class="p">,</span> <span class="mf">2.330753331</span><span class="p">,</span>
         <span class="mf">2.05553464181</span><span class="p">,</span> <span class="mf">1.82577817774</span><span class="p">,</span> <span class="mf">1.5860853279</span><span class="p">,</span> <span class="mf">1.4621</span><span class="p">])</span>  <span class="c"># (Array, m): chord distribution for reference section, thickness of structural layup scaled with reference thickness (fixed t/c for this case)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>

        <span class="n">webLoc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">web1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">webLoc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">web1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">web2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">webLoc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">web2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">web3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">webLoc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">web3</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">upper</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lower</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">webs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CompositeSection</span><span class="o">.</span><span class="n">initFromPreCompLayupFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;layup_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.inp&#39;</span><span class="p">),</span> <span class="n">webLoc</span><span class="p">,</span> <span class="n">materials</span><span class="p">)</span>
        <span class="n">profile</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">initFromPreCompFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;shape_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.inp&#39;</span><span class="p">))</span>

    <span class="n">rotor</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="n">materials</span>  <span class="c"># (List): list of all Orthotropic2DMaterial objects used in defining the geometry</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">upperCS</span> <span class="o">=</span> <span class="n">upper</span>  <span class="c"># (List): list of CompositeSection objections defining the properties for upper surface</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">lowerCS</span> <span class="o">=</span> <span class="n">lower</span>  <span class="c"># (List): list of CompositeSection objections defining the properties for lower surface</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">websCS</span> <span class="o">=</span> <span class="n">webs</span>  <span class="c"># (List): list of CompositeSection objections defining the properties for shear webs</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">profile</span>  <span class="c"># (List): airfoil shape at each radial position</span>
    <span class="c"># --------------------------------------</span>


    <span class="c"># === fatigue ===</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">rstar_damage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.000</span><span class="p">,</span> <span class="mf">0.022</span><span class="p">,</span> <span class="mf">0.067</span><span class="p">,</span> <span class="mf">0.111</span><span class="p">,</span> <span class="mf">0.167</span><span class="p">,</span> <span class="mf">0.233</span><span class="p">,</span> <span class="mf">0.300</span><span class="p">,</span> <span class="mf">0.367</span><span class="p">,</span> <span class="mf">0.433</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">,</span>
        <span class="mf">0.567</span><span class="p">,</span> <span class="mf">0.633</span><span class="p">,</span> <span class="mf">0.700</span><span class="p">,</span> <span class="mf">0.767</span><span class="p">,</span> <span class="mf">0.833</span><span class="p">,</span> <span class="mf">0.889</span><span class="p">,</span> <span class="mf">0.933</span><span class="p">,</span> <span class="mf">0.978</span><span class="p">])</span>  <span class="c"># (Array): nondimensional radial locations of damage equivalent moments</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">Mxb_damage</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.3743E+003</span><span class="p">,</span> <span class="mf">2.0834E+003</span><span class="p">,</span> <span class="mf">1.8108E+003</span><span class="p">,</span> <span class="mf">1.5705E+003</span><span class="p">,</span> <span class="mf">1.3104E+003</span><span class="p">,</span>
        <span class="mf">1.0488E+003</span><span class="p">,</span> <span class="mf">8.2367E+002</span><span class="p">,</span> <span class="mf">6.3407E+002</span><span class="p">,</span> <span class="mf">4.7727E+002</span><span class="p">,</span> <span class="mf">3.4804E+002</span><span class="p">,</span> <span class="mf">2.4458E+002</span><span class="p">,</span> <span class="mf">1.6339E+002</span><span class="p">,</span>
        <span class="mf">1.0252E+002</span><span class="p">,</span> <span class="mf">5.7842E+001</span><span class="p">,</span> <span class="mf">2.7349E+001</span><span class="p">,</span> <span class="mf">1.1262E+001</span><span class="p">,</span> <span class="mf">3.8549E+000</span><span class="p">,</span> <span class="mf">4.4738E-001</span><span class="p">])</span>  <span class="c"># (Array, N*m): damage equivalent moments about blade c.s. x-direction</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">Myb_damage</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.7732E+003</span><span class="p">,</span> <span class="mf">2.8155E+003</span><span class="p">,</span> <span class="mf">2.6004E+003</span><span class="p">,</span> <span class="mf">2.3933E+003</span><span class="p">,</span> <span class="mf">2.1371E+003</span><span class="p">,</span>
        <span class="mf">1.8459E+003</span><span class="p">,</span> <span class="mf">1.5582E+003</span><span class="p">,</span> <span class="mf">1.2896E+003</span><span class="p">,</span> <span class="mf">1.0427E+003</span><span class="p">,</span> <span class="mf">8.2015E+002</span><span class="p">,</span> <span class="mf">6.2449E+002</span><span class="p">,</span> <span class="mf">4.5229E+002</span><span class="p">,</span>
        <span class="mf">3.0658E+002</span><span class="p">,</span> <span class="mf">1.8746E+002</span><span class="p">,</span> <span class="mf">9.6475E+001</span><span class="p">,</span> <span class="mf">4.2677E+001</span><span class="p">,</span> <span class="mf">1.5409E+001</span><span class="p">,</span> <span class="mf">1.8426E+000</span><span class="p">])</span>  <span class="c"># (Array, N*m): damage equivalent moments about blade c.s. y-direction</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">strain_ult_spar</span> <span class="o">=</span> <span class="mf">1.0e-2</span>  <span class="c"># (Float): ultimate strain in spar cap</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">strain_ult_te</span> <span class="o">=</span> <span class="mi">2500</span><span class="o">*</span><span class="mf">1e-6</span> <span class="o">*</span> <span class="mi">2</span>   <span class="c"># (Float): uptimate strain in trailing-edge panels, note that I am putting a factor of two for the damage part only.</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">eta_damage</span> <span class="o">=</span> <span class="mf">1.35</span><span class="o">*</span><span class="mf">1.3</span><span class="o">*</span><span class="mf">1.0</span>  <span class="c"># (Float): safety factor for fatigue</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">m_damage</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c"># (Float): slope of S-N curve for fatigue analysis</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">N_damage</span> <span class="o">=</span> <span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="o">*</span><span class="mf">20.0</span>  <span class="c"># (Float): number of cycles used in fatigue analysis  TODO: make function of rotation speed</span>
    <span class="c"># ----------------</span>

    <span class="c"># from myutilities import plt</span>

    <span class="c"># === run and outputs ===</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">print</span> <span class="s">&#39;AEP =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">AEP</span>
    <span class="k">print</span> <span class="s">&#39;diameter =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">diameter</span>
    <span class="k">print</span> <span class="s">&#39;ratedConditions.V =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">V</span>
    <span class="k">print</span> <span class="s">&#39;ratedConditions.Omega =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">Omega</span>
    <span class="k">print</span> <span class="s">&#39;ratedConditions.pitch =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">pitch</span>
    <span class="k">print</span> <span class="s">&#39;ratedConditions.T =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">T</span>
    <span class="k">print</span> <span class="s">&#39;ratedConditions.Q =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">Q</span>
    <span class="k">print</span> <span class="s">&#39;mass_one_blade =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">mass_one_blade</span>
    <span class="k">print</span> <span class="s">&#39;mass_all_blades =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">mass_all_blades</span>
    <span class="k">print</span> <span class="s">&#39;I_all_blades =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">I_all_blades</span>
    <span class="k">print</span> <span class="s">&#39;freq =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">freq</span>
    <span class="k">print</span> <span class="s">&#39;tip_deflection =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">tip_deflection</span>
    <span class="k">print</span> <span class="s">&#39;root_bending_moment =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">root_bending_moment</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">P</span><span class="o">/</span><span class="mf">1e6</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;wind speed (m/s)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;power (W)&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">r_str</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">strainU_spar</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;suction&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">r_str</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">strainL_spar</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;pressure&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">r_str</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">eps_crit_spar</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;critical&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">5e-3</span><span class="p">,</span> <span class="mf">5e-3</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;strain&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="c"># plt.save(&#39;/Users/sning/Desktop/strain_spar.pdf&#39;)</span>
    <span class="c"># plt.save(&#39;/Users/sning/Desktop/strain_spar.png&#39;)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">r_str</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">strainU_te</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;suction&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">r_str</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">strainL_te</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;pressure&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">r_str</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">eps_crit_te</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;critical&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">5e-3</span><span class="p">,</span> <span class="mf">5e-3</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;strain&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="c"># plt.save(&#39;/Users/sning/Desktop/strain_te.pdf&#39;)</span>
    <span class="c"># plt.save(&#39;/Users/sning/Desktop/strain_te.png&#39;)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="c"># ----------------</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">RotorSE 0.1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, NREL.
      Last updated on Oct 07, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>