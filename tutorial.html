<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Tutorial &mdash; RotorSE 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/nrel.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="RotorSE 0.1.0 documentation" href="index.html" />
    <link rel="next" title="4. Documentation" href="documentation.html" />
    <link rel="prev" title="2. Installation" href="installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="documentation.html" title="4. Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="2. Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">RotorSE 0.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tutorial">
<span id="tutorial-label"></span><h1>3. Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>The module <a class="reference internal" href="documentation.html#module-rotorse.rotoraero" title="rotorse.rotoraero"><tt class="xref py py-mod docutils literal"><span class="pre">rotorse.rotoraero</span></tt></a> contains methods for generating power curves and computing annual energy production (AEP) with any aerodynamic tool (implementing <a class="reference internal" href="documentation.html#rotorse.rotoraero.AeroBase" title="rotorse.rotoraero.AeroBase"><tt class="xref py py-class docutils literal"><span class="pre">AeroBase</span></tt></a> and <a class="reference internal" href="documentation.html#rotorse.rotoraero.GeomtrySetupBase" title="rotorse.rotoraero.GeomtrySetupBase"><tt class="xref py py-class docutils literal"><span class="pre">GeomtrySetupBase</span></tt></a>), any wind speed distribution (implementing <a class="reference internal" href="documentation.html#rotorse.rotoraero.PDFBase" title="rotorse.rotoraero.PDFBase"><tt class="xref py py-class docutils literal"><span class="pre">PDFBase</span></tt></a> and <a class="reference internal" href="documentation.html#rotorse.rotoraero.CDFBase" title="rotorse.rotoraero.CDFBase"><tt class="xref py py-class docutils literal"><span class="pre">CDFBase</span></tt></a>), any drivetrain efficiency function (implementing <a class="reference internal" href="documentation.html#rotorse.rotoraero.DrivetrainLossesBase" title="rotorse.rotoraero.DrivetrainLossesBase"><tt class="xref py py-class docutils literal"><span class="pre">DrivetrainLossesBase</span></tt></a>), and any machine type amongst the four combinations of variable/fixed speed and variable/fixed pitch.</p>
<p>The module <a class="reference internal" href="documentation.html#module-rotorse.rotoraerodefaults" title="rotorse.rotoraerodefaults"><tt class="xref py py-mod docutils literal"><span class="pre">rotorse.rotoraerodefaults</span></tt></a> provides specific implementations for use with <a class="reference internal" href="documentation.html#module-rotorse.rotoraero" title="rotorse.rotoraero"><tt class="xref py py-mod docutils literal"><span class="pre">rotorse.rotoraero</span></tt></a>.  It uses <a class="reference external" href="https://github.com/WISDEM/CCBlade">CCBlade</a> for the aerodynamic analysis, provides Weibull and Rayleigh wind speed distribution, and a drivetrain efficiency function from <a class="reference external" href="http://www.nrel.gov/docs/fy07osti/40566.pdf">NREL&#8217;s Cost and Scaling Model</a>.</p>
<p>The module <a class="reference internal" href="documentation.html#module-rotorse.rotor" title="rotorse.rotor"><tt class="xref py py-mod docutils literal"><span class="pre">rotorse.rotor</span></tt></a> builds upon rotoraero and provides structural analyses.  These include methods for coupling the aerodynamic and structural grids, managing the composite section analyses, transferring loads, computing deflections, computing mass properties, etc.</p>
<p>Two examples are included in this tutorial section: aerodynamic simulation and optimization of a rotor and aero/structural analysis of a rotor.</p>
<div class="section" id="rotor-aerodynamics">
<h2>3.1. Rotor Aerodynamics<a class="headerlink" href="#rotor-aerodynamics" title="Permalink to this headline">¶</a></h2>
<p>We instantiate a variable-speed variable-pitch rotor preconfigured to use CCBlade (<a class="reference internal" href="documentation.html#rotorse.rotoraerodefaults.RotorAeroVSVPWithCCBlade" title="rotorse.rotoraerodefaults.RotorAeroVSVPWithCCBlade"><tt class="xref py py-class docutils literal"><span class="pre">RotorAeroVSVPWithCCBlade</span></tt></a>).  Similar methods exist for the other types of fixed/variable speed, fixed/variable pitch machines.  At instantiation, the cumulative distribution function can be selected (<tt class="docutils literal"><span class="pre">cdf_type</span></tt>).  Valid options are &#8216;rayleigh&#8217; and &#8216;weibull&#8217;.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">cdf_type</span> <span class="o">=</span> <span class="s">&#39;weibull&#39;</span>
    <span class="n">rotor</span> <span class="o">=</span> <span class="n">RotorAeroVSVPWithCCBlade</span><span class="p">(</span><span class="n">cdf_type</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, the geometry is defined.  These parameters are specific to CCBlade and a spline component <a class="reference internal" href="documentation.html#rotorse.rotoraerodefaults.GeometrySpline" title="rotorse.rotoraerodefaults.GeometrySpline"><tt class="xref py py-class docutils literal"><span class="pre">GeometrySpline</span></tt></a> which uses Akima splines for the chord and twist distribution according to <a class="pageref" href="#chord-param-fig">Figures  1</a> and <a class="pageref" href="#twist-param-fig"> 2</a>.  The power-curve is essentially the same as the previous example.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">r_max_chord</span> <span class="o">=</span> <span class="mf">0.23577</span>  <span class="c"># (Float): location of second control point (generally also max chord)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">chord_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.2612</span><span class="p">,</span> <span class="mf">4.5709</span><span class="p">,</span> <span class="mf">3.3178</span><span class="p">,</span> <span class="mf">1.4621</span><span class="p">]</span>  <span class="c"># (Array, m): chord at control points</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">theta_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mf">13.2783</span><span class="p">,</span> <span class="mf">7.46036</span><span class="p">,</span> <span class="mf">2.89317</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0878099</span><span class="p">]</span>  <span class="c"># (Array, deg): twist at control points</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">Rhub</span> <span class="o">=</span> <span class="mf">1.5</span>  <span class="c"># (Float, m): hub radius</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">Rtip</span> <span class="o">=</span> <span class="mf">63.0</span>  <span class="c"># (Float, m): tip radius</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">precone</span> <span class="o">=</span> <span class="mf">2.5</span>  <span class="c"># (Float, deg): precone angle</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">tilt</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span>  <span class="c"># (Float, deg): shaft tilt</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">yaw</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, deg): yaw error</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c"># (Int): number of blades</span>
</pre></div>
</div>
<div class="figure align-left" id="chord-param-fig">
<a class="reference internal image-reference" href="_images/chord-param2.png"><img alt="_images/chord-param2.png" src="_images/chord-param2.png" style="height: 4in;" /></a>
<p class="caption">Figure 1: Chord parameterization</p>
</div>
<div class="figure align-center" id="twist-param-fig">
<a class="reference internal image-reference" href="_images/theta-param2.png"><img alt="_images/theta-param2.png" src="_images/theta-param2.png" style="height: 4in;" /></a>
<p class="caption">Figure 2: Twist parameterization</p>
</div>
<p>Next, the airfoils are loaded, again using CCBlade parameters.  The locations of the airfoil on a nondimensional blade are defined, as well as the location where the cylinder section ends.  This defines where the twist distribution begins.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">basepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> <span class="s">&#39;5MW_AFFiles&#39;</span><span class="p">)</span>

    <span class="c"># load all airfoils</span>
    <span class="n">airfoil_types</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">basepath</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;Cylinder1.dat&#39;</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">basepath</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;Cylinder2.dat&#39;</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">basepath</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;DU40_A17.dat&#39;</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">basepath</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;DU35_A17.dat&#39;</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">basepath</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;DU30_A17.dat&#39;</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">basepath</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;DU25_A17.dat&#39;</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">basepath</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;DU21_A17.dat&#39;</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">basepath</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="s">&#39;NACA64_A17.dat&#39;</span>

    <span class="c"># place at appropriate radial stations</span>
    <span class="n">af_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">af_idx</span><span class="p">)</span>
    <span class="n">af</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">af</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">airfoil_types</span><span class="p">[</span><span class="n">af_idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

    <span class="n">rotor</span><span class="o">.</span><span class="n">airfoil_files</span> <span class="o">=</span> <span class="n">af</span>  <span class="c"># (List): paths to AeroDyn-style airfoil files</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">r_af</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.02222276</span><span class="p">,</span> <span class="mf">0.06666667</span><span class="p">,</span> <span class="mf">0.11111057</span><span class="p">,</span> <span class="mf">0.16666667</span><span class="p">,</span> <span class="mf">0.23333333</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.36666667</span><span class="p">,</span>
        <span class="mf">0.43333333</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.56666667</span><span class="p">,</span> <span class="mf">0.63333333</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.76666667</span><span class="p">,</span> <span class="mf">0.83333333</span><span class="p">,</span> <span class="mf">0.88888943</span><span class="p">,</span>
        <span class="mf">0.93333333</span><span class="p">,</span> <span class="mf">0.97777724</span><span class="p">])</span>    <span class="c"># (Array, m): locations where airfoils are defined on unit radius</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">idx_cylinder</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c"># (Int): index in r_af where cylinder section ends</span>
</pre></div>
</div>
<p>Atmospheric properties and wind speed distribution are defined.  The parameter <tt class="docutils literal"><span class="pre">weibull_shape_factor</span></tt> is only relevant if the <tt class="docutils literal"><span class="pre">weibull</span></tt> type CDF is selected.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="mf">1.225</span>  <span class="c"># (Float, kg/m**3): density of air</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="mf">1.81206e-5</span>  <span class="c"># (Float, kg/m/s): dynamic viscosity of air</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">shearExp</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c"># (Float): shear exponent</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">hubHt</span> <span class="o">=</span> <span class="mf">80.0</span>  <span class="c"># (Float, m)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">cdf_mean_wind_speed</span> <span class="o">=</span> <span class="mf">6.0</span>  <span class="c"># (Float, m/s): mean wind speed of site cumulative distribution function</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">weibull_shape_factor</span> <span class="o">=</span> <span class="mf">2.0</span>  <span class="c"># (Float): shape factor of weibull distribution</span>
</pre></div>
</div>
<p>The relevant control parameters will vary depending on whether a variable speed or fixed speed machine is chosen (see <a class="reference internal" href="documentation.html#rotorse.rotoraero.VarSpeedMachine" title="rotorse.rotoraero.VarSpeedMachine"><tt class="xref py py-class docutils literal"><span class="pre">VarSpeedMachine</span></tt></a> and <a class="reference internal" href="documentation.html#rotorse.rotoraero.FixedSpeedMachine" title="rotorse.rotoraero.FixedSpeedMachine"><tt class="xref py py-class docutils literal"><span class="pre">FixedSpeedMachine</span></tt></a>).</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">Vin</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c"># (Float, m/s): cut-in wind speed</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">Vout</span> <span class="o">=</span> <span class="mf">25.0</span>  <span class="c"># (Float, m/s): cut-out wind speed</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">ratedPower</span> <span class="o">=</span> <span class="mf">5e6</span>  <span class="c"># (Float, W): rated power</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, deg): pitch angle in region 2 (and region 3 for fixed pitch machines)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">minOmega</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, rpm): minimum allowed rotor rotation speed</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">maxOmega</span> <span class="o">=</span> <span class="mf">12.0</span>  <span class="c"># (Float, rpm): maximum allowed rotor rotation speed</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">tsr</span> <span class="o">=</span> <span class="mf">7.55</span>  <span class="c"># **dv** (Float): tip-speed ratio in Region 2 (should be optimized externally)</span>
</pre></div>
</div>
<p>The Cost and Scaling model defines drivetrain efficiency functions for the following drivetrain types: &#8216;geared&#8217;, &#8216;single_stage&#8217;, &#8216;multi_drive&#8217;, or &#8216;pm_direct_drive&#8217;.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">drivetrainType</span> <span class="o">=</span> <span class="s">&#39;geared&#39;</span>
</pre></div>
</div>
<p>Finally, various optional configuration parameters are set, many of which are specific to CCBlade.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">nSector</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c"># (Int): number of sectors to divide rotor face into in computing thrust and power</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">npts_coarse_power_curve</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c"># (Int): number of points to evaluate aero analysis at</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">npts_spline_power_curve</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c"># (Int): number of points to use in fitting spline to power curve</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">AEP_loss_factor</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c"># (Float): availability and other losses (soiling, array, etc.)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">tiploss</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># (Bool): include Prandtl tip loss model</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">hubloss</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># (Bool): include Prandtl hub loss model</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">wakerotation</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># (Bool): include effect of wake rotation (i.e., tangential induction factor is nonzero)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">usecd</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># (Bool): use drag coefficient in computing induction factors</span>
</pre></div>
</div>
<p>We can now run the analysis, print the AEP, and plot the power curve.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="n">AEP0</span> <span class="o">=</span> <span class="n">rotor</span><span class="o">.</span><span class="n">AEP</span>
    <span class="k">print</span> <span class="s">&#39;AEP0 =&#39;</span><span class="p">,</span> <span class="n">AEP0</span>

    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">P</span><span class="o">/</span><span class="mf">1e6</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;wind speed (m/s)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;power (MW)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">AEP0</span> <span class="o">=</span> <span class="mf">9716744.29201</span>
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/powercurve.png"><img alt="_images/powercurve.png" src="_images/powercurve.png" style="height: 4in;" /></a>
<p class="caption">Figure 3: Power curve</p>
</div>
</div>
<div class="section" id="rotor-aerodynamics-optimization">
<h2>3.2. Rotor Aerodynamics Optimization<a class="headerlink" href="#rotor-aerodynamics-optimization" title="Permalink to this headline">¶</a></h2>
<p>This section describes a simple optimization continuing off of the same setup as the previous section.</p>
<div class="highlight-python"><div class="highlight"><pre>        <span class="kn">from</span> <span class="nn">pyopt_driver.pyopt_driver</span> <span class="kn">import</span> <span class="n">pyOptDriver</span>
        <span class="kn">from</span> <span class="nn">openmdao.lib.casehandlers.api</span> <span class="kn">import</span> <span class="n">DumpCaseRecorder</span>
</pre></div>
</div>
<p>The optimizer must first be selected and configured, in this example I choose SNOPT.</p>
<div class="highlight-python"><div class="highlight"><pre>        <span class="n">rotor</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;driver&#39;</span><span class="p">,</span> <span class="n">pyOptDriver</span><span class="p">())</span>
        <span class="n">rotor</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="s">&#39;SNOPT&#39;</span>
        <span class="n">rotor</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Major feasibility tolerance&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                               <span class="s">&#39;Minor feasibility tolerance&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                               <span class="s">&#39;Major optimality tolerance&#39;</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">,</span>
                               <span class="s">&#39;Function precision&#39;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">}</span>
</pre></div>
</div>
<p>We now set the objective, and in this example it is normalized by the starting AEP for better convergence behavior.</p>
<div class="highlight-python"><div class="highlight"><pre>        <span class="n">rotor</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s">&#39;-aep.AEP/</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">AEP0</span><span class="p">)</span>
</pre></div>
</div>
<p>The rotor chord, twist, and tip-speed ratio in Region 2 are added as design variables.</p>
<div class="highlight-python"><div class="highlight"><pre>        <span class="n">rotor</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;r_max_chord&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">rotor</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;chord_sub&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">5.3</span><span class="p">)</span>
        <span class="n">rotor</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;theta_sub&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=-</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span>
        <span class="n">rotor</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&#39;control.tsr&#39;</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">14.0</span><span class="p">)</span>
</pre></div>
</div>
<p>A recorder is added to display each iteration to the screen.</p>
<div class="highlight-python"><div class="highlight"><pre>        <span class="n">rotor</span><span class="o">.</span><span class="n">recorders</span> <span class="o">=</span> <span class="p">[</span><span class="n">DumpCaseRecorder</span><span class="p">()]</span>
</pre></div>
</div>
<p>There are no constraints for this problem, but because of a bug in OpenMDAO we need to add a dummy one.</p>
<div class="highlight-python"><div class="highlight"><pre>        <span class="n">rotor</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s">&#39;1.0 &gt;= 0.0&#39;</span><span class="p">)</span>  <span class="c"># dummy constraint, OpenMDAO bug when using pyOpt</span>
</pre></div>
</div>
<p>Running the optimization (takes a little less than a minute) yields a new design with a 1.35% percent increase in AEP.</p>
<div class="highlight-python"><div class="highlight"><pre>        <span class="n">rotor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">rotor</span><span class="o">.</span><span class="n">chord_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">5.3</span><span class="p">,</span> <span class="mf">3.77661242</span><span class="p">,</span> <span class="mf">2.64450736</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rotor</span><span class="o">.</span><span class="n">r_max_chord</span> <span class="o">=</span> <span class="mf">0.189540229541</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rotor</span><span class="o">.</span><span class="n">theta_sub</span><span class="p">:</span> <span class="p">[</span><span class="mf">13.46656381</span><span class="p">,</span> <span class="mf">6.45837507</span><span class="p">,</span> <span class="mf">4.59557023</span><span class="p">,</span> <span class="mf">2.85016239</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">tsr</span> <span class="o">=</span> <span class="mf">7.79327456713</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Objective_0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.01353182592</span>
</pre></div>
</div>
</div>
<div class="section" id="rotor-aero-structures">
<h2>3.3. Rotor Aero/Structures<a class="headerlink" href="#rotor-aero-structures" title="Permalink to this headline">¶</a></h2>
<p>This examples includes both aerodynamic and structural analysis.  In this case, they are not fully coupled.  The aerodynamic loads feed into the structural analysis, but there is no feedback from the structural deflections.  <a class="reference external" href="http://wisdem.github.io/TurbineSE">TurbineSE</a> provides an example with fully coupled aero/structural solutions.  We first import the modules we will use and instantiate the objects.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="c"># from rotorse.rotor import RotorSE  (include this line)</span>

    <span class="n">rotor</span> <span class="o">=</span> <span class="n">RotorSE</span><span class="p">()</span>
</pre></div>
</div>
<p>Initial grids are set.  From these definitions only changes to the aerodynamic grid needs to be specified (through <tt class="docutils literal"><span class="pre">r_aero</span></tt> in the next section) and the locations along the aerodynamic and structural grids will be kept in sync.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">initial_aero_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.02222276</span><span class="p">,</span> <span class="mf">0.06666667</span><span class="p">,</span> <span class="mf">0.11111057</span><span class="p">,</span> <span class="mf">0.16666667</span><span class="p">,</span> <span class="mf">0.23333333</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.36666667</span><span class="p">,</span>
        <span class="mf">0.43333333</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.56666667</span><span class="p">,</span> <span class="mf">0.63333333</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.76666667</span><span class="p">,</span> <span class="mf">0.83333333</span><span class="p">,</span> <span class="mf">0.88888943</span><span class="p">,</span> <span class="mf">0.93333333</span><span class="p">,</span>
        <span class="mf">0.97777724</span><span class="p">])</span>  <span class="c"># (Array): initial aerodynamic grid on unit radius</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">initial_str_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.00492790457512</span><span class="p">,</span> <span class="mf">0.00652942887106</span><span class="p">,</span> <span class="mf">0.00813095316699</span><span class="p">,</span> <span class="mf">0.00983257273154</span><span class="p">,</span>
        <span class="mf">0.0114340970275</span><span class="p">,</span> <span class="mf">0.0130356213234</span><span class="p">,</span> <span class="mf">0.02222276</span><span class="p">,</span> <span class="mf">0.024446481932</span><span class="p">,</span> <span class="mf">0.026048006228</span><span class="p">,</span> <span class="mf">0.06666667</span><span class="p">,</span> <span class="mf">0.089508406455</span><span class="p">,</span>
        <span class="mf">0.11111057</span><span class="p">,</span> <span class="mf">0.146462614229</span><span class="p">,</span> <span class="mf">0.16666667</span><span class="p">,</span> <span class="mf">0.195309105255</span><span class="p">,</span> <span class="mf">0.23333333</span><span class="p">,</span> <span class="mf">0.276686558545</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.333640766319</span><span class="p">,</span>
        <span class="mf">0.36666667</span><span class="p">,</span> <span class="mf">0.400404310407</span><span class="p">,</span> <span class="mf">0.43333333</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.520818918408</span><span class="p">,</span> <span class="mf">0.56666667</span><span class="p">,</span> <span class="mf">0.602196371696</span><span class="p">,</span> <span class="mf">0.63333333</span><span class="p">,</span>
        <span class="mf">0.667358391486</span><span class="p">,</span> <span class="mf">0.683573824984</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.73242031601</span><span class="p">,</span> <span class="mf">0.76666667</span><span class="p">,</span> <span class="mf">0.83333333</span><span class="p">,</span> <span class="mf">0.88888943</span><span class="p">,</span> <span class="mf">0.93333333</span><span class="p">,</span> <span class="mf">0.97777724</span><span class="p">,</span>
        <span class="mf">1.0</span><span class="p">])</span>  <span class="c"># (Array): initial structural grid on unit radius</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">idx_cylinder_aero</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c"># (Int): first idx in r_aero_unit of non-cylindrical section, constant twist inboard of here</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">idx_cylinder_str</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c"># (Int): first idx in r_str_unit of non-cylindrical section</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">hubFraction</span> <span class="o">=</span> <span class="mf">0.025</span>  <span class="c"># (Float): hub location as fraction of radius</span>
</pre></div>
</div>
<p>Next, geometric parameters are defined.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">r_aero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.02222276</span><span class="p">,</span> <span class="mf">0.06666667</span><span class="p">,</span> <span class="mf">0.11111057</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.23333333</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.36666667</span><span class="p">,</span> <span class="mf">0.43333333</span><span class="p">,</span>
        <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.56666667</span><span class="p">,</span> <span class="mf">0.63333333</span><span class="p">,</span> <span class="mf">0.64</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.83333333</span><span class="p">,</span> <span class="mf">0.88888943</span><span class="p">,</span> <span class="mf">0.93333333</span><span class="p">,</span>
        <span class="mf">0.97777724</span><span class="p">])</span>  <span class="c"># (Array): new aerodynamic grid on unit radius</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">r_max_chord</span> <span class="o">=</span> <span class="mf">0.23577</span>  <span class="c"># (Float): location of max chord on unit radius</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">chord_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.2612</span><span class="p">,</span> <span class="mf">4.5709</span><span class="p">,</span> <span class="mf">3.3178</span><span class="p">,</span> <span class="mf">1.4621</span><span class="p">]</span>  <span class="c"># (Array, m): chord at control points. defined at hub, then at linearly spaced locations from r_max_chord to tip</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">theta_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mf">13.2783</span><span class="p">,</span> <span class="mf">7.46036</span><span class="p">,</span> <span class="mf">2.89317</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0878099</span><span class="p">]</span>  <span class="c"># (Array, deg): twist at control points.  defined at linearly spaced locations from r[idx_cylinder] to tip</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">precurve_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>  <span class="c"># (Array, m): precurve at control points.  defined at same locations at chord, starting at 2nd control point (root must be zero precurve)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">delta_precurve_sub</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>  <span class="c"># (Array, m): adjustment to precurve to account for curvature from loading</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">sparT</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.047754</span><span class="p">,</span> <span class="mf">0.045376</span><span class="p">,</span> <span class="mf">0.031085</span><span class="p">,</span> <span class="mf">0.0061398</span><span class="p">]</span>  <span class="c"># (Array, m): spar cap thickness parameters</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">teT</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.09569</span><span class="p">,</span> <span class="mf">0.06569</span><span class="p">,</span> <span class="mf">0.02569</span><span class="p">,</span> <span class="mf">0.00569</span><span class="p">]</span>  <span class="c"># (Array, m): trailing-edge thickness parameters</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">bladeLength</span> <span class="o">=</span> <span class="mf">61.5</span>  <span class="c"># (Float, m): blade length (if not precurved or swept) otherwise length of blade before curvature</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">delta_bladeLength</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, m): adjustment to blade length to account for curvature from loading</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">precone</span> <span class="o">=</span> <span class="mf">2.5</span>  <span class="c"># (Float, deg): precone angle</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">tilt</span> <span class="o">=</span> <span class="mf">5.0</span>  <span class="c"># (Float, deg): shaft tilt</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">yaw</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, deg): yaw error</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">nBlades</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c"># (Int): number of blades</span>
</pre></div>
</div>
<p>Airfoil data is loaded in the same way as in the aero only case.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">basepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> <span class="s">&#39;5MW_AFFiles&#39;</span><span class="p">)</span>

    <span class="c"># load all airfoils</span>
    <span class="n">airfoil_types</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;Cylinder1.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;Cylinder2.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;DU40_A17.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;DU35_A17.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;DU30_A17.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;DU25_A17.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;DU21_A17.dat&#39;</span><span class="p">)</span>
    <span class="n">airfoil_types</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;NACA64_A17.dat&#39;</span><span class="p">)</span>

    <span class="c"># place at appropriate radial stations</span>
    <span class="n">af_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">af_idx</span><span class="p">)</span>
    <span class="n">af</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">af</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">airfoil_types</span><span class="p">[</span><span class="n">af_idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">airfoil_files</span> <span class="o">=</span> <span class="n">af</span>  <span class="c"># (List): names of airfoil file</span>
</pre></div>
</div>
<p>The atmospheric data also includes defining the IEC turbine and turbulence class, which are used to compute the average wind speed for the site and the survival wind speed.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="mf">1.225</span>  <span class="c"># (Float, kg/m**3): density of air</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="mf">1.81206e-5</span>  <span class="c"># (Float, kg/m/s): dynamic viscosity of air</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">shearExp</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c"># (Float): shear exponent</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">hubHt</span> <span class="o">=</span> <span class="mf">90.0</span>  <span class="c"># (Float, m): hub height</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">turbine_class</span> <span class="o">=</span> <span class="s">&#39;I&#39;</span>  <span class="c"># (Enum): IEC turbine class</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">turbulence_class</span> <span class="o">=</span> <span class="s">&#39;B&#39;</span>  <span class="c"># (Enum): IEC turbulence class class</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">cdf_reference_height_wind_speed</span> <span class="o">=</span> <span class="mf">90.0</span>  <span class="c"># (Float): reference hub height for IEC wind speed (used in CDF calculation)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span>  <span class="c"># (Float, m/s**2): acceleration of gravity</span>
</pre></div>
</div>
<p>Parameters are defined for the steady-state control conditions.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">Vin</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c"># (Float, m/s): cut-in wind speed</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">Vout</span> <span class="o">=</span> <span class="mf">25.0</span>  <span class="c"># (Float, m/s): cut-out wind speed</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">ratedPower</span> <span class="o">=</span> <span class="mf">5e6</span>  <span class="c"># (Float, W): rated power</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">minOmega</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, rpm): minimum allowed rotor rotation speed</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">maxOmega</span> <span class="o">=</span> <span class="mf">12.0</span>  <span class="c"># (Float, rpm): maximum allowed rotor rotation speed</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">tsr</span> <span class="o">=</span> <span class="mf">7.55</span>  <span class="c"># (Float): tip-speed ratio in Region 2 (should be optimized externally)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, deg): pitch angle in region 2 (and region 3 for fixed pitch machines)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">pitch_extreme</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, deg): worst-case pitch at survival wind condition</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">azimuth_extreme</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c"># (Float, deg): worst-case azimuth at survival wind condition</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">VfactorPC</span> <span class="o">=</span> <span class="mf">0.7</span>  <span class="c"># (Float): fraction of rated speed at which the deflection is assumed to representative throughout the power curve calculation</span>
</pre></div>
</div>
<p>Various optional parameters for the analysis can be defined.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">nSector</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c"># (Int): number of sectors to divide rotor face into in computing thrust and power</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">npts_coarse_power_curve</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c"># (Int): number of points to evaluate aero analysis at</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">npts_spline_power_curve</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c"># (Int): number of points to use in fitting spline to power curve</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">AEP_loss_factor</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c"># (Float): availability and other losses (soiling, array, etc.)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">drivetrainType</span> <span class="o">=</span> <span class="s">&#39;geared&#39;</span>  <span class="c"># (Enum)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">nF</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c"># (Int): number of natural frequencies to compute</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">dynamic_amplication_tip_deflection</span> <span class="o">=</span> <span class="mf">1.35</span>  <span class="c"># (Float): a dynamic amplification factor to adjust the static deflection calculation</span>
</pre></div>
</div>
<p>Like the airfoil data, the material and composite layup data is most conveniently defined from files.  This implementation uses <a class="reference external" href="http://wind.nrel.gov/designcodes/preprocessors/precomp/">PreComp</a> files.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">basepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> <span class="s">&#39;5MW_PrecompFiles&#39;</span><span class="p">)</span>

    <span class="n">materials</span> <span class="o">=</span> <span class="n">Orthotropic2DMaterial</span><span class="o">.</span><span class="n">listFromPreCompFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;materials.inp&#39;</span><span class="p">))</span>

    <span class="n">ncomp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">initial_str_grid</span><span class="p">)</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ncomp</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ncomp</span>
    <span class="n">webs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ncomp</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ncomp</span>

    <span class="n">rotor</span><span class="o">.</span><span class="n">leLoc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.498</span><span class="p">,</span> <span class="mf">0.497</span><span class="p">,</span> <span class="mf">0.465</span><span class="p">,</span> <span class="mf">0.447</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">,</span> <span class="mf">0.411</span><span class="p">,</span>
        <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>    <span class="c"># (Array): array of leading-edge positions from a reference blade axis (usually blade pitch axis). locations are normalized by the local chord length. e.g. leLoc[i] = 0.2 means leading edge is 0.2*chord[i] from reference axis.  positive in -x direction for airfoil-aligned coordinate system</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">sector_idx_strain_spar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">ncomp</span>  <span class="c"># (Array): index of sector for spar (PreComp definition of sector)</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">sector_idx_strain_te</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">ncomp</span>  <span class="c"># (Array): index of sector for trailing-edge (PreComp definition of sector)</span>
    <span class="n">web1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.4114</span><span class="p">,</span> <span class="mf">0.4102</span><span class="p">,</span> <span class="mf">0.4094</span><span class="p">,</span> <span class="mf">0.3876</span><span class="p">,</span> <span class="mf">0.3755</span><span class="p">,</span> <span class="mf">0.3639</span><span class="p">,</span> <span class="mf">0.345</span><span class="p">,</span> <span class="mf">0.3342</span><span class="p">,</span> <span class="mf">0.3313</span><span class="p">,</span> <span class="mf">0.3274</span><span class="p">,</span> <span class="mf">0.323</span><span class="p">,</span> <span class="mf">0.3206</span><span class="p">,</span> <span class="mf">0.3172</span><span class="p">,</span> <span class="mf">0.3138</span><span class="p">,</span> <span class="mf">0.3104</span><span class="p">,</span> <span class="mf">0.307</span><span class="p">,</span> <span class="mf">0.3003</span><span class="p">,</span> <span class="mf">0.2982</span><span class="p">,</span> <span class="mf">0.2935</span><span class="p">,</span> <span class="mf">0.2899</span><span class="p">,</span> <span class="mf">0.2867</span><span class="p">,</span> <span class="mf">0.2833</span><span class="p">,</span> <span class="mf">0.2817</span><span class="p">,</span> <span class="mf">0.2799</span><span class="p">,</span> <span class="mf">0.2767</span><span class="p">,</span> <span class="mf">0.2731</span><span class="p">,</span> <span class="mf">0.2664</span><span class="p">,</span> <span class="mf">0.2607</span><span class="p">,</span> <span class="mf">0.2562</span><span class="p">,</span> <span class="mf">0.1886</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
    <span class="n">web2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5886</span><span class="p">,</span> <span class="mf">0.5868</span><span class="p">,</span> <span class="mf">0.5854</span><span class="p">,</span> <span class="mf">0.5508</span><span class="p">,</span> <span class="mf">0.5315</span><span class="p">,</span> <span class="mf">0.5131</span><span class="p">,</span> <span class="mf">0.4831</span><span class="p">,</span> <span class="mf">0.4658</span><span class="p">,</span> <span class="mf">0.4687</span><span class="p">,</span> <span class="mf">0.4726</span><span class="p">,</span> <span class="mf">0.477</span><span class="p">,</span> <span class="mf">0.4794</span><span class="p">,</span> <span class="mf">0.4828</span><span class="p">,</span> <span class="mf">0.4862</span><span class="p">,</span> <span class="mf">0.4896</span><span class="p">,</span> <span class="mf">0.493</span><span class="p">,</span> <span class="mf">0.4997</span><span class="p">,</span> <span class="mf">0.5018</span><span class="p">,</span> <span class="mf">0.5065</span><span class="p">,</span> <span class="mf">0.5101</span><span class="p">,</span> <span class="mf">0.5133</span><span class="p">,</span> <span class="mf">0.5167</span><span class="p">,</span> <span class="mf">0.5183</span><span class="p">,</span> <span class="mf">0.5201</span><span class="p">,</span> <span class="mf">0.5233</span><span class="p">,</span> <span class="mf">0.5269</span><span class="p">,</span> <span class="mf">0.5336</span><span class="p">,</span> <span class="mf">0.5393</span><span class="p">,</span> <span class="mf">0.5438</span><span class="p">,</span> <span class="mf">0.6114</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
    <span class="n">web3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">chord_str_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.2612</span><span class="p">,</span> <span class="mf">3.3100915356</span><span class="p">,</span> <span class="mf">3.32587052924</span><span class="p">,</span> <span class="mf">3.34159388653</span><span class="p">,</span> <span class="mf">3.35823798667</span><span class="p">,</span> <span class="mf">3.37384375335</span><span class="p">,</span>
        <span class="mf">3.38939112914</span><span class="p">,</span> <span class="mf">3.4774055542</span><span class="p">,</span> <span class="mf">3.49839685</span><span class="p">,</span> <span class="mf">3.51343645709</span><span class="p">,</span> <span class="mf">3.87017220335</span><span class="p">,</span> <span class="mf">4.04645623801</span><span class="p">,</span> <span class="mf">4.19408216643</span><span class="p">,</span>
         <span class="mf">4.47641008477</span><span class="p">,</span> <span class="mf">4.55844487985</span><span class="p">,</span> <span class="mf">4.57383098262</span><span class="p">,</span> <span class="mf">4.57285771934</span><span class="p">,</span> <span class="mf">4.51914315648</span><span class="p">,</span> <span class="mf">4.47677655262</span><span class="p">,</span> <span class="mf">4.40075650022</span><span class="p">,</span>
         <span class="mf">4.31069949379</span><span class="p">,</span> <span class="mf">4.20483735936</span><span class="p">,</span> <span class="mf">4.08985563932</span><span class="p">,</span> <span class="mf">3.82931757126</span><span class="p">,</span> <span class="mf">3.74220276467</span><span class="p">,</span> <span class="mf">3.54415796922</span><span class="p">,</span> <span class="mf">3.38732428502</span><span class="p">,</span>
         <span class="mf">3.24931446473</span><span class="p">,</span> <span class="mf">3.23421422609</span><span class="p">,</span> <span class="mf">3.22701537997</span><span class="p">,</span> <span class="mf">3.21972125648</span><span class="p">,</span> <span class="mf">3.08979310611</span><span class="p">,</span> <span class="mf">2.95152261813</span><span class="p">,</span> <span class="mf">2.330753331</span><span class="p">,</span>
         <span class="mf">2.05553464181</span><span class="p">,</span> <span class="mf">1.82577817774</span><span class="p">,</span> <span class="mf">1.5860853279</span><span class="p">,</span> <span class="mf">1.4621</span><span class="p">])</span>  <span class="c"># (Array, m): chord distribution for reference section, thickness of structural layup scaled with reference thickness (fixed t/c for this case)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncomp</span><span class="p">):</span>

        <span class="n">webLoc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">web1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">webLoc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">web1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">web2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">webLoc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">web2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">web3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">webLoc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">web3</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">upper</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lower</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">webs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CompositeSection</span><span class="o">.</span><span class="n">initFromPreCompLayupFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;layup_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.inp&#39;</span><span class="p">),</span> <span class="n">webLoc</span><span class="p">,</span> <span class="n">materials</span><span class="p">)</span>
        <span class="n">profile</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Profile</span><span class="o">.</span><span class="n">initFromPreCompFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="s">&#39;shape_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.inp&#39;</span><span class="p">))</span>

    <span class="n">rotor</span><span class="o">.</span><span class="n">materials</span> <span class="o">=</span> <span class="n">materials</span>  <span class="c"># (List): list of all Orthotropic2DMaterial objects used in defining the geometry</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">upperCS</span> <span class="o">=</span> <span class="n">upper</span>  <span class="c"># (List): list of CompositeSection objections defining the properties for upper surface</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">lowerCS</span> <span class="o">=</span> <span class="n">lower</span>  <span class="c"># (List): list of CompositeSection objections defining the properties for lower surface</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">websCS</span> <span class="o">=</span> <span class="n">webs</span>  <span class="c"># (List): list of CompositeSection objections defining the properties for shear webs</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">profile</span>  <span class="c"># (List): airfoil shape at each radial position</span>
</pre></div>
</div>
<p>A simplistic fatigue analysis can be done if damage equivalent moments are supplied.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">rstar_damage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.000</span><span class="p">,</span> <span class="mf">0.022</span><span class="p">,</span> <span class="mf">0.067</span><span class="p">,</span> <span class="mf">0.111</span><span class="p">,</span> <span class="mf">0.167</span><span class="p">,</span> <span class="mf">0.233</span><span class="p">,</span> <span class="mf">0.300</span><span class="p">,</span> <span class="mf">0.367</span><span class="p">,</span> <span class="mf">0.433</span><span class="p">,</span> <span class="mf">0.500</span><span class="p">,</span>
        <span class="mf">0.567</span><span class="p">,</span> <span class="mf">0.633</span><span class="p">,</span> <span class="mf">0.700</span><span class="p">,</span> <span class="mf">0.767</span><span class="p">,</span> <span class="mf">0.833</span><span class="p">,</span> <span class="mf">0.889</span><span class="p">,</span> <span class="mf">0.933</span><span class="p">,</span> <span class="mf">0.978</span><span class="p">])</span>  <span class="c"># (Array): nondimensional radial locations of damage equivalent moments</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">Mxb_damage</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.3743E+003</span><span class="p">,</span> <span class="mf">2.0834E+003</span><span class="p">,</span> <span class="mf">1.8108E+003</span><span class="p">,</span> <span class="mf">1.5705E+003</span><span class="p">,</span> <span class="mf">1.3104E+003</span><span class="p">,</span>
        <span class="mf">1.0488E+003</span><span class="p">,</span> <span class="mf">8.2367E+002</span><span class="p">,</span> <span class="mf">6.3407E+002</span><span class="p">,</span> <span class="mf">4.7727E+002</span><span class="p">,</span> <span class="mf">3.4804E+002</span><span class="p">,</span> <span class="mf">2.4458E+002</span><span class="p">,</span> <span class="mf">1.6339E+002</span><span class="p">,</span>
        <span class="mf">1.0252E+002</span><span class="p">,</span> <span class="mf">5.7842E+001</span><span class="p">,</span> <span class="mf">2.7349E+001</span><span class="p">,</span> <span class="mf">1.1262E+001</span><span class="p">,</span> <span class="mf">3.8549E+000</span><span class="p">,</span> <span class="mf">4.4738E-001</span><span class="p">])</span>  <span class="c"># (Array, N*m): damage equivalent moments about blade c.s. x-direction</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">Myb_damage</span> <span class="o">=</span> <span class="mf">1e3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.7732E+003</span><span class="p">,</span> <span class="mf">2.8155E+003</span><span class="p">,</span> <span class="mf">2.6004E+003</span><span class="p">,</span> <span class="mf">2.3933E+003</span><span class="p">,</span> <span class="mf">2.1371E+003</span><span class="p">,</span>
        <span class="mf">1.8459E+003</span><span class="p">,</span> <span class="mf">1.5582E+003</span><span class="p">,</span> <span class="mf">1.2896E+003</span><span class="p">,</span> <span class="mf">1.0427E+003</span><span class="p">,</span> <span class="mf">8.2015E+002</span><span class="p">,</span> <span class="mf">6.2449E+002</span><span class="p">,</span> <span class="mf">4.5229E+002</span><span class="p">,</span>
        <span class="mf">3.0658E+002</span><span class="p">,</span> <span class="mf">1.8746E+002</span><span class="p">,</span> <span class="mf">9.6475E+001</span><span class="p">,</span> <span class="mf">4.2677E+001</span><span class="p">,</span> <span class="mf">1.5409E+001</span><span class="p">,</span> <span class="mf">1.8426E+000</span><span class="p">])</span>  <span class="c"># (Array, N*m): damage equivalent moments about blade c.s. y-direction</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">strain_ult_spar</span> <span class="o">=</span> <span class="mf">1.0e-2</span>  <span class="c"># (Float): ultimate strain in spar cap</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">strain_ult_te</span> <span class="o">=</span> <span class="mi">2500</span><span class="o">*</span><span class="mf">1e-6</span> <span class="o">*</span> <span class="mi">2</span>   <span class="c"># (Float): uptimate strain in trailing-edge panels, note that I am putting a factor of two for the damage part only.</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">eta_damage</span> <span class="o">=</span> <span class="mf">1.35</span><span class="o">*</span><span class="mf">1.3</span><span class="o">*</span><span class="mf">1.0</span>  <span class="c"># (Float): safety factor for fatigue</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">m_damage</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c"># (Float): slope of S-N curve for fatigue analysis</span>
    <span class="n">rotor</span><span class="o">.</span><span class="n">N_damage</span> <span class="o">=</span> <span class="mi">365</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="o">*</span><span class="mf">20.0</span>  <span class="c"># (Float): number of cycles used in fatigue analysis  TODO: make function of rotation speed</span>
</pre></div>
</div>
<p>Finally, we run the assembly and print/plot some of the outputs.  <a class="pageref" href="#strain-spar-fig">Figures  4</a> and <a class="pageref" href="#strain-te-fig"> 5</a> show the strian distributions for the suction and pressure surface, as well as the critical strain load for buckling, in both the spar caps and trailing-edge panels.</p>
<div class="highlight-python"><div class="highlight"><pre>    <span class="n">rotor</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">print</span> <span class="s">&#39;AEP =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">AEP</span>
    <span class="k">print</span> <span class="s">&#39;diameter =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">diameter</span>
    <span class="k">print</span> <span class="s">&#39;ratedConditions.V =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">V</span>
    <span class="k">print</span> <span class="s">&#39;ratedConditions.Omega =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">Omega</span>
    <span class="k">print</span> <span class="s">&#39;ratedConditions.pitch =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">pitch</span>
    <span class="k">print</span> <span class="s">&#39;ratedConditions.T =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">T</span>
    <span class="k">print</span> <span class="s">&#39;ratedConditions.Q =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">Q</span>
    <span class="k">print</span> <span class="s">&#39;mass_one_blade =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">mass_one_blade</span>
    <span class="k">print</span> <span class="s">&#39;mass_all_blades =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">mass_all_blades</span>
    <span class="k">print</span> <span class="s">&#39;I_all_blades =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">I_all_blades</span>
    <span class="k">print</span> <span class="s">&#39;freq =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">freq</span>
    <span class="k">print</span> <span class="s">&#39;tip_deflection =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">tip_deflection</span>
    <span class="k">print</span> <span class="s">&#39;root_bending_moment =&#39;</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">root_bending_moment</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">P</span><span class="o">/</span><span class="mf">1e6</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;wind speed (m/s)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;power (W)&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">r_str</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">strainU_spar</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;suction&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">r_str</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">strainL_spar</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;pressure&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">r_str</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">eps_crit_spar</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;critical&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">5e-3</span><span class="p">,</span> <span class="mf">5e-3</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;strain&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="c"># plt.save(&#39;/Users/sning/Desktop/strain_spar.pdf&#39;)</span>
    <span class="c"># plt.save(&#39;/Users/sning/Desktop/strain_spar.png&#39;)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">r_str</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">strainU_te</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;suction&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">r_str</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">strainL_te</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;pressure&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rotor</span><span class="o">.</span><span class="n">spline</span><span class="o">.</span><span class="n">r_str</span><span class="p">,</span> <span class="n">rotor</span><span class="o">.</span><span class="n">eps_crit_te</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;critical&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">5e-3</span><span class="p">,</span> <span class="mf">5e-3</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;strain&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="c"># plt.save(&#39;/Users/sning/Desktop/strain_te.pdf&#39;)</span>
    <span class="c"># plt.save(&#39;/Users/sning/Desktop/strain_te.png&#39;)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">AEP</span> <span class="o">=</span> <span class="mf">23488621.0394</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diameter</span> <span class="o">=</span> <span class="mf">125.955004536</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="mf">11.7373200354</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="mf">12.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="mf">716473.1724</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ratedConditions</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="mf">3978873.5773</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mass_one_blade</span> <span class="o">=</span> <span class="mf">18224.9319804</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mass_all_blades</span> <span class="o">=</span> <span class="mf">54674.7959412</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I_all_blades</span> <span class="o">=</span> <span class="p">[</span><span class="mf">35571709.72265241</span><span class="p">,</span> <span class="mf">17105524.21138387</span><span class="p">,</span> <span class="mf">14058743.19199818</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">freq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.98179088</span><span class="p">,</span> <span class="mf">1.16157427</span><span class="p">,</span> <span class="mf">2.93911298</span><span class="p">,</span> <span class="mf">4.31122765</span><span class="p">,</span> <span class="mf">6.52668043</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tip_deflection</span> <span class="o">=</span> <span class="mf">5.76697788958</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">root_bending_moment</span> <span class="o">=</span> <span class="mf">14036694.0247</span>
</pre></div>
</div>
<div class="figure align-left" id="strain-spar-fig">
<a class="reference internal image-reference" href="_images/strain_spar.png"><img alt="_images/strain_spar.png" src="_images/strain_spar.png" style="height: 4in;" /></a>
<p class="caption">Figure 4: Strain in spar cap</p>
</div>
<div class="figure align-center" id="strain-te-fig">
<a class="reference internal image-reference" href="_images/strain_te.png"><img alt="_images/strain_te.png" src="_images/strain_te.png" style="height: 4in;" /></a>
<p class="caption">Figure 5: Strain in trailing-edge panels</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Tutorial</a><ul>
<li><a class="reference internal" href="#rotor-aerodynamics">3.1. Rotor Aerodynamics</a></li>
<li><a class="reference internal" href="#rotor-aerodynamics-optimization">3.2. Rotor Aerodynamics Optimization</a></li>
<li><a class="reference internal" href="#rotor-aero-structures">3.3. Rotor Aero/Structures</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">2. Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="documentation.html"
                        title="next chapter">4. Documentation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="documentation.html" title="4. Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="2. Installation"
             >previous</a> |</li>
        <li><a href="index.html">RotorSE 0.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, NREL.
      Last updated on Oct 07, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>